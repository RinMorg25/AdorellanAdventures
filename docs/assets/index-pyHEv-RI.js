(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))a(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&a(o)}).observe(document,{childList:!0,subtree:!0});function t(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerPolicy&&(n.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?n.credentials="include":r.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function a(r){if(r.ep)return;r.ep=!0;const n=t(r);fetch(r.href,n)}})();class c{constructor(e,t,a=!0,r=!0){this.name=e,this.description=t,this.canTake=a,this.isUsable=r,this.isConsumed=!1}use(e,t){if(!this.isUsable)return`The ${this.name} cannot be used.`;switch(this.name){case"torch":return this.useTorch(e,t);case"crystal":return this.useCrystal(e,t);case"sword":return this.useSword(e,t);case"key":return this.useKey(e,t);case"potion":return this.usePotion(e,t);case"leather vest":return this.useLeatherVest(e,t);case"piece of candy":return this.usePieceOfCandy(e,t);case"red apple":return this.useRedApple(e,t);default:return`You use the ${this.name}, but nothing happens.`}}useTorch(e,t){return"The torch illuminates the area, revealing hidden details in the shadows."}useCrystal(e,t){return"The crystal pulses with energy, and you feel your strength renewed."}useSword(e,t){return e.attack+=5,"You feel more confident with the sword in hand. Your attack power increases!"}useKey(e,t){return"The key fits perfectly into a hidden lock you discover on the wall."}usePotion(e,t){return e.health=Math.min(e.maxHealth,e.health+20),this.isConsumed=!0,"You drink the potion and feel refreshed. Your health is restored!"}useLeatherVest(e,t){return e.defense+=2,this.isConsumed=!0,"You put on the leather vest. It feels sturdy. Your defense increases!"}usePieceOfCandy(e,t){const a=Math.floor(Math.random()*20)+4;return e.gainExperience(a),this.isConsumed=!0,`You eat the piece of candy. It's surprisingly energizing! You gained ${a} experience points.`}useRedApple(e,t){return t.name==="The Vault"?"It seems to fit in the hollow of the tree carving on the vault door.":"You can't find a use for that here."}examine(){return this.description}}class Y{constructor(e,t,a,r,n=""){this.name=e,this.health=t,this.maxHealth=t,this.attack=a,this.defense=r,this.description=n,this.isAlive=!0,this.experienceValue=Math.floor(t/2)+a,this.loot=[]}takeDamage(e){const t=Math.max(1,e-this.defense);return this.health-=t,this.health=Math.max(0,this.health),this.health<=0&&(this.isAlive=!1),t}attackPlayer(e){let t,a=!1;return this.name==="Goblin"?(t=Math.floor(Math.random()*5)+1,t>=4&&(a=!0)):t=Math.floor(Math.random()*this.attack)+1,{damage:t,isCritical:a}}getAttackMessage(){const e=[`The ${this.name} lunges at you!`,`The ${this.name} strikes with fury!`,`The ${this.name} attacks viciously!`,`The ${this.name} bares its claws and attacks!`];return e[Math.floor(Math.random()*e.length)]}getDeathMessage(){const e=[`The ${this.name} falls to the ground, defeated.`,`The ${this.name} lets out a final roar and collapses.`,`The ${this.name} crumbles into dust.`,`The ${this.name} retreats into the shadows, defeated.`];return e[Math.floor(Math.random()*e.length)]}addLoot(e){this.loot.push(e)}dropLoot(){return this.loot}}class I{constructor(e,t,a,r,n=0){this.name=e,this.health=t,this.maxHealth=t,this.attack=a,this.defense=r,this.inventory=[],this.experience=0,this.level=1,this.gold=n}takeDamage(e){const t=Math.max(1,e-this.defense);return this.health-=t,this.health=Math.max(0,this.health),t}heal(e){this.health+=e,this.health=Math.min(this.maxHealth,this.health)}isAlive(){return this.health>0}addItem(e){this.inventory.push(e)}removeItem(e){const t=this.inventory.indexOf(e);t>-1&&this.inventory.splice(t,1)}hasItem(e){return this.inventory.some(t=>t.name.toLowerCase()===e.toLowerCase())}getItem(e){return this.inventory.find(t=>t.name.toLowerCase()===e.toLowerCase())}gainExperience(e){this.experience+=e,this.experience>=this.level*100&&this.levelUp()}levelUp(){return this.level++,this.maxHealth+=10,this.health=this.maxHealth,this.attack+=2,this.defense+=1,`You reached level ${this.level}! Your stats have improved.`}getStats(){return{name:this.name,level:this.level,health:this.health,maxHealth:this.maxHealth,attack:this.attack,defense:this.defense,experience:this.experience,gold:this.gold}}}class M extends I{constructor(e,t,a,r,n="",o={},s=[]){super(e,t,a,r),this.description=n,this.responses=o,this.isHostile=!1,this.dialogueCounters={},this.shopInventory=s}speak(e="default"){const t=this.responses[e]||this.responses.default;if(!t||t.length===0)return`${this.name} has nothing to say.`;this.dialogueCounters[e]===void 0&&(this.dialogueCounters[e]=0);const a=this.dialogueCounters[e],r=t[a];return this.dialogueCounters[e]=(a+1)%t.length,`${this.name} says: "${r}"`}setHostile(e){this.isHostile=e}turnHostile(){return this.isHostile=!0,`${this.name} becomes hostile!`}}const x=[{name:"Warrior",health:120,strength:15,dexterity:10,agility:8,intelligence:5,charisma:7},{name:"Rogue",health:90,strength:10,dexterity:15,agility:12,intelligence:8,charisma:10},{name:"Ranger",health:100,strength:12,dexterity:14,agility:10,intelligence:7,charisma:8},{name:"Bard",health:85,strength:8,dexterity:12,agility:9,intelligence:12,charisma:15},{name:"Healer",health:95,strength:7,dexterity:9,agility:7,intelligence:14,charisma:12},{name:"Mage",health:80,strength:6,dexterity:8,agility:6,intelligence:16,charisma:9}];class H{constructor(e,t){this.name=e,this.description=t,this.exits={},this.items=[],this.monsters=[],this.npcs=[],this.visited=!1,this.lockedExits={}}setExit(e,t){this.exits[e]=t}setLockedExit(e,t,a="lockpick"){this.exits[e]=t,this.lockedExits[e]=a}addItem(e){this.items.push(e)}removeItem(e){const t=this.items.indexOf(e);t>-1&&this.items.splice(t,1)}addMonster(e){this.monsters.push(e)}addNPC(e){this.npcs.push(e)}removeMonster(e){const t=this.monsters.indexOf(e);t>-1&&this.monsters.splice(t,1)}getDescription(e){this.visited=!0;let t=this.description;this.name==="The Vault"&&e&&e.hasItem("red apple")&&e.hasItem("blue key")&&(t="A massive, circular iron door dominates one wall of this room. It is sealed shut with no obvious handle or lock. Finely etched into its surface is the depiction of a great tree, its branches heavy with what look like round fruit. A small, empty nest is tucked among the boughs, and a dark, fist-sized hollow is visible in the trunk. The entire etching now emits a strong pulse, almost like a heartbeat, bathing the room in a rhythmic purple glow.");let a=`${this.name}
${t}`;this.items.length>0&&(a+=`

You see: ${this.items.map(n=>n.name).join(", ")}`),this.monsters.length>0&&(a+=`

Creatures present: ${this.monsters.map(n=>n.name).join(", ")}`),this.npcs.length>0&&(a+=`

People here: ${this.npcs.map(n=>n.name).join(", ")}`);const r=Object.keys(this.exits);if(r.length>0){const n=r.map(o=>this.lockedExits[o]?`${o} (locked)`:o);a+=`

Exits: ${n.join(", ")}`}return a}hasExit(e){return this.exits.hasOwnProperty(e)}getExit(e){return this.exits[e]}unlockExit(e){if(this.lockedExits[e]){const t=this.exits[e],a=t.name;delete this.lockedExits[e];for(const r in t.exits)if(t.exits[r]===this){t.lockedExits[r]&&delete t.lockedExits[r];break}return`You've unlocked the exit to the ${a}!`}return`The exit to the ${this.exits[e].name} wasn't locked.`}}function D(){const l={entrance:{name:"The Glade",description:`After what feels like an eternity of pushing through an unforgiving, dense forest, the trees finally part. You step into a secluded glade, a place that feels untouched by time. The air is crisp, filled with the scent of damp earth and decaying leaves. A circle of towering trees, their leaves a brilliant tapestry of gold, crimson, and amber, stands as silent sentinels, walling this place off from the outside world. It's clear why this glade has remained hidden for so long.

Before you stands the true prize of your journey: the entrance to The Labyrinth of Lyre, Adorellan's most ancient and storied site. The entrance is formidable. Tall, ancient stone walls, grey and weathered with age, rise up to meet the sky. Set within these walls are thick, heavy wrought-iron gates, their surface pitted with rust and age. A dense curtain of thick, dark green vines chokes the gates, weaving through the bars so completely that nothing of the labyrinth beyond can be seen. The silence here is profound, broken only by the rustle of leaves under your feet.`},courtyard:{name:"The Garden of Grie",description:`With a final, desperate shove, the ancient iron gates groan in protest, their rusted hinges screaming as they reluctantly give way. You stumble forward, catching your balance on the cracked flagstones of a vast, open courtyard. The air here is still and heavy, carrying the scent of dust and forgotten time. With a brief look you notice the discarded remains of old camps and items that belonged to brave adventures long since forgotten.

In the centre of the courtyard, a once-grand fountain lies in ruins. Its stone basin shattered, and the statue that once stood proudly at its heart is now a toppled, moss-covered casualty of age. A trickle of dark, stagnant water weeps from a crack, pooling on the ground below.

Your eyes are drawn to the far side of the courtyard. Dominating the wall is a massive, intricate circular carving, its ancient design a complex web of interlocking lines and symbols that seem to writhe just at the edge of your vision. Flanking this mysterious emblem are two arched exits.

To the left, a sturdy iron gate, similar to the one you just forced open, blocks the archway, promising another challenge. To the right, the archway is filled with the splintered remains of a wooden door, hanging precariously from a single hinge, offering a seemingly easier, though perhaps more treacherous, path forward.`},bunkers:{name:"Bunker's Bend",description:"Rows of dusty, empty bunks line the walls of this large, cold room. It seems to have been abandoned long ago."},clinkers:{name:"Clinker's Armoury",description:"This chamber serves as a makeshift armoury. Racks of rusted weapons and dented armour line the walls. Most of it is useless, but some treasures may yet remain."},market:{name:"The Sunken Market",description:"You step into what was clearly once a bustling underground market. Broken stalls and scattered, worthless goods litter the floor. It seems you are the first to enter in a very long time."},marketCorridor:{name:"Short Corridor",description:"A short, narrow corridor. About halfway down, a sturdy-looking wooden door blocks the path forward. A strange inscription on the door depicts a hand, a stone, and some parchment. It seems to be a game of chance. Do you try your luck?"},bunkerHallway:{name:"Cluttered Hallway",description:"This hallway is cluttered with scattered bits and bobs left behind by previous inhabitants - tattered clothes, worthless trinkets, and other debris. It continues forward towards Bunker's Bend."},armouryHallway:{name:"Decrepit Hallway",description:"The splintered remains of a wooden door lead into this short, dusty hallway. It continues forward, where you can see the entrance to another chamber."},vault:{name:"The Vault",description:"A massive, circular iron door dominates one wall of this room. It is sealed shut with no obvious handle or lock. Finely etched into its surface is the depiction of a great tree, its branches heavy with what look like round fruit. A small, empty nest is tucked among the boughs, and a dark, fist-sized hollow is visible in the trunk. The entire etching glows with a faint, otherworldly purple light."},vaultHallway:{name:"Vault Hallway",description:"A short, sterile hallway with smooth stone walls. A simple revolving iron gate stands behind you, leading back to the market. Ahead, the hallway ends at the massive circular door of The Vault."},zHallway:{name:"Z-Shaped Hallway",description:"A cramped, narrow hallway that takes a sharp turn before continuing. The stone is cold and damp to the touch. One way leads towards the market, while the path behind you returns to the bunkers."},temple:{name:"The Forgotten Temple",description:"An eerie silence hangs in this grand temple. Faded murals on the walls depict forgotten gods."},safezone:{name:"Haven Shield",description:"The narrow corridor opens into a breathtaking, sun-dappled glade that feels entirely separate from the labyrinth. The walls are lined with ancient, towering trees, their leaves forming a dense canopy overhead. In the center of the glade is a serene, crystal-clear lake. On the far side of the lake stands a single, rustic-looking cabin. There are signs of others who have made it this far: the remnants of abandoned campfires and a discarded waterskin near the cabin's entrance."},grebs:{name:"Greb's Grotto",description:"This small, surprisingly cozy cavern is a chaotic mess of discarded adventuring gear. Piles of dented helmets, mismatched boots, and chipped shields are stacked against the walls. A small, friendly-looking red imp with large, curious eyes tends to a makeshift counter made from a large, flat rock. He seems to be sorting through a pile of rusty keys."},scriptorium:{name:"The Scriptorium",description:"You enter a large, almost grand chamber that feels like a sanctuary of knowledge. The walls are lined from floor to ceiling with towering shelves, heavy with ancient books, leather-bound tomes, and countless scrolls. In the center of the room, a large, imposing, writing desk stands beside a shorter shelf stacked high with fresh parchments and pots of ink. The air is still, carrying the faint scent of old paper and wax. Flickering lamps mounted on the walls cast a warm, dancing light across the room, making the shadows themselves seem to hold forgotten secrets."},chamber:{name:"The Mercurial Den",description:"A vast, circular chamber where the walls shimmer with thousands of luminescent crystals, casting a beautiful, eerie light."},grottoHallway:{name:"Cluttered Passageway",description:"A short passageway littered with discarded items - a broken lantern, a tattered cloak, and other adventuring debris. It seems to be a well-traveled route."},bendyHallway:{name:"Winding Corridor",description:"A long, winding corridor that bends out of sight. The air feels strangely calm and quiet here."},rockCrevice:{name:"Rock Crevice",description:"A narrow crevice in the rock face, almost hidden by overgrown vines. It looks like a tight squeeze."},hiddenCavern:{name:"Hidden Cavern",description:"The crevice opens into a small, damp cavern. A crude, heavy wooden door is set into the far wall."},windingPassage:{name:"Winding Passage",description:"Beyond the door is a long, winding passage carved from the rock. It slopes gently downwards and ends at another door, which looks like it can only be opened from this side."},cabin:{name:"The Cabin",description:`The interior of the cabin is a single, cluttered room. Pots and pans hang from the low ceiling, and shelves are crammed with a mix of food supplies—some look recently gathered, while others are long past their prime, hinting at a hurried or inconsistent inhabitant. A small fireplace sits to the left as you enter, with a small space cleared before it, A likely place where past adventurers have slept in safety and warmth.

A small wooden table with two chairs sits in the center of the room; a leather vest is slung carelessly over the back of one. A wall cabinet with a door hanging precariously from a single hinge reveals a surprisingly well-stocked fruit bowl. In the sink, a glint of something colorful inside a glass catches your eye.`}},e=[{from:"entrance",to:"courtyard",direction:"forward",returnDirection:"back"},{from:"courtyard",to:"armouryHallway",direction:"right",returnDirection:"back"},{from:"armouryHallway",to:"clinkers",direction:"forward",returnDirection:"back"},{from:"courtyard",to:"bunkerHallway",direction:"left",returnDirection:"back",locked:!0},{from:"bunkerHallway",to:"bunkers",direction:"forward",returnDirection:"back"},{from:"clinkers",to:"marketCorridor",direction:"left",returnDirection:"back"},{from:"marketCorridor",to:"market",direction:"forward",returnDirection:"back",locked:"rps"},{from:"market",to:"temple",direction:"forward",returnDirection:"back"},{from:"temple",to:"scriptorium",direction:"left",returnDirection:"back"},{from:"scriptorium",to:"chamber",direction:"forward",returnDirection:"back"},{from:"market",to:"vaultHallway",direction:"right",returnDirection:"back"},{from:"vaultHallway",to:"vault",direction:"forward",returnDirection:"back"},{from:"market",to:"zHallway",direction:"left",returnDirection:"back"},{from:"bunkers",to:"zHallway",direction:"forward",returnDirection:"back",locked:!0,twoWayLock:!0},{from:"chamber",to:"grottoHallway",direction:"forward",returnDirection:"back"},{from:"grottoHallway",to:"grebs",direction:"forward",returnDirection:"back"},{from:"chamber",to:"bendyHallway",direction:"right",returnDirection:"back"},{from:"bendyHallway",to:"safezone",direction:"forward",returnDirection:"back"},{from:"safezone",to:"cabin",direction:"forward",returnDirection:"back",locked:"inspect_cabin"},{from:"safezone",to:"rockCrevice",direction:"right",returnDirection:"back"},{from:"rockCrevice",to:"hiddenCavern",direction:"forward",returnDirection:"back"},{from:"hiddenCavern",to:"windingPassage",direction:"forward",returnDirection:"back"},{from:"windingPassage",to:"temple",direction:"forward",oneWay:!0}],t={courtyard:[new c("torch","A flickering torch that provides light in dark places.",!0)],chamber:[new c("crystal","A glowing blue crystal that pulses with mystical energy.",!0)],clinkers:[new c("sword","An ancient sword with mysterious runes etched into the blade.",!0)],armouryHallway:[new c("lockpick","A set of lock picks, half-hidden under some debris. Useful for opening locked doors.",!0)],market:[new c("potion","A healing potion, left behind on a stall.",!0)],grottoHallway:[new c("potion","A healing potion, dropped carelessly on the floor.",!0)],safezone:[new c("waterskin","A discarded waterskin, still half-full of clean water.",!0)],cabin:[new c("leather vest","A simple vest made of hardened leather.",!0),new c("piece of candy","A piece of candy in a blue and purple wrapper.",!0),new c("fruit bowl","A well-stocked fruit bowl. It looks delicious.",!1),new c("gold coins","Two shiny gold coins.",!0,!1)]},a={chamber:[new Y("Goblin",30,8,3,"A small, green creature with glowing red eyes.")]},r={grebs:[new M("Grebgela",50,0,5,"A small red imp with large, curious eyes. He fidgets with a collection of shiny trinkets on his makeshift counter, a wide, toothy grin spreading across his face when he notices you.",{default:["'Allo there, adventurer! Welcome to Greb's Grotto!","See anything you like? Just bits and bobs I find, but one person's junk is another imp's treasure, eh?"],keys:["Ah, these old things?","Just some rusty keys I found. None of 'em seem to fit anything important... yet!","Maybe you'll have better luck with them than I did!"],grotto:["It ain't much, but it's home! And it's full of wonderful junk!","A bit messy, I know. I call it 'organized chaos'!"],shop:["Everything here is for sale, friend! If you've got the coin, I've got the... well, the 'stuff'!","Just 'list' what I've got, or 'buy [item name]' if you see something you fancy!"]},[{item:new c("blue key","A key made of sapphire, cool and smooth in your hand.",!0),price:25},{item:new c("skeleton key","A key made from bone, said to open any locked chest.",!0),price:50},{item:new c("potion","A healing potion, brewed by Grebgela himself. Smells faintly of swamp water.",!0),price:15}])]},n={};for(const o in l)n[o]=new H(l[o].name,l[o].description);for(const o of e){const s=n[o.from],d=n[o.to];o.locked?s.setLockedExit(o.direction,d,o.locked):s.setExit(o.direction,d),o.oneWay||(o.twoWayLock?d.setLockedExit(o.returnDirection,s,o.locked):d.setExit(o.returnDirection,s))}for(const o in t)t[o].forEach(s=>n[o].addItem(s));for(const o in a)a[o].forEach(s=>n[o].addMonster(s));for(const o in r)r[o].forEach(s=>n[o].addNPC(s));return n.entrance}class R{constructor(e){this.game=e,this.commands={go:this._handleMovement,look:this._handleLook,inspect:this._handleInspect,search:this._handleSearch,take:this._handleTake,use:this._handleUse,drop:this._handleDrop,attack:this._handleBattle,fight:this._handleBattle,battle:this._handleBattle,flee:this._handleFlee,left:this._handleMovement,right:this._handleMovement,forward:this._handleMovement,back:this._handleMovement,pick:this._handlePick,help:this._handleHelp,play:this._handlePlay,talk:this._handleTalk,list:this._handleList,buy:this._handleBuy}}processCommand(e,t){const a=this.commands[e];return a?["left","right","forward","back"].includes(e)?a.call(this,e):a.call(this,t):"I don't understand that command. Try 'help' to see a list of available commands."}_handleMovement(e){if(!["forward","back","left","right"].includes(e))return"You can only move in these directions: forward, back, left, right.";if(e==="back")return this.game.roomHistory.length>0?(this.game.currentRoom=this.game.roomHistory.pop(),`You go back.

${this.game.currentRoom.getDescription(this.game.player)}`):"You can't go back any further.";const a=this.game.currentRoom.getExit(e);return a?this.game.currentRoom.lockedExits[e]?"That way is locked.":(this.game.roomHistory.push(this.game.currentRoom),this.game.currentRoom=a,`You move ${e}.

${this.game.currentRoom.getDescription(this.game.player)}`):`You cannot go ${e} from here.`}_handleLook(e){return e?`To examine something specific, try 'inspect ${e}'.`:this.game.currentRoom.getDescription(this.game.player)}_handleInspect(e){if(!e)return"What do you want to inspect?";if(this.game.currentRoom.name==="The Cabin"&&e.toLowerCase()==="fruit bowl"){const n=this.game.currentRoom.items.find(o=>o.name.toLowerCase()==="fruit bowl");if(n){this.game.currentRoom.removeItem(n);const o=new c("red apple","A shiny red apple that emits a faint, warm glow.",!0,!0);return this.game.currentRoom.addItem(o),"you empty the fruit bowl on to the table. It holds 3 peaches, 2 bananas, a bushel of green grapes, 1 kiwi and a red apple that seems to have a faint glow about it."}}if(this.game.currentRoom.name==="Haven Shield"&&e.toLowerCase()==="cabin")return this.game.currentRoom.lockedExits.forward==="inspect_cabin"&&this.game.currentRoom.unlockExit("forward"),"You approach the rustic cabin. The wooden planks are weathered but sturdy. You notice the door is slightly ajar, inviting you to go forward.";const t=this.game.currentRoom.items.find(n=>n.name.toLowerCase()===e.toLowerCase());if(t)return t.examine();const a=this.game.currentRoom.monsters.find(n=>n.name.toLowerCase()===e.toLowerCase());if(a)return a.description;const r=this.game.currentRoom.npcs.find(n=>n.name.toLowerCase()===e.toLowerCase());return r?r.description:`You don't see a ${e} here to inspect.`}_handleSearch(){const e=this.game.currentRoom.items,t=this.game.currentRoom.monsters;let a=`You search the area carefully...

`;e.length>0&&(a+="You find: "+e.map(n=>n.name).join(", ")+`
`),t.length>0&&(a+="You notice: "+t.map(n=>n.name).join(", ")+`
`);const r=this.game.currentRoom.npcs;return r.length>0&&(a+="You see: "+r.map(n=>n.name).join(", ")+`
`),e.length===0&&t.length===0&&r.length===0&&(a+="You find nothing of interest."),a}_handleTake(e){const t=this.game.currentRoom.items.find(a=>a.name.toLowerCase()===e.toLowerCase());return t?t.canTake?t.name.toLowerCase()==="gold coins"?(this.game.player.gold+=2,this.game.currentRoom.removeItem(t),`You take the 2 gold coins and add them to your pouch. You now have ${this.game.player.gold} gold.`):(this.game.player.addItem(t),this.game.currentRoom.removeItem(t),`You take the ${e}.`):"You cannot take that item":`There is no ${e} here.`}_handleUse(e){const t=this.game.player.getItem(e.toLowerCase());if(t){const a=t.use(this.game.player,this.game.currentRoom);return t.isConsumed&&this.game.player.removeItem(t),a}return`You don't have a ${e}.`}_handleDrop(e){const t=this.game.player.getItem(e.toLowerCase());return t?(this.game.player.removeItem(t),this.game.currentRoom.addItem(t),`You drop the ${e}.`):`You don't have a ${e} to drop.`}_handleBattle(e){const t=this.game.currentRoom.monsters.find(a=>a.name.toLowerCase()===e.toLowerCase()||e===""&&this.game.currentRoom.monsters.length>0);return t?this.game.battleSystem.startBattle(this.game.player,t):"There is nothing to fight here, or no specific target mentioned."}_handleFlee(){return"You look around nervously, but there is no immediate danger to flee from."}_handlePick(e){if(!e)return"Which exit do you want to try and pick?";if(this.game.player.hasItem("lockpick")){const t=this.game.currentRoom.exits[e];return t&&this.game.currentRoom.lockedExits[e]?this.game.currentRoom.unlockExit(e):t?"That exit isn't locked.":"There's no exit in that direction."}return"You don't have any lock picks!"}_handlePlay(e){if(!e)return"What do you want to play? Try 'play rock', 'play paper', or 'play scissors'.";const t=["rock","paper","scissors"],a=e.toLowerCase();if(!t.includes(a))return`You can't play '${e}'. Try rock, paper, or scissors.`;let r=null;for(const s in this.game.currentRoom.lockedExits)if(this.game.currentRoom.lockedExits[s]==="rps"){r=s;break}if(!r)return"There's nothing here to play a game with.";const n=t[Math.floor(Math.random()*t.length)];let o=`You play ${a}. The door seems to respond, projecting an image of a ${n}.

`;return a===n?o+="It's a draw! The door remains locked. Try again.":a==="rock"&&n==="scissors"||a==="paper"&&n==="rock"||a==="scissors"&&n==="paper"?(o+="You win! With a grinding sound, the lock on the door retracts.",this.game.currentRoom.unlockExit(r)):o+="You lose! The door remains stubbornly shut.",o}_handleTalk(e){if(!e)return"Who do you want to talk to?";const t=e.toLowerCase().split(" about "),a=t[0].trim(),r=t.length>1?t[1].trim():"default",n=this.game.currentRoom.npcs.find(o=>o.name.toLowerCase()===a);return n?n.speak(r):`There is no one named '${a}' here to talk to.`}_handleList(){const e=this.game.currentRoom.npcs.find(a=>a.shopInventory&&a.shopInventory.length>0);if(!e)return"There is no one here to buy from.";if(e.shopInventory.length===0)return`${e.name} has nothing for sale right now.`;let t=`<strong>--- ${e.name}'s Wares ---</strong>

`;return e.shopInventory.forEach(a=>{t+=`- ${a.item.name} (${a.price} gold): ${a.item.description}
`}),t+=`
You have ${this.game.player.gold} gold.`,t+=`
(Type 'buy [item name]' to purchase)`,t}_handleBuy(e){if(!e)return"What would you like to buy?";const t=this.game.currentRoom.npcs.find(r=>r.shopInventory&&r.shopInventory.length>0);if(!t)return"There is no one here to buy from.";const a=t.shopInventory.find(r=>r.item.name.toLowerCase()===e.toLowerCase());return a?this.game.player.gold<a.price?`You don't have enough gold. You need ${a.price} gold, but you only have ${this.game.player.gold}.`:(this.game.player.gold-=a.price,this.game.player.addItem(a.item),t.shopInventory=t.shopInventory.filter(r=>r.item.name.toLowerCase()!==e.toLowerCase()),`You bought the ${a.item.name} for ${a.price} gold. You have ${this.game.player.gold} gold left.`):`${t.name} doesn't have a "${e}" for sale.`}_handleHelp(){return`<strong>--- Help: Available Commands ---</strong>

`+["<strong>go [direction]</strong>: Move between rooms. Valid directions are 'forward', 'back', 'left', and 'right'. You can also type a direction by itself (e.g., 'left').","<strong>look</strong>: Get a description of your current location.","<strong>inspect [object/monster]</strong>: Examine a specific object or monster in the room.","<strong>search</strong>: Search the room for any items or hidden things.","<strong>take [item]</strong>: Add an item from the room to your inventory.","<strong>drop [item]</strong>: Remove an item from your inventory and leave it in the room.","<strong>use [item]</strong>: Use an item from your inventory. Some items have special effects.","<strong>pick [direction]</strong>: Attempt to pick a locked door in a given direction (e.g., 'pick left'). This requires a 'lockpick' in your inventory.","<strong>attack [monster]</strong>: Engage in combat with a monster.","<strong>flee</strong>: Attempt to run away from a battle.","<strong>play [choice]</strong>: Play a game of chance when prompted (e.g., 'play rock').","<strong>talk [person]</strong> or <strong>talk [person] about [topic]</strong>: Speak to a friendly character.","<strong>list</strong>: Shows items for sale if a shopkeeper is present.","<strong>buy [item]</strong>: Purchase an item from a shopkeeper."].join(`

`)}}class P{constructor(){this.inBattle=!1,this.currentEnemy=null,this.battleLog=[]}startBattle(e,t){this.inBattle=!0,this.currentEnemy=t,this.battleLog=[];let a=`
=== BATTLE BEGINS ===
`;return a+=`You face the ${t.name}!
`,a+=`${t.description}

`,a+=this.getBattleStatus(e,t),a+=`
What will you do? (attack, flee, use [item])`,a}processBattleTurn(e,t,a,r=null){if(!this.inBattle)return"You are not in battle.";let n="";switch(a){case"attack":n+=this.playerAttack(e,t),t.isAlive&&(n+=`
`+this.monsterAttack(e,t));break;case"flee":n+=this.attemptFlee(e,t);break;case"use":n+=this.useItemInBattle(e,r),t.isAlive&&(n+=`
`+this.monsterAttack(e,t));break;default:n="Invalid battle action. Try: attack, flee, or use [item]"}return t.isAlive?e.isAlive()?n+=`

`+this.getBattleStatus(e,t):n+=`
`+this.endBattle(e,t,"defeat"):n+=`
`+this.endBattle(e,t,"victory"),n}playerAttack(e,t){const a=Math.floor(Math.random()*13)+1;let r,n=!1;if(a>9){n=!0;let d=11+(e.level-1)*2;d=Math.min(d,18);const y=10;r=Math.floor(Math.random()*(d-y+1))+y}else r=a;const o=t.takeDamage(r);let s="";return n?s=`Critical Hit! You strike the ${t.name} for ${o} damage!`:s=`You strike the ${t.name} for ${o} damage!`,t.isAlive||(s+=`
`+t.getDeathMessage()),s}monsterAttack(e,t){const a=t.attackPlayer(e),r=e.takeDamage(a.damage);let n=t.getAttackMessage();return a.isCritical&&(n+=" Critical Hit!"),n+=`
The ${t.name} hits you for ${r} damage!`,e.isAlive()||(n+=`
You have been defeated!`),n}attemptFlee(e,t){if(Math.random()>.3)return this.endBattle(e,t,"flee"),"You successfully flee from the battle!";{let r="You failed to escape!";return r+=`
`+this.monsterAttack(e,t),r}}useItemInBattle(e,t){const a=e.getItem(t);if(!a)return`You don't have a ${t}.`;let r=a.use(e,null);return a.isConsumed&&e.removeItem(a),r}getBattleStatus(e,t){let a=`--- Battle Status ---
`;return a+=`Your Health: ${e.health}/${e.maxHealth}
`,a+=`${t.name} Health: ${t.health}/${t.maxHealth}`,a}endBattle(e,t,a){this.inBattle=!1,this.currentEnemy=null;let r=`
=== BATTLE END ===
`;switch(a){case"victory":const n=t.experienceValue;e.gainExperience(n),r+=`Victory! You gained ${n} experience points.`;const o=t.dropLoot();o.length>0&&(r+=`
The ${t.name} dropped: `,r+=o.map(s=>s.name).join(", "),o.forEach(s=>e.addItem(s)));break;case"defeat":r+="You have been defeated! Game Over.";break;case"flee":r+="You escaped from the battle.";break}return r}}class _{constructor(e,t){this.game=e,this.appendText=t}displayMap(){let e=`--- Location ---

`;e+=`Your current location is the ${this.game.currentRoom.name}. `;const t=Object.keys(this.game.currentRoom.exits);if(t.length>0){const a=t.map(r=>{const n=this.game.currentRoom.exits[r].name,o=this.game.currentRoom.lockedExits[r];return`${r} to ${n}${o?" (locked)":""}`});e+="Exits: "+a.join(", ")+`
`}else e+=`No obvious exits from here.
`;this.appendText(e)}displayInventory(){let e=`--- Inventory ---

`;this.game.player.inventory.length===0?e+="Your inventory is empty.":(e+=`You are carrying:
`,this.game.player.inventory.forEach(t=>{e+=`- ${t.name}: ${t.examine()}
`})),this.appendText(e)}displayStats(){const e=this.game.player.getStats(),t=e.level*100,a={Name:e.name,Level:e.level,Health:`${e.health} / ${e.maxHealth}`,Attack:e.attack,Defense:e.defense,Experience:`${e.experience} / ${t}`,Gold:e.gold},r=`--- Character Stats ---

`+Object.entries(a).map(([n,o])=>`${n}: ${o}`).join(`
`);this.appendText(r)}}function G(l,e,t,a){l.forEach(r=>{const n=parseInt(r.dataset.index,10);r.addEventListener("click",()=>{a(r)}),r.addEventListener("mouseenter",o=>{const s=e[n];s&&(t.innerHTML=`
                    <strong>${s.name}</strong><br>
                    Health: ${s.health}<br>
                    Strength: ${s.strength}<br>
                    Dexterity: ${s.dexterity}<br>
                    Agility: ${s.agility}<br>
                    Intelligence: ${s.intelligence}<br>
                    Charisma: ${s.charisma}`,t.style.left=o.pageX+15+"px",t.style.top=o.pageY+15+"px",t.style.display="block")}),r.addEventListener("mouseleave",()=>{t.style.display="none"}),r.addEventListener("mousemove",o=>{t.style.display==="block"&&(t.style.left=o.pageX+15+"px",t.style.top=o.pageY+15+"px")})})}function j({startButton:l,selectMaleButton:e,selectFemaleButton:t,confirmCharacterButton:a,allPortraitImages:r,statTooltip:n,archetypeData:o,onStartGame:s,onGenderSelected:d,onPortraitClicked:y,onConfirmCharacterClicked:k}){l&&l.addEventListener("click",s),e&&e.addEventListener("click",()=>d("Male")),t&&t.addEventListener("click",()=>d("Female")),a&&a.addEventListener("click",k),G(r,o,n,y)}function O({commandInput:l,mapButton:e,inventoryButton:t,statsButton:a,helpButton:r,gameInstance:n}){l&&l.addEventListener("keypress",o=>{o.key==="Enter"&&l.value.trim()!==""&&(n.processCommand(l.value.trim().toLowerCase()),l.value="")}),e&&e.addEventListener("click",()=>n.displayManager.displayMap()),t&&t.addEventListener("click",()=>n.displayManager.displayInventory()),a&&a.addEventListener("click",()=>n.displayManager.displayStats()),r&&r.addEventListener("click",()=>{const o=n.actionHandler._handleHelp();n.displayMessage(o,!1)})}document.addEventListener("DOMContentLoaded",()=>{const l=document.getElementById("titleScreen"),e=document.getElementById("startButton"),t=document.getElementById("characterSelectionScreen"),a=document.getElementById("selectMaleButton"),r=document.getElementById("selectFemaleButton"),n=document.getElementById("malePortraits"),o=document.getElementById("femalePortraits"),s=document.querySelectorAll(".portrait-img"),d=document.getElementById("gameplayScreen"),y=document.getElementById("confirmCharacterButton"),k=document.getElementById("commandInput"),b=document.createElement("div");b.id="statTooltip",b.classList.add("tooltip"),document.body.appendChild(b);const B=document.getElementById("gameOutput"),T=document.querySelector(".output-text-container");function f(u){const i=u.replace(/\n/g,"<br>");B.innerHTML+=`<p>${i}</p>`,T.scrollTop=T.scrollHeight}let v=null,g=0;class C{constructor(i){this.currentRoom=null,this.roomHistory=[],this.gameState="pre-start",this.interactionState=null,this.player=new I(i||"Player",100,10,5),typeof i=="object"&&i!==null&&i.name&&(this.player=new I(i.name,i.health,i.strength,i.dexterity,25)),this.battleSystem=new P,this.commandInput=document.getElementById("commandInput"),this.gameOutput=document.getElementById("gameOutput"),this.mapButton=document.getElementById("mapButton"),this.inventoryButton=document.getElementById("inventoryButton"),this.statsButton=document.getElementById("statsButton"),this.helpButton=document.getElementById("helpButton"),this.actionHandler=new R(this),this.displayManager=new _(this,f),this.initializeGame(),this.updateStatusBars()}initializeGame(){this.currentRoom=D(),this.gameState="intro",this.gameOutput&&(f("In the shadowed alleys of the local bazaar, amidst discarded trinkets and whispered secrets, you find it: a tattered journal, its leather cover cracked with age. The pages are brittle, stained, and filled with a frantic, faded script. It speaks of a place of legend, Adorellan's most ancient site—the Labyrinth of Lyre."),f("The author writes of unimaginable treasure and riches waiting in its depths, but also of a challenge that has broken all who came before. It is a legendary, dangerous place, where the very walls are said to test the sanity of those who walk them."),f("Beyond the promise of gold, the journal hints at a greater prize: the chance to uncover lost knowledge and solve a mystery buried for millennia. The final entries are a scrawl of fear and regret, a tale of an expedition lost to the darkness."),f("The last legible line is not a plea, but a direct challenge that seems to lift from the page and settle upon you:"),f("<strong>Will you succeed where they have failed?</strong>"),f("<em>Type 'venture forth' to begin your adventure, or 'give up' to walk away.</em>"),this.updateStatusBars())}processCommand(i){let h="";if(this.interactionState==="rps_prompt"){i==="yes"||i==="try my luck"?(this.interactionState="rps_choice",h="You decide to test your fate. What do you play? (rock, paper, or scissors)"):i==="no"?(this.interactionState=null,h=this.actionHandler._handleMovement("back")):h="A simple 'yes' or 'no' will suffice.",this.displayMessage(h),this.updateStatusBars();return}if(this.interactionState==="rps_choice"){["rock","paper","scissors"].includes(i)?(h=this.actionHandler._handlePlay(i),h.includes("You win!")&&(this.interactionState=null)):h="That's not a valid move. Choose rock, paper, or scissors.",this.displayMessage(h),this.updateStatusBars();return}if(this.gameState==="intro"){i==="venture forth"?(this.gameState="playing",h=`You steel your resolve and step towards the Labyrinth of Lyre.

${this.currentRoom.getDescription(this.player)}`):i==="give up"?(this.gameState="ended",h="You close the journal, the challenge unanswered. The Labyrinth will wait for another hero. You turn and walk away.",this.commandInput.disabled=!0):h="The choice is before you. Will you 'venture forth' or 'give up'?",this.displayMessage(h),this.updateStatusBars();return}const m=i.split(" "),w=m[0],p=m.slice(1).join(" ");this.battleSystem.inBattle?this.battleSystem.currentEnemy?(h=this.battleSystem.processBattleTurn(this.player,this.battleSystem.currentEnemy,w,p),!this.battleSystem.inBattle&&this.battleSystem.currentEnemy&&!this.battleSystem.currentEnemy.isAlive&&this.currentRoom.removeMonster(this.battleSystem.currentEnemy)):(h="Error: In battle but no current enemy defined. Exiting battle mode.",this.battleSystem.inBattle=!1):this.gameState==="ended"?h="The adventure is over.":h=this.actionHandler.processCommand(w,p),this.currentRoom.name==="Short Corridor"&&this.currentRoom.lockedExits.forward==="rps"&&(this.interactionState="rps_prompt"),this.displayMessage(h),this.updateStatusBars()}displayMessage(i,h=!0){this.gameOutput&&f(h?`> ${i}`:i)}updateStatusBars(){if(!this.player)return;const i=document.getElementById("healthBarFill"),h=document.getElementById("healthBarText"),m=document.getElementById("experienceBarFill"),w=document.getElementById("experienceBarText");if(i&&h){const p=Math.max(0,this.player.health/this.player.maxHealth*100);i.style.width=`${p}%`,h.textContent=`${this.player.health} / ${this.player.maxHealth}`}if(m&&w){const p=(this.player.level-1)*100,L=this.player.level*100,A=this.player.experience-p,$=L-p,S=$>0?Math.max(0,A/$*100):0;m.style.width=`${S}%`,w.textContent=`${this.player.experience} / ${L}`}}}function E(u){if(console.log(u.name+" character selected."),t&&d){const i=document.getElementById("playerDisplayImage"),m=document.querySelector(".portrait-grid.active").querySelector(".portrait-img.selected");i&&m&&(i.src=m.src,i.alt=m.alt),t.classList.remove("active"),d.classList.add("active")}v||(v=new C(u),O({commandInput:document.getElementById("commandInput"),mapButton:document.getElementById("mapButton"),inventoryButton:document.getElementById("inventoryButton"),statsButton:document.getElementById("statsButton"),helpButton:document.getElementById("helpButton"),gameInstance:v})),k&&k.focus()}j({startButton:e,selectMaleButton:a,selectFemaleButton:r,confirmCharacterButton:y,allPortraitImages:s,statTooltip:b,archetypeData:x,...{onStartGame:()=>{l&&t&&(l.classList.remove("active"),t.classList.add("active"))},onGenderSelected:u=>{s.forEach(i=>i.classList.remove("selected")),u==="Male"?(n.classList.add("active"),o.classList.remove("active"),n.children.length>0&&(n.children[0].classList.add("selected"),g=0)):(n.classList.remove("active"),o.classList.add("active"),o.children.length>0&&(o.children[0].classList.add("selected"),g=0))},onPortraitClicked:u=>{u.parentElement.querySelectorAll(".portrait-img").forEach(m=>m.classList.remove("selected")),u.classList.add("selected"),g=parseInt(u.dataset.index,10)},onConfirmCharacterClicked:()=>{if(g!==null&&x[g]){const u=x[g];E(u)}else alert("Please select a character."),console.error("No archetype selected or index out of bounds.")}}}),n.children.length>0&&(n.children[0].classList.add("selected"),g=0)});
