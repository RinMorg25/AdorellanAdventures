(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&a(r)}).observe(document,{childList:!0,subtree:!0});function t(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(n){if(n.ep)return;n.ep=!0;const o=t(n);fetch(n.href,o)}})();class c{constructor(e,t,a=!1,n=!0,o=!0,r=0){this.name=e,this.description=t,this.canTake=n,this.stackable=a,this.isUsable=o,this.isConsumed=!1,this.goldValue=r}use(e,t){if(!this.isUsable)return`The ${this.name} cannot be used.`;switch(this.name){case"torch":return this.useTorch(e,t);case"crystal":return this.useCrystal(e,t);case"sword":return this.useSword(e,t);case"key":return this.useKey(e,t);case"potion":return this.usePotion(e,t);case"leather vest":return this.useLeatherVest(e,t);case"piece of candy":return this.usePieceOfCandy(e,t);case"red apple":return this.useRedApple(e,t);case"large health potion":return this.useLargeHealthPotion(e,t);case"medium health potion":return this.useMediumHealthPotion(e,t);case"small health potion":return this.useSmallHealthPotion(e,t);case"blue feather":return this.useBlueFeather(e,t);default:return`You use the ${this.name}, but nothing happens.`}}useTorch(e,t){return"The torch illuminates the area, revealing hidden details in the shadows."}useCrystal(e,t){return"The crystal pulses with energy, and you feel your strength renewed."}useSword(e,t){return e.attack+=5,"You feel more confident with the sword in hand. Your attack power increases!"}useKey(e,t){return"The key fits perfectly into a hidden lock you discover on the wall."}usePotion(e,t){return e.health=Math.min(e.maxHealth,e.health+20),this.isConsumed=!0,"You drink the potion and feel refreshed. Your health is restored!"}useLeatherVest(e,t){return e.defense+=2,this.isConsumed=!0,"You put on the leather vest. It feels sturdy. Your defense increases!"}usePieceOfCandy(e,t){const a=Math.floor(Math.random()*20)+4;return e.gainExperience(a),this.isConsumed=!0,`You eat the piece of candy. It's surprisingly energizing! You gained ${a} experience points.`}useRedApple(e,t){return t.name==="The Vault"?"It seems to fit in the hollow of the tree carving on the vault door.":"You can't find a use for that here."}useLargeHealthPotion(e,t){const n=e.health;e.heal(35);const o=e.health-n;return this.isConsumed=!0,`You drink the large health potion and feel a powerful surge of vitality, restoring ${o} health. You now have ${e.health}/${e.maxHealth} health.`}useMediumHealthPotion(e,t){const n=e.health;e.heal(20);const o=e.health-n;return this.isConsumed=!0,`You drink the medium health potion, feeling a pleasant warmth spread through you. You restore ${o} health. You now have ${e.health}/${e.maxHealth} health.`}useSmallHealthPotion(e,t){const n=e.health;e.heal(15);const o=e.health-n;return this.isConsumed=!0,`You drink the small health potion and restore ${o} health. You now have ${e.health}/${e.maxHealth} health.`}useBlueFeather(e,t){return t.name==="The Vault"?"The feather seems to resonate with the empty nest carving on the vault door.":"You can't find a use for that here."}examine(){return this.description}}class Y{constructor(e,t,a,n,o=""){this.name=e,this.health=t,this.maxHealth=t,this.attack=a,this.defense=n,this.description=o,this.isAlive=!0,this.experienceValue=Math.floor(t/2)+a,this.loot=[]}takeDamage(e){const t=Math.max(1,e-this.defense);return this.health-=t,this.health=Math.max(0,this.health),this.health<=0&&(this.isAlive=!1),t}attackPlayer(e){let t,a=!1;return this.name==="Goblin"?(t=Math.floor(Math.random()*5)+1,t>=4&&(a=!0)):t=Math.floor(Math.random()*this.attack)+1,{damage:t,isCritical:a}}getAttackMessage(){const e=[`The ${this.name} lunges at you!`,`The ${this.name} strikes with fury!`,`The ${this.name} attacks viciously!`,`The ${this.name} bares its claws and attacks!`];return e[Math.floor(Math.random()*e.length)]}getDeathMessage(){const e=[`The ${this.name} falls to the ground, defeated.`,`The ${this.name} lets out a final roar and collapses.`,`The ${this.name} crumbles into dust.`,`The ${this.name} retreats into the shadows, defeated.`];return e[Math.floor(Math.random()*e.length)]}addLoot(e){this.loot.push(e)}dropLoot(){return this.loot}}const A=[{name:"Valerius",health:120,strength:12,dexterity:8,portrait:"./assets/images/male_portrait_1.png",description:"A stalwart warrior, trading speed for power and resilience."},{name:"Kaelan",health:100,strength:10,dexterity:12,portrait:"./assets/images/male_portrait_2.png",description:"A balanced fighter, quick on his feet and sharp with his blade."},{name:"Seraphina",health:90,strength:8,dexterity:15,portrait:"./assets/images/female_portrait_1.png",description:"A nimble rogue, whose swift strikes find any weakness."},{name:"Lyra",health:110,strength:14,dexterity:9,portrait:"./assets/images/female_portrait_2.png",description:"A fierce combatant, relying on overwhelming force to vanquish foes."}];class S{constructor(e,t,a,n){this.name=e,this.maxHealth=t,this.health=t,this.attack=a,this.defense=n,this.inventory=[],this.level=1,this.experience=0,this.isAlive=!0}addItem(e,t=1){if(!e.canTake)return;if(!e.stackable){for(let n=0;n<t;n++)this.inventory.push({item:e,quantity:1});return}const a=this.inventory.find(n=>n.item.name===e.name);a?a.quantity+=t:this.inventory.push({item:e,quantity:t})}removeItem(e,t=1){const a=this.inventory.findIndex(n=>n.item.name===e.name);if(a>-1){const n=this.inventory[a];return n.quantity-=t,n.quantity<=0&&this.inventory.splice(a,1),!0}return!1}hasItem(e){return this.inventory.some(t=>t.item.name.toLowerCase()===e.toLowerCase())}findItem(e){const t=this.inventory.find(a=>a.item.name.toLowerCase()===e.toLowerCase());return t?t.item:null}getInventoryList(){return this.inventory.length===0?"Your inventory is empty.":`You are carrying:
`+this.inventory.map(t=>t.quantity>1?`${t.item.name} (x${t.quantity})`:t.item.name).join(`
`)}getGold(){const e=this.inventory.find(t=>t.item.name==="gold coin");return e?e.quantity:0}spendGold(e){const t=this.inventory.find(a=>a.item.name==="gold coin");return!t||t.quantity<e?!1:(t.quantity-=e,t.quantity<=0&&(this.inventory=this.inventory.filter(a=>a.item.name!=="gold coin")),!0)}heal(e){this.health=Math.min(this.maxHealth,this.health+e)}takeDamage(e){const t=Math.max(0,e-this.defense);return this.health-=t,this.health<=0&&(this.health=0,this.isAlive=!1),t}gainExperience(e){this.experience+=e;const t=this.level*100;this.experience>=t&&this.levelUp()}levelUp(){this.level++,this.maxHealth+=10,this.attack+=2,this.defense+=1,this.health=this.maxHealth}}class R extends S{constructor(e,t,a,n,o,r,i=[]){super(e,t,a,n),this.description=o,this.dialogue=r,this.shopInventory=i}speak(e="default"){const t=e.toLowerCase(),a=this.dialogue[t]||this.dialogue.default;return a&&a.length>0?a[Math.floor(Math.random()*a.length)]:`${this.name} doesn't seem to have anything to say about that.`}}class H{constructor(e,t){this.name=e,this.description=t,this.exits={},this.items=[],this.monsters=[],this.npcs=[],this.visited=!1,this.lockedExits={}}setExit(e,t){this.exits[e]=t}setLockedExit(e,t,a="lockpick"){this.exits[e]=t,this.lockedExits[e]=a}addItem(e,t=1){if(!e.stackable){for(let n=0;n<t;n++)this.items.push({item:e,quantity:1});return}const a=this.items.find(n=>n.item.name===e.name);a?a.quantity+=t:this.items.push({item:e,quantity:t})}removeItem(e,t=1){const a=this.items.findIndex(n=>n.item.name===e.name);if(a>-1){const n=this.items[a];return n.quantity-=t,n.quantity<=0&&this.items.splice(a,1),!0}return!1}addMonster(e){this.monsters.push(e)}addNPC(e){this.npcs.push(e)}removeMonster(e){const t=this.monsters.indexOf(e);t>-1&&this.monsters.splice(t,1)}getDescription(e){this.visited=!0;let t=this.description;this.name==="The Vault"&&e&&e.hasItem("red apple")&&e.hasItem("blue feather")&&(t="A massive, circular iron door dominates one wall of this room. It is sealed shut with no obvious handle or lock. Finely etched into its surface is the depiction of a great tree, its branches heavy with what look like round fruit. A small, empty nest is tucked among the boughs, and a dark, fist-sized hollow is visible in the trunk. The entire etching now emits a strong pulse, almost like a heartbeat, bathing the room in a rhythmic purple glow.");let a=`${this.name}
${t}`;if(this.items.length>0){const o=this.items.map(r=>r.quantity>1?`${r.quantity}x ${r.item.name}`:r.item.name);a+=`

You see: ${o.join(", ")}`}this.monsters.length>0&&(a+=`

Creatures present: ${this.monsters.map(o=>o.name).join(", ")}`),this.npcs.length>0&&(a+=`

People here: ${this.npcs.map(o=>o.name).join(", ")}`);const n=Object.keys(this.exits);if(n.length>0){const o=n.map(r=>this.lockedExits[r]?`${r} (locked)`:r);a+=`

Exits: ${o.join(", ")}`}return a}hasExit(e){return this.exits.hasOwnProperty(e)}getExit(e){return this.exits[e]}unlockExit(e){if(this.lockedExits[e]){const t=this.exits[e],a=t.name;delete this.lockedExits[e];for(const n in t.exits)if(t.exits[n]===this){t.lockedExits[n]&&delete t.lockedExits[n];break}return`You've unlocked the exit to the ${a}!`}return`The exit to the ${this.exits[e].name} wasn't locked.`}}function D(){const s={smallHealthPotion:new c("small health potion","A small vial of green liquid that restores a minor amount of health.",!0,!0,!0),pieceOfCandy:new c("piece of candy","A piece of candy in a blue and purple wrapper. Restores a bit of energy.",!0,!0,!0),goldCoin:new c("gold coin","A shiny gold coin.",!0,!0,!1,1),potion:new c("potion","A healing potion, brewed by an unknown hand.",!0,!0,!0),mediumHealthPotion:new c("medium health potion","A vial of shimmering red liquid that restores a moderate amount of health.",!0,!0,!0),torch:new c("torch","A flickering torch that provides light in dark places.",!1,!0,!0),crystal:new c("crystal","A glowing blue crystal that pulses with mystical energy.",!1,!0,!0),sword:new c("sword","An ancient sword with mysterious runes etched into the blade.",!1,!0,!0),dentedHelmet:new c("dented helmet","A dented old helmet. Looks like it has seen many battles.",!1,!1,!1),lockpick:new c("lockpick","A set of lock picks, useful for opening locked doors.",!1,!0,!0),waterskin:new c("waterskin","A discarded waterskin, still half-full of clean water.",!1,!0,!0),writingDesk:new c("writing desk","A large, imposing writing desk made of dark wood.",!1,!1,!1),leatherVest:new c("leather vest","A simple vest made of hardened leather.",!1,!0,!0),fruitBowl:new c("fruit bowl","A well-stocked fruit bowl. It looks delicious.",!1,!1,!1),ornateCompass:new c("ornate compass","An ornate compass. The plaque in front of it reads: Stay and Explore.",!1,!0,!0),treasureChest:new c("treasure chest","A pocket-sized treasure chest. The plaque reads: For your grit & determination...",!1,!0,!0),specialJournal:new c("old journal","A small old leather journal, similar to the one that led you here.",!1,!1,!1),skeletonKey:new c("skeleton key","A key made from bone, said to open any locked chest.",!1,!0,!0)};s.specialJournal.onTakeFailMessage="This Adventure is not ready for you YET Brave Adventurer!";const e={entrance:{name:"The Glade",description:`After what feels like an eternity of pushing through an unforgiving, dense forest, the trees finally part. You step into a secluded glade, a place that feels untouched by time. The air is crisp, filled with the scent of damp earth and decaying leaves. A circle of towering trees, their leaves a brilliant tapestry of gold, crimson, and amber, stands as silent sentinels, walling this place off from the outside world. It's clear why this glade has remained hidden for so long.

Before you stands the true prize of your journey: the entrance to The Labyrinth of Lyre, Adorellan's most ancient and storied site. The entrance is formidable. Tall, ancient stone walls, grey and weathered with age, rise up to meet the sky. Set within these walls are thick, heavy wrought-iron gates, their surface pitted with rust and age. A dense curtain of thick, dark green vines chokes the gates, weaving through the bars so completely that nothing of the labyrinth beyond can be seen. The silence here is profound, broken only by the rustle of leaves under your feet.`},courtyard:{name:"The Garden of Grie",description:`With a final, desperate shove, the ancient iron gates groan in protest, their rusted hinges screaming as they reluctantly give way. You stumble forward, catching your balance on the cracked flagstones of a vast, open courtyard. The air here is still and heavy, carrying the scent of dust and forgotten time. With a brief look you notice the discarded remains of old camps and items that belonged to brave adventures long since forgotten.

In the centre of the courtyard, a once-grand fountain lies in ruins. Its stone basin shattered, and the statue that once stood proudly at its heart is now a toppled, moss-covered casualty of age. A trickle of dark, stagnant water weeps from a crack, pooling on the ground below.

Your eyes are drawn to the far side of the courtyard. Dominating the wall is a massive, intricate circular carving, its ancient design a complex web of interlocking lines and symbols that seem to writhe just at the edge of your vision. Flanking this mysterious emblem are two arched exits.

To the left, a sturdy iron gate, similar to the one you just forced open, blocks the archway, promising another challenge. To the right, the archway is filled with the splintered remains of a wooden door, hanging precariously from a single hinge, offering a seemingly easier, though perhaps more treacherous, path forward.`},bunkers:{name:"Bunker's Bend",description:"Rows of dusty, empty bunks line the walls of this large, cold room. It seems to have been abandoned long ago."},clinkers:{name:"Clinker's Armoury",description:"This chamber serves as a makeshift armoury. Racks of rusted weapons and dented armour line the walls. Most of it is useless, but some treasures may yet remain."},market:{name:"The Sunken Market",description:"You step into what was clearly once a bustling underground market. Broken stalls and scattered, worthless goods litter the floor. It seems you are the first to enter in a very long time."},marketCorridor:{name:"Short Corridor",description:"A short, narrow corridor. About halfway down, a sturdy-looking wooden door blocks the path forward. A strange inscription on the door depicts a hand, a stone, and some parchment. It seems to be a game of chance. Do you try your luck?"},bunkerHallway:{name:"Cluttered Hallway",description:"This hallway is cluttered with scattered bits and bobs left behind by previous inhabitants - tattered clothes, worthless trinkets, and other debris. It continues forward towards Bunker's Bend."},armouryHallway:{name:"Decrepit Hallway",description:"The splintered remains of a wooden door lead into this short, dusty hallway. It continues forward, where you can see the entrance to another chamber."},vault:{name:"The Vault",description:"A massive, circular iron door dominates one wall of this room. It is sealed shut with no obvious handle or lock. Finely etched into its surface is the depiction of a great tree, its branches heavy with what look like round fruit. A small, empty nest is tucked among the boughs, and a dark, fist-sized hollow is visible in the trunk. The entire etching glows with a faint, otherworldly purple light."},vaultHallway:{name:"Vault Hallway",description:"A short, sterile hallway with smooth stone walls. A simple revolving iron gate stands behind you, leading back to the market. Ahead, the hallway ends at the massive circular door of The Vault."},zHallway:{name:"Z-Shaped Hallway",description:"A cramped, narrow hallway that takes a sharp turn before continuing. The stone is cold and damp to the touch. One way leads towards the market, while the path behind you returns to the bunkers."},temple:{name:"The Forgotten Temple",description:"An eerie silence hangs in this grand temple. Faded murals on the walls depict forgotten gods."},safezone:{name:"Haven Shield",description:"The narrow corridor opens into a breathtaking, sun-dappled glade that feels entirely separate from the labyrinth. The walls are lined with ancient, towering trees, their leaves forming a dense canopy overhead. In the center of the glade is a serene, crystal-clear lake. On the far side of the lake stands a single, rustic-looking cabin. There are signs of others who have made it this far: the remnants of abandoned campfires and a discarded waterskin near the cabin's entrance."},grebs:{name:"Greb's Grotto",description:"This small, surprisingly cozy cavern is a chaotic mess of discarded adventuring gear. Piles of dented helmets, mismatched boots, and chipped shields are stacked against the walls. A small, friendly-looking red imp with large, curious eyes tends to a makeshift counter made from a large, flat rock. He seems to be sorting through a pile of rusty keys."},scriptorium:{name:"The Scriptorium",description:"You enter a large, almost grand chamber that feels like a sanctuary of knowledge. The walls are lined from floor to ceiling with towering shelves, heavy with ancient books, leather-bound tomes, and countless scrolls. In the center of the room, a large, imposing, writing desk stands beside a shorter shelf stacked high with fresh parchments and pots of ink. The air is still, carrying the faint scent of old paper and wax. Flickering lamps mounted on the walls cast a warm, dancing light across the room, making the shadows themselves seem to hold forgotten secrets."},chamber:{name:"The Mercurial Den",description:"A vast, circular chamber where the walls shimmer with thousands of luminescent crystals, casting a beautiful, eerie light."},grottoHallway:{name:"Cluttered Passageway",description:"A short passageway littered with discarded items - a broken lantern, a tattered cloak, and other adventuring debris. It seems to be a well-traveled route."},bendyHallway:{name:"Winding Corridor",description:"A long, winding corridor that bends out of sight. The air feels strangely calm and quiet here."},rockCrevice:{name:"Rock Crevice",description:"A narrow crevice in the rock face, almost hidden by overgrown vines. It looks like a tight squeeze."},hiddenCavern:{name:"Hidden Cavern",description:"The crevice opens into a small, damp cavern. A crude, heavy wooden door is set into the far wall."},windingPassage:{name:"Winding Passage",description:"Beyond the door is a long, winding passage carved from the rock. It slopes gently downwards and ends at another door, which looks like it can only be opened from this side."},cabin:{name:"The Cabin",description:`The interior of the cabin is a single, cluttered room. Pots and pans hang from the low ceiling, and shelves are crammed with a mix of food supplies—some look recently gathered, while others are long past their prime, hinting at a hurried or inconsistent inhabitant. A small fireplace sits to the left as you enter, with a small space cleared before it, A likely place where past adventurers have slept in safety and warmth.

A small wooden table with two chairs sits in the center of the room; a leather vest is slung carelessly over the back of one. A wall cabinet with a door hanging precariously from a single hinge reveals a surprisingly well-stocked fruit bowl. In the sink, a glint of something colorful inside a glass catches your eye.`},treasureRoom:{name:"The Treasure Room",description:`The room is filled with glittering piles of gold, ancient artifacts, and chests overflowing with jewels. You have found the legendary treasure of the Labyrinth of Lyre! 

In the centre of the room stands a large carved marble podium, atop it lay three objects with little plaques in front of them. To the left is an ornate compass, the plaques reads: Stay and Explore. To the right, a small old leather journal, similar to the one that led you here, sits on a plush blue cushion, its plaque states: Knowledge is Power. In the centre, proudly presented on its own little platform sits a pocket-sized Treasure chest. You look down at its plaque and read: For your grit & determination Brave Adventure. May all the treasures of Lyre ever be in your pocket. Congratulations you have won!

What do you do? Take the compass, and stay to explore, the treasure isn’t going anywhere, or take the chest and leave?`}},t=[{from:"entrance",to:"courtyard",direction:"forward",returnDirection:"back"},{from:"courtyard",to:"armouryHallway",direction:"right",returnDirection:"back"},{from:"armouryHallway",to:"clinkers",direction:"forward",returnDirection:"back"},{from:"courtyard",to:"bunkerHallway",direction:"left",returnDirection:"back",locked:!0},{from:"bunkerHallway",to:"bunkers",direction:"forward",returnDirection:"back"},{from:"clinkers",to:"marketCorridor",direction:"left",returnDirection:"back"},{from:"marketCorridor",to:"market",direction:"forward",returnDirection:"back",locked:"rps"},{from:"market",to:"temple",direction:"forward",returnDirection:"back"},{from:"temple",to:"scriptorium",direction:"left",returnDirection:"back"},{from:"scriptorium",to:"chamber",direction:"forward",returnDirection:"back"},{from:"market",to:"vaultHallway",direction:"right",returnDirection:"back"},{from:"vaultHallway",to:"vault",direction:"forward",returnDirection:"back"},{from:"vault",to:"treasureRoom",direction:"forward",returnDirection:"back",locked:"vault_puzzle"},{from:"market",to:"zHallway",direction:"left",returnDirection:"back"},{from:"bunkers",to:"zHallway",direction:"forward",returnDirection:"back",locked:!0,twoWayLock:!0},{from:"chamber",to:"grottoHallway",direction:"forward",returnDirection:"back"},{from:"grottoHallway",to:"grebs",direction:"forward",returnDirection:"back"},{from:"chamber",to:"bendyHallway",direction:"right",returnDirection:"back"},{from:"bendyHallway",to:"safezone",direction:"forward",returnDirection:"back"},{from:"safezone",to:"cabin",direction:"forward",returnDirection:"back",locked:"inspect_cabin"},{from:"safezone",to:"rockCrevice",direction:"right",returnDirection:"back"},{from:"rockCrevice",to:"hiddenCavern",direction:"forward",returnDirection:"back"},{from:"hiddenCavern",to:"windingPassage",direction:"forward",returnDirection:"back"},{from:"windingPassage",to:"temple",direction:"forward",oneWay:!0}],a={entrance:[{item:s.smallHealthPotion,quantity:1}],courtyard:[{item:s.torch,quantity:1}],chamber:[{item:s.crystal,quantity:1}],clinkers:[{item:s.sword,quantity:1},{item:s.dentedHelmet,quantity:1},{item:s.goldCoin,quantity:2}],armouryHallway:[{item:s.lockpick,quantity:1},{item:s.smallHealthPotion,quantity:1}],market:[{item:s.potion,quantity:1}],grottoHallway:[{item:s.potion,quantity:1}],safezone:[{item:s.waterskin,quantity:1}],bunkers:[{item:s.pieceOfCandy,quantity:1}],marketCorridor:[{item:s.pieceOfCandy,quantity:1}],bunkerHallway:[{item:s.pieceOfCandy,quantity:1},{item:s.goldCoin,quantity:1}],vaultHallway:[{item:s.pieceOfCandy,quantity:1}],zHallway:[{item:s.pieceOfCandy,quantity:1},{item:s.smallHealthPotion,quantity:1}],temple:[{item:s.pieceOfCandy,quantity:1},{item:s.goldCoin,quantity:4}],scriptorium:[{item:s.pieceOfCandy,quantity:1},{item:s.writingDesk,quantity:1},{item:s.goldCoin,quantity:2}],bendyHallway:[{item:s.pieceOfCandy,quantity:1},{item:s.smallHealthPotion,quantity:1}],hiddenCavern:[{item:s.goldCoin,quantity:4}],cabin:[{item:s.leatherVest,quantity:1},{item:s.pieceOfCandy,quantity:1},{item:s.fruitBowl,quantity:1},{item:s.goldCoin,quantity:2}],treasureRoom:[{item:s.ornateCompass,quantity:1},{item:s.treasureChest,quantity:1},{item:s.specialJournal,quantity:1}]},n={chamber:[new Y("Goblin",30,8,3,"A small, green creature with glowing red eyes.")]},o={grebs:[new R("Grebgela",50,0,5,"A small red imp with large, curious eyes. He fidgets with a collection of shiny trinkets on his makeshift counter, a wide, toothy grin spreading across his face when he notices you.",{default:["'Allo there, adventurer! Welcome to Greb's Grotto!","See anything you like? Just bits and bobs I find, but one person's junk is another imp's treasure, eh?"],keys:["Ah, these old things?","Just some rusty keys I found. None of 'em seem to fit anything important... yet!","Maybe you'll have better luck with them than I did!"],grotto:["It ain't much, but it's home! And it's full of wonderful junk!","A bit messy, I know. I call it 'organized chaos'!"],shop:["Everything here is for sale, friend! If you've got the coin, I've got the... well, the 'stuff'!","Just 'list' what I've got, or 'buy [item name]' if you see something you fancy!"]},[{item:s.skeletonKey,price:50},{item:s.mediumHealthPotion,price:15}])]},r={};for(const i in e)r[i]=new H(e[i].name,e[i].description);for(const i of t){const l=r[i.from],f=r[i.to];i.locked?l.setLockedExit(i.direction,f,i.locked):l.setExit(i.direction,f),i.oneWay||(i.twoWayLock?f.setLockedExit(i.returnDirection,l,i.locked):f.setExit(i.returnDirection,l))}for(const i in a)a[i].forEach(l=>{r[i].addItem(l.item,l.quantity)});for(const i in n)n[i].forEach(l=>r[i].addMonster(l));for(const i in o)o[i].forEach(l=>r[i].addNPC(l));return{startRoom:r.entrance,rooms:r}}class M{constructor(e){this.game=e,this.mercurialDenStates=[{description:"You seem to be stood in the centre of a small island of calm. Here, an armchair, a side table, and a lamp rest on a worn rug, creating a single point of order in a room that has otherwise exploded into a chaos of costumes. Gowns, glittering jewellery, feather boas, and masks are strewn everywhere, spilling from wardrobes and covering every available surface in a colourful, cluttered mess.",items:()=>[new c("coin purse","A small, heavy leather purse.",!1,!1),new c("blue feather hand fan","An elegant hand fan made with large, deep blue feathers.",!1,!1),new c("medium health potion","A vial containing a swirling, red liquid.",!0,!0),new c("piece of candy","A piece of candy in a blue and purple wrapper.",!0,!0)]},{description:`The air grows damp and earthy as you push through a curtain of thick, hanging moss. You enter a cavern that glows with an eerie, beautiful light. The entire room is a forest of fungi, towering mushrooms, some as tall as trees, form a canopy of pulsating, bioluminescent caps in shades of deep blue, vibrant purple, and sickly green. The ground is a soft, springy carpet of white mycelium that muffles your footsteps. The air hums with a low, resonant frequency, and the only other sound is the slow drip-drip-drip of condensation falling from the giant caps onto smaller mushroom clusters below.
                In the centre of the room, a ring of flat-topped, waist-high toadstools are arranged like chairs around a single, petrified stump that serves as a table. Upon this stump sits a half-finished game of chess, but the pieces are carved from different-coloured mushrooms.
                Near the far wall, a small waterfall of phosphorescent slime trickles down the rock face into a crystal-clear pool, illuminating a skeleton lying at the bottom, its bony arms wrapped around a heavy-looking chest.`,items:()=>[new c("singing stone","A smooth, grey stone that vibrates gently.",!0,!0),new c("Iron-Skin Fungi","A small cluster of bright orange mushrooms growing on the petrified stump.",!0,!0)]},{description:"You are in a large, circular chamber filled with warm, humid steam. The room now seems to be a bathhouse, with walls and floors made of smooth, colorful tiles. In the center, a natural geyser is capped with an intricate bronze grille. Every minute or so, it erupts with a gentle whoosh, sending a plume of clean, hot water into a series of stone basins and pools around the room. The walls are covered in mosaics depicting krakens, mermen, and other aquatic creatures enjoying a spa day. The air smells of sulfur and lavender soap.",items:()=>[]},{description:'The room is a disaster. It was clearly once a makeshift, low-rent casino run by goblins. A roulette wheel made from a painted shield lies on its side, a card table is covered in crude, goblin-drawn cards depicting leering faces, and a "slot machine" built from scrap metal, gears, and a large bear trap for a lever stands in the corner. The floor is sticky with spilled grog, and the air smells of rust and disappointment.',items:()=>[new c("large health potion","A large, bubbling potion in a sturdy flask. It looks potent.",!0,!0),new c("sticky leather pouch","A small, greasy coin pouch bound with rotting twine. It looks like it was left in the coin return of the busted slot machine.",!1,!1)]},{description:"What a breathtaking sight! You are in a cavernous chamber, but you stand like a giant overlooking a miniature, bustling city that covers a massive, table-like plateau in the centre of the room. Tiny, perfect cobblestone streets, multi-story buildings, and a grand castle are all laid out below. The city is alive with the movement of thousands of tiny, inch-tall figures going about their day. A tiny river of actual, flowing water bisects the city, crossed by delicate arching bridges. The only sounds are the faint, collective hum of the city's mechanisms and the drip of water from a distant stalactite.",items:()=>[]},{description:"You enter a long, quiet hall lined with featureless, humanoid statues carved from pale, smooth stone. As you draw near a statue, it shimmers, and a memory plays out across its surface like a silent film projection: a soldier's tearful farewell, a scholar's moment of discovery, a thief's narrow escape. The memories are silent but emotionally potent. The air is still and carries the faint scent of dust and forgotten tears.",items:()=>[]}],this.commands={go:this._handleMovement,look:this._handleLook,inspect:this._handleInspect,search:this._handleSearch,take:this._handleTake,use:this._handleUse,drop:this._handleDrop,attack:this._handleBattle,fight:this._handleBattle,battle:this._handleBattle,flee:this._handleFlee,left:this._handleMovement,right:this._handleMovement,forward:this._handleMovement,back:this._handleMovement,pick:this._handlePick,help:this._handleHelp,play:this._handlePlay,talk:this._handleTalk,list:this._handleList,buy:this._handleBuy,inventory:this._handleInventory,inv:this._handleInventory,i:this._handleInventory,stats:this._handleStats,status:this._handleStats,st:this._handleStats}}processCommand(e,t){const a=this.commands[e];return a?["left","right","forward","back"].includes(e)?a.call(this,e):a.call(this,t):"I don't understand that command. Try 'help' to see a list of available commands."}_findInList(e,t){if(!e||!t||t.length===0)return null;const a=e.toLowerCase();let n=t.find(o=>o.name.toLowerCase()===a);return n||t.find(o=>o.name.toLowerCase().includes(a))}_findItemStack(e,t){if(!e||!t||t.length===0)return null;const a=e.toLowerCase();let n=t.find(o=>o.item.name.toLowerCase()===a);return n||t.find(o=>o.item.name.toLowerCase().includes(a))}_changeMercurialDen(){const e=this.game.worldMap.chamber,t=this.mercurialDenStates.length;if(t<=1)return;const a=this.game.gameStateFlags.mercurialDenStateIndex;let n;do n=Math.floor(Math.random()*t);while(n===a);this.game.gameStateFlags.mercurialDenStateIndex=n;const o=this.mercurialDenStates[n];e.description=o.description,e.items=[],o.items().forEach(r=>e.addItem(r))}_handleMovement(e){if(!["forward","back","left","right"].includes(e))return"You can only move in these directions: forward, back, left, right.";let a=null;const n=this.game.currentRoom;if(e==="back")if(this.game.roomHistory.length>0)a=this.game.roomHistory.pop();else return"You can't go back any further.";else if(a=this.game.currentRoom.getExit(e),a&&this.game.currentRoom.lockedExits[e])return"That way is locked.";if(!a)return`You cannot go ${e} from here.`;if(e!=="back"&&this.game.roomHistory.push(this.game.currentRoom),this.game.currentRoom=a,this.game.currentRoom.name==="The Mercurial Den"&&this.game.gameStateFlags.mercurialDenActive&&this._changeMercurialDen(),this.game.currentRoom.name==="The Forgotten Temple"&&n.name==="Winding Passage"){const i=this.game.currentRoom,l=this.game.worldMap.market,f=this.game.worldMap.scriptorium;for(const y in i.exits)delete i.exits[y];for(const y in i.lockedExits)delete i.lockedExits[y];i.setExit("left",l),i.setExit("right",f),i.setLockedExit("back",n,!0)}return`${e==="back"?"You go back.":`You move ${e}.`}

${this.game.currentRoom.getDescription(this.game.player)}`}_handleLook(e){return e?`To examine something specific, try 'inspect ${e}'.`:this.game.currentRoom.getDescription(this.game.player)}_handleInspect(e){if(!e)return"What do you want to inspect?";const t=this._findItemStack(e,this.game.currentRoom.items),a=t?t.item:null;if(a){const r=a.name.toLowerCase(),i=this.game.currentRoom.name;if(i==="The Mercurial Den"){if(r==="coin purse"){const l=new c("gold coin","A shiny gold coin.",!0,!0,!1,1);return this.game.currentRoom.removeItem(a),this.game.currentRoom.addItem(l,4),"You open the purse and find four gold coins inside."}if(r==="blue feather hand fan")return this.game.currentRoom.removeItem(a),this.game.currentRoom.addItem(new c("blue feather","A vibrant blue feather that seems to hum with a faint energy.",!1,!0,!0)),"You pick up the hand fan for a closer look. As you handle it, one of the feathers comes loose and falls onto the chair. It seems to have a faint blue glow about it. The rest of the fan feels mundane.";if(r==="sticky leather pouch"){const l=new c("gold coin","A shiny gold coin.",!0,!0,!1,1);return this.game.currentRoom.removeItem(a),this.game.currentRoom.addItem(l,13),"You untie the rotting twine on the greasy pouch. It falls apart in your hands, revealing 13 gold coins!"}}if(i==="Clinker's Armoury"&&r==="dented helmet"){if(this.game.gameStateFlags.foundHelmetPotion)return"It's just an old, dented helmet. You've already checked it.";{this.game.gameStateFlags.foundHelmetPotion=!0;const l=new c("medium health potion","A vial containing a swirling, red liquid.",!0,!0);return this.game.currentRoom.addItem(l),"You peer inside the dented helmet and find a medium health potion tucked away inside the padding. Lucky find!"}}if(i==="The Scriptorium"&&r==="writing desk"){if(this.game.gameStateFlags.foundDeskPotion)return"A large, imposing writing desk. You've already checked it.";{this.game.gameStateFlags.foundDeskPotion=!0;const l=new c("medium health potion","A vial containing a swirling, red liquid.",!0,!0);return this.game.currentRoom.addItem(l),"You rummage through the drawers of the writing desk. Tucked away beneath some old parchments, you discover a medium health potion."}}if(i==="The Cabin"&&r==="fruit bowl"){this.game.currentRoom.removeItem(a);const l=new c("red apple","A shiny red apple that emits a faint, warm glow.",!0,!0);return this.game.currentRoom.addItem(l),"you empty the fruit bowl on to the table. It holds 3 peaches, 2 bananas, a bushel of green grapes, 1 kiwi and a red apple that seems to have a faint glow about it."}return a.examine()}if(this.game.currentRoom.name==="Haven Shield"&&e.toLowerCase()==="cabin")return this.game.currentRoom.lockedExits.forward==="inspect_cabin"&&this.game.currentRoom.unlockExit("forward"),"You approach the rustic cabin. The wooden planks are weathered but sturdy. You notice the door is slightly ajar, inviting you to go forward.";const n=this._findInList(e,this.game.currentRoom.monsters);if(n)return n.description;const o=this._findInList(e,this.game.currentRoom.npcs);return o?o.description:`You don't see a ${e} here to inspect.`}_handleSearch(){const e=this.game.currentRoom.items,t=this.game.currentRoom.monsters;let a=`You search the area carefully...

`;e.length>0&&(a+="You find: "+e.map(o=>o.name).join(", ")+`
`),t.length>0&&(a+="You notice: "+t.map(o=>o.name).join(", ")+`
`);const n=this.game.currentRoom.npcs;return n.length>0&&(a+="You see: "+n.map(o=>o.name).join(", ")+`
`),e.length===0&&t.length===0&&n.length===0&&(a+="You find nothing of interest."),a}_handleTake(e){if(!e)return"What do you want to take?";const t=e.toLowerCase().split(" ");let a=1,n=e.trim();if(t[0]==="all")a="all",n=t.slice(1).join(" ").trim();else if(!isNaN(parseInt(t[0],10))){const u=parseInt(t[0],10);if(u<=0)return"You must take a positive number of items.";a=u,n=t.slice(1).join(" ").trim()}if(!n)return"What do you want to take?";if(n==="gold"||n==="gold coin"||n==="coins"){const u=this.game.currentRoom.items.filter(m=>m.item.goldValue>0);if(u.length===0)return"There is no gold here.";let k=0;const v=u.find(m=>m.item.name==="gold coin")?.item||new c("gold coin","A shiny gold coin.",!0,!0,!1,1);return u.forEach(m=>{k+=m.item.goldValue*m.quantity}),this.game.currentRoom.items=this.game.currentRoom.items.filter(m=>!m.item.goldValue||m.item.goldValue<=0),this.game.player.addItem(v,k),`You scoop up all the gold, adding ${k} coins to your pouch. You now have ${this.game.player.getGold()} gold.`}const o=this._findItemStack(n,this.game.currentRoom.items);if(!o)return`There is no ${n} here.`;const r=o.item,i=o.quantity,l=a==="all"?i:Math.min(a,i),f=r.name.toLowerCase(),y=this.game.currentRoom.name;if(f==="crystal"&&y==="The Mercurial Den")return this.game.player.addItem(r,1),this.game.currentRoom.items=this.game.currentRoom.items.filter(u=>u!==o),this.game.gameStateFlags.mercurialDenActive=!0,this.game.gameStateFlags.mercurialDenStateIndex=-1,"You take the glowing crystal. As your fingers touch it, the air in the chamber hums and the other crystals on the walls flare with a blinding light. You feel a strange, disorienting energy wash over you. The room seems to settle, but you have a feeling it will not remain the same.";if(f==="treasure chest"&&y==="The Treasure Room"){const u=document.getElementById("gameplayScreen"),k=document.getElementById("endGameScreen"),v=document.getElementById("playAgainButton");return u&&k&&v&&(u.classList.remove("active"),k.classList.add("active"),v.addEventListener("click",()=>location.reload(),{once:!0}))," "}return f==="ornate compass"&&y==="The Treasure Room"?(this.game.player.addItem(r,1),this.game.currentRoom.items=this.game.currentRoom.items.filter(u=>u!==o),this.game.gameStateFlags.hasOrnateCompassQuest=!0,"You take the ornate compass. It feels warm to the touch and the needle spins wildly for a moment before settling. You feel a sense of new purpose, as if unseen paths are now open to you. The treasure can wait; adventure calls."):r.canTake?r.goldValue&&r.goldValue>0?(this.game.player.addItem(r,l),o.quantity-=l,o.quantity<=0&&(this.game.currentRoom.items=this.game.currentRoom.items.filter(u=>u!==o)),`You take ${l} ${r.name}(s). You now have ${this.game.player.getGold()} gold.`):(this.game.player.addItem(r,l),o.quantity-=l,o.quantity<=0&&(this.game.currentRoom.items=this.game.currentRoom.items.filter(u=>u!==o)),l>1?`You take ${l} ${r.name}s.`:`You take the ${r.name}.`):r.onTakeFailMessage||`You cannot take the ${r.name}.`}_handleUse(e){const t=this.game.player,a=this.game.currentRoom,n=this._findItemStack(e,t.inventory);if(n){const o=n.item;if(a.name==="The Vault"){if(o.name.toLowerCase()==="red apple"&&t.hasItem("blue feather")&&a.lockedExits.forward==="vault_puzzle")return t.removeItem(o),this.game.gameStateFlags.vaultAppleUsed=!0,"You notice the image changing, the fruits, now clearer, hanging on the tree are indeed big red apples.";if(o.name.toLowerCase()==="blue feather"&&this.game.gameStateFlags.vaultAppleUsed){t.removeItem(o),a.unlockExit("forward");const i="You watch as a small blue bird flits from the nest. The door gives one final pulse of light, and begins to shift and spiral open from the center, towards its outer frame, revealing a single simple stained glass door.";return a.description=i,this.game.gameStateFlags.vaultAppleUsed=!1,i}}const r=o.use(t,a);return o.isConsumed&&(t.removeItem(o,1),this.game.updateStatusBars()),r}return`You don't have a ${e}.`}_handleDrop(e){const t=this._findItemStack(e,this.game.player.inventory),a=t?t.item:null;return a?(this.game.player.removeItem(a,1),this.game.currentRoom.addItem(a,1),`You drop the ${e}.`):`You don't have a ${e} to drop.`}_handleBattle(e){let t;return e?t=this._findInList(e,this.game.currentRoom.monsters):this.game.currentRoom.monsters.length>0&&(t=this.game.currentRoom.monsters[0]),t?this.game.battleSystem.startBattle(this.game.player,t):"There is nothing to fight here, or no specific target mentioned."}_handleFlee(){return"You look around nervously, but there is no immediate danger to flee from."}_handlePick(e){if(!e)return"Which exit do you want to try and pick?";if(this.game.player.hasItem("lockpick")){const t=this.game.currentRoom.exits[e];return t&&this.game.currentRoom.lockedExits[e]?this.game.currentRoom.unlockExit(e):t?"That exit isn't locked.":"There's no exit in that direction."}return"You don't have any lock picks!"}_handlePlay(e){if(!e)return"What do you want to play? Try 'play rock', 'play paper', or 'play scissors'.";const t=["rock","paper","scissors"],a=e.toLowerCase();if(!t.includes(a))return`You can't play '${e}'. Try rock, paper, or scissors.`;let n=null;for(const i in this.game.currentRoom.lockedExits)if(this.game.currentRoom.lockedExits[i]==="rps"){n=i;break}if(!n)return"There's nothing here to play a game with.";const o=t[Math.floor(Math.random()*t.length)];let r=`You play ${a}. The door seems to respond, projecting an image of a ${o}.

`;return a===o?r+="It's a draw! The door remains locked. Try again.":a==="rock"&&o==="scissors"||a==="paper"&&o==="rock"||a==="scissors"&&o==="paper"?(r+="You win! With a grinding sound, the lock on the door retracts.",this.game.currentRoom.unlockExit(n)):r+="You lose! The door remains stubbornly shut.",r}_handleTalk(e){if(!e)return"Who do you want to talk to?";let t=e.toLowerCase();t.startsWith("to ")&&(t=t.substring(3).trim());const a=t.split(" about "),n=a[0].trim(),o=a.length>1?a[1].trim():"default",r=this._findInList(n,this.game.currentRoom.npcs);return r?r.speak(o):`There is no one named '${n}' here to talk to.`}_handleList(){const e=this.game.currentRoom.npcs.find(a=>a.shopInventory&&a.shopInventory.length>0);if(!e)return"There is no one here to buy from.";if(e.shopInventory.length===0)return`${e.name} has nothing for sale right now.`;let t=`<strong>--- ${e.name}'s Wares ---</strong>

`;return e.shopInventory.forEach(a=>{t+=`- ${a.item.name} (${a.price} gold): ${a.item.description}
`}),t+=`
You have ${this.game.player.getGold()} gold.`,t+=`
(Type 'buy [item name]' to purchase)`,t}_handleBuy(e){if(!e)return"What would you like to buy?";const t=this.game.currentRoom.npcs.find(r=>r.shopInventory&&r.shopInventory.length>0);if(!t)return"There is no one here to buy from.";const a=e.toLowerCase();let n=t.shopInventory.find(r=>r.item.name.toLowerCase()===a);if(n||(n=t.shopInventory.find(r=>r.item.name.toLowerCase().includes(a))),!n)return`${t.name} doesn't have a "${e}" for sale.`;const o=this.game.player.getGold();return o<n.price?`You don't have enough gold. You need ${n.price} gold, but you only have ${o}.`:this.game.player.spendGold(n.price)?(this.game.player.addItem(n.item),t.shopInventory=t.shopInventory.filter(r=>r.item.name.toLowerCase()!==n.item.name.toLowerCase()),`You bought the ${n.item.name} for ${n.price} gold. You have ${this.game.player.getGold()} gold left.`):"An unknown error occurred during your purchase."}_handleInventory(){let e=this.game.player.getInventoryList();return e+=`

Gold: ${this.game.player.getGold()}`,e}_handleStats(){const e=this.game.player,t=e.level*100;let a=`<strong>--- ${e.name}'s Stats ---</strong>

`;return a+=`Level: ${e.level}
`,a+=`Experience: ${e.experience}/${t}
`,a+=`Health: ${e.health}/${e.maxHealth}
`,a+=`Attack: ${e.attack}
`,a+=`Defense: ${e.defense}`,a}_handleHelp(){return`<strong>--- Help: Available Commands ---</strong>

`+["<strong>go [direction]</strong>: Move between rooms. Valid directions are 'forward', 'back', 'left', and 'right'. You can also type a direction by itself (e.g., 'left').","<strong>look</strong>: Get a description of your current location.","<strong>inspect [object/monster]</strong>: Examine a specific object or monster in the room.","<strong>search</strong>: Search the room for any items or hidden things.","<strong>take [item]</strong>: Add an item from the room to your inventory.","<strong>drop [item]</strong>: Remove an item from your inventory and leave it in the room.","<strong>use [item]</strong>: Use an item from your inventory. Some items have special effects.","<strong>inventory (or inv, i)</strong>: Check the items you are carrying.","<strong>stats (or status, st)</strong>: Check your character's current stats.","<strong>pick [direction]</strong>: Attempt to pick a locked door in a given direction (e.g., 'pick left'). This requires a 'lockpick' in your inventory.","<strong>attack [monster]</strong>: Engage in combat with a monster.","<strong>flee</strong>: Attempt to run away from a battle.","<strong>play [choice]</strong>: Play a game of chance when prompted (e.g., 'play rock').","<strong>talk to [person]</strong> or <strong>talk to [person] about [topic]</strong>: Speak to a friendly character.","<strong>list</strong>: Shows items for sale if a shopkeeper is present.","<strong>buy [item]</strong>: Purchase an item from a shopkeeper."].join(`

`)}}class q{constructor(){this.inBattle=!1,this.currentEnemy=null,this.battleLog=[]}startBattle(e,t){this.inBattle=!0,this.currentEnemy=t,this.battleLog=[];let a=`
=== BATTLE BEGINS ===
`;return a+=`You face the ${t.name}!
`,a+=`${t.description}

`,a+=this.getBattleStatus(e,t),a+=`
What will you do? (attack, flee, use [item])`,a}processBattleTurn(e,t,a,n=null){if(!this.inBattle)return"You are not in battle.";let o="";switch(a){case"attack":o+=this.playerAttack(e,t),t.isAlive&&(o+=`
`+this.monsterAttack(e,t));break;case"flee":o+=this.attemptFlee(e,t);break;case"use":o+=this.useItemInBattle(e,n),t.isAlive&&(o+=`
`+this.monsterAttack(e,t));break;default:o="Invalid battle action. Try: attack, flee, or use [item]"}return t.isAlive?e.isAlive()?o+=`

`+this.getBattleStatus(e,t):o+=`
`+this.endBattle(e,t,"defeat"):o+=`
`+this.endBattle(e,t,"victory"),o}playerAttack(e,t){const a=Math.floor(Math.random()*13)+1;let n,o=!1;if(a>9){o=!0;let l=11+(e.level-1)*2;l=Math.min(l,18);const f=10;n=Math.floor(Math.random()*(l-f+1))+f}else n=a;const r=t.takeDamage(n);let i="";return o?i=`Critical Hit! You strike the ${t.name} for ${r} damage!`:i=`You strike the ${t.name} for ${r} damage!`,t.isAlive||(i+=`
`+t.getDeathMessage()),i}monsterAttack(e,t){const a=t.attackPlayer(e),n=e.takeDamage(a.damage);let o=t.getAttackMessage();return a.isCritical&&(o+=" Critical Hit!"),o+=`
The ${t.name} hits you for ${n} damage!`,e.isAlive()||(o+=`
You have been defeated!`),o}attemptFlee(e,t){if(Math.random()>.3)return this.endBattle(e,t,"flee"),"You successfully flee from the battle!";{let n="You failed to escape!";return n+=`
`+this.monsterAttack(e,t),n}}useItemInBattle(e,t){const a=e.getItem(t);if(!a)return`You don't have a ${t}.`;let n=a.use(e,null);return a.isConsumed&&e.removeItem(a),n}getBattleStatus(e,t){let a=`--- Battle Status ---
`;return a+=`Your Health: ${e.health}/${e.maxHealth}
`,a+=`${t.name} Health: ${t.health}/${t.maxHealth}`,a}endBattle(e,t,a){this.inBattle=!1,this.currentEnemy=null;let n=`
=== BATTLE END ===
`;switch(a){case"victory":const o=t.experienceValue;e.gainExperience(o),n+=`Victory! You gained ${o} experience points.`;const r=t.dropLoot();r.length>0&&(n+=`
The ${t.name} dropped: `,n+=r.map(i=>i.name).join(", "),r.forEach(i=>e.addItem(i)));break;case"defeat":n+="You have been defeated! Game Over.";break;case"flee":n+="You escaped from the battle.";break}return n}}class _{constructor(e,t){this.game=e,this.appendText=t}displayMap(){let e=`--- Location ---

`;e+=`Your current location is the ${this.game.currentRoom.name}. `;const t=Object.keys(this.game.currentRoom.exits);if(t.length>0){const a=t.map(n=>{const o=this.game.currentRoom.exits[n].name,r=this.game.currentRoom.lockedExits[n];return`${n} to ${o}${r?" (locked)":""}`});e+="Exits: "+a.join(", ")+`
`}else e+=`No obvious exits from here.
`;this.appendText(e)}displayInventory(){let e=`--- Inventory ---

`;this.game.player.inventory.length===0?e+="Your inventory is empty.":(e+=`You are carrying:
`,this.game.player.inventory.forEach(t=>{e+=`- ${t.name}: ${t.examine()}
`})),this.appendText(e)}displayStats(){const e=this.game.player.getStats(),t=e.level*100,a={Name:e.name,Level:e.level,Health:`${e.health} / ${e.maxHealth}`,Attack:e.attack,Defense:e.defense,Experience:`${e.experience} / ${t}`,Gold:e.gold},n=`--- Character Stats ---

`+Object.entries(a).map(([o,r])=>`${o}: ${r}`).join(`
`);this.appendText(n)}}function P(s,e,t,a){s.forEach(n=>{const o=parseInt(n.dataset.index,10);n.addEventListener("click",()=>{a(n)}),n.addEventListener("mouseenter",r=>{const i=e[o];i&&(t.innerHTML=`
                    <strong>${i.name}</strong><br>
                    Health: ${i.health}<br>
                    Strength: ${i.strength}<br>
                    Dexterity: ${i.dexterity}<br>
                    Agility: ${i.agility}<br>
                    Intelligence: ${i.intelligence}<br>
                    Charisma: ${i.charisma}`,t.style.left=r.pageX+15+"px",t.style.top=r.pageY+15+"px",t.style.display="block")}),n.addEventListener("mouseleave",()=>{t.style.display="none"}),n.addEventListener("mousemove",r=>{t.style.display==="block"&&(t.style.left=r.pageX+15+"px",t.style.top=r.pageY+15+"px")})})}function G({startButton:s,selectMaleButton:e,selectFemaleButton:t,confirmCharacterButton:a,allPortraitImages:n,statTooltip:o,archetypeData:r,onStartGame:i,onGenderSelected:l,onPortraitClicked:f,onConfirmCharacterClicked:y}){s&&s.addEventListener("click",i),e&&e.addEventListener("click",()=>l("Male")),t&&t.addEventListener("click",()=>l("Female")),a&&a.addEventListener("click",y),P(n,r,o,f)}document.addEventListener("DOMContentLoaded",()=>{const s=document.getElementById("titleScreen"),e=document.getElementById("startButton"),t=document.getElementById("characterSelectionScreen"),a=document.getElementById("selectMaleButton"),n=document.getElementById("selectFemaleButton"),o=document.getElementById("malePortraits"),r=document.getElementById("femalePortraits"),i=document.querySelectorAll(".portrait-img"),l=document.getElementById("gameplayScreen"),f=document.getElementById("confirmCharacterButton"),y=document.getElementById("commandInput"),u=document.createElement("div");u.id="statTooltip",u.classList.add("tooltip"),document.body.appendChild(u);const k=document.getElementById("gameOutput"),v=document.querySelector(".output-text-container");function m(g){const h=g.replace(/\n/g,"<br>");k.innerHTML+=`<p>${h}</p>`,v.scrollTop=v.scrollHeight}let x=null,b=0;class ${constructor(h){if(this.currentRoom=null,this.worldMap={},this.roomHistory=[],this.gameState="pre-start",this.interactionState=null,this.gameStateFlags={},this.player=new S(h||"Player",100,10,5),typeof h=="object"&&h!==null&&h.name){this.player=new S(h.name,h.health,h.strength,h.dexterity);const d=new c("gold coin","A shiny gold coin.",!0,!0,!1,1);this.player.addItem(d,25)}this.battleSystem=new q,this.commandInput=document.getElementById("commandInput"),this.gameOutput=document.getElementById("gameOutput"),this.mapButton=document.getElementById("mapButton"),this.inventoryButton=document.getElementById("inventoryButton"),this.statsButton=document.getElementById("statsButton"),this.helpButton=document.getElementById("helpButton"),this.actionHandler=new M(this),this.displayManager=new _(this,m),this.initializeGame(),this.updateStatusBars()}initializeGame(){const h=D();this.worldMap=h.rooms,this.currentRoom=h.startRoom,this.gameState="intro",this.gameOutput&&(m("In the shadowed alleys of the local bazaar, amidst discarded trinkets and whispered secrets, you find it: a tattered journal, its leather cover cracked with age. The pages are brittle, stained, and filled with a frantic, faded script. It speaks of a place of legend, Adorellan's most ancient site—the Labyrinth of Lyre."),m("The author writes of unimaginable treasure and riches waiting in its depths, but also of a challenge that has broken all who came before. It is a legendary, dangerous place, where the very walls are said to test the sanity of those who walk them."),m("Beyond the promise of gold, the journal hints at a greater prize: the chance to uncover lost knowledge and solve a mystery buried for millennia. The final entries are a scrawl of fear and regret, a tale of an expedition lost to the darkness."),m("The last legible line is not a plea, but a direct challenge that seems to lift from the page and settle upon you:"),m("<strong>Will you succeed where they have failed?</strong>"),m("<em>Type 'venture forth' to begin your adventure, or 'give up' to walk away.</em>"),this.updateStatusBars())}processCommand(h){let d="";if(this.interactionState==="rps_prompt"){h==="yes"||h==="try my luck"?(this.interactionState="rps_choice",d="You decide to test your fate. What do you play? (rock, paper, or scissors)"):h==="no"?(this.interactionState=null,d=this.actionHandler._handleMovement("back")):d="A simple 'yes' or 'no' will suffice.",this.displayMessage(d),this.updateStatusBars();return}if(this.interactionState==="rps_choice"){["rock","paper","scissors"].includes(h)?(d=this.actionHandler._handlePlay(h),d.includes("You win!")&&(this.interactionState=null)):d="That's not a valid move. Choose rock, paper, or scissors.",this.displayMessage(d),this.updateStatusBars();return}if(this.gameState==="intro"){h==="venture forth"?(this.gameState="playing",d=`You steel your resolve and step towards the Labyrinth of Lyre.

${this.currentRoom.getDescription(this.player)}`):h==="give up"?(this.gameState="ended",d="You close the journal, the challenge unanswered. The Labyrinth will wait for another hero. You turn and walk away.",this.commandInput.disabled=!0):d="The choice is before you. Will you 'venture forth' or 'give up'?",this.displayMessage(d),this.updateStatusBars();return}const p=h.split(" "),I=p[0],w=p.slice(1).join(" ");this.battleSystem.inBattle?this.battleSystem.currentEnemy?(d=this.battleSystem.processBattleTurn(this.player,this.battleSystem.currentEnemy,I,w),!this.battleSystem.inBattle&&this.battleSystem.currentEnemy&&!this.battleSystem.currentEnemy.isAlive&&this.currentRoom.removeMonster(this.battleSystem.currentEnemy)):(d="Error: In battle but no current enemy defined. Exiting battle mode.",this.battleSystem.inBattle=!1):this.gameState==="ended"?d="The adventure is over.":d=this.actionHandler.processCommand(I,w),this.currentRoom.name==="Short Corridor"&&this.currentRoom.lockedExits.forward==="rps"&&(this.interactionState="rps_prompt"),this.displayMessage(d),this.updateStatusBars()}displayMessage(h,d=!0){this.gameOutput&&m(d?`> ${h}`:h)}updateStatusBars(){if(!this.player)return;const h=document.getElementById("healthBarFill"),d=document.getElementById("healthBarText"),p=document.getElementById("experienceBarFill"),I=document.getElementById("experienceBarText");if(h&&d){const w=Math.max(0,this.player.health/this.player.maxHealth*100);h.style.width=`${w}%`,d.textContent=`${this.player.health} / ${this.player.maxHealth}`}if(p&&I){const w=(this.player.level-1)*100,T=this.player.level*100,E=this.player.experience-w,C=T-w,B=C>0?Math.max(0,E/C*100):0;p.style.width=`${B}%`,I.textContent=`${this.player.experience} / ${T}`}}}function L(g){if(console.log(g.name+" character selected."),t&&l){const h=document.getElementById("playerDisplayImage"),p=document.querySelector(".portrait-grid.active").querySelector(".portrait-img.selected");h&&p&&(h.src=p.src,h.alt=p.alt),t.classList.remove("active"),l.classList.add("active")}if(!x){x=new $(g);const h=document.getElementById("commandInput"),d=document.getElementById("inventoryButton"),p=document.getElementById("statsButton"),I=document.getElementById("helpButton");h.addEventListener("keydown",w=>{if(w.key==="Enter"){const T=h.value.trim().toLowerCase();T&&(x.processCommand(T),h.value="")}}),d.addEventListener("click",()=>{x.processCommand("inventory")}),p.addEventListener("click",()=>{x.processCommand("stats")}),I.addEventListener("click",()=>{x.processCommand("help")})}y&&y.focus()}G({startButton:e,selectMaleButton:a,selectFemaleButton:n,confirmCharacterButton:f,allPortraitImages:i,statTooltip:u,archetypeData:A,...{onStartGame:()=>{s&&t&&(s.classList.remove("active"),t.classList.add("active"))},onGenderSelected:g=>{i.forEach(h=>h.classList.remove("selected")),g==="Male"?(o.classList.add("active"),r.classList.remove("active"),o.children.length>0&&(o.children[0].classList.add("selected"),b=0)):(o.classList.remove("active"),r.classList.add("active"),r.children.length>0&&(r.children[0].classList.add("selected"),b=0))},onPortraitClicked:g=>{g.parentElement.querySelectorAll(".portrait-img").forEach(p=>p.classList.remove("selected")),g.classList.add("selected"),b=parseInt(g.dataset.index,10)},onConfirmCharacterClicked:()=>{if(b!==null&&A[b]){const g=A[b];L(g)}else alert("Please select a character."),console.error("No archetype selected or index out of bounds.")}}}),o.children.length>0&&(o.children[0].classList.add("selected"),b=0)});
