{"mappings":"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","sources":["<anon>","main.js","room.js","items.js","monsters.js","characters.js","actions.js","battle.js","displayIt.js","eventListeners.js"],"sourcesContent":["class $4282fb41af3be353$export$6d08773d2e66f8f2 {\n    constructor(name, description, canTake = true, isUsable = true){\n        this.name = name;\n        this.description = description;\n        this.canTake = canTake;\n        this.isUsable = isUsable;\n        this.isConsumed = false;\n    }\n    use(player, room) {\n        if (!this.isUsable) return `The ${this.name} cannot be used.`;\n        switch(this.name){\n            case 'torch':\n                return this.useTorch(player, room);\n            case 'crystal':\n                return this.useCrystal(player, room);\n            case 'sword':\n                return this.useSword(player, room);\n            case 'key':\n                return this.useKey(player, room);\n            case 'potion':\n                return this.usePotion(player, room);\n            default:\n                return `You use the ${this.name}, but nothing happens.`;\n        }\n    }\n    useTorch(player, room) {\n        return 'The torch illuminates the area, revealing hidden details in the shadows.';\n    }\n    useCrystal(player, room) {\n        return 'The crystal pulses with energy, and you feel your strength renewed.';\n    }\n    useSword(player, room) {\n        player.attack += 5;\n        return 'You feel more confident with the sword in hand. Your attack power increases!';\n    }\n    useKey(player, room) {\n        return 'The key fits perfectly into a hidden lock you discover on the wall.';\n    }\n    usePotion(player, room) {\n        player.health = Math.min(player.maxHealth, player.health + 20);\n        this.isConsumed = true;\n        return 'You drink the potion and feel refreshed. Your health is restored!';\n    }\n    examine() {\n        return this.description;\n    }\n}\nclass $4282fb41af3be353$export$59df0c4c043eab7 {\n    constructor(){\n        this.items = new Map();\n        this.initializeItems();\n    }\n    initializeItems() {\n        const itemData = [\n            {\n                name: 'torch',\n                desc: 'A flickering torch that provides light.',\n                take: true\n            },\n            {\n                name: 'crystal',\n                desc: 'A mystical crystal that glows with inner light.',\n                take: true\n            },\n            {\n                name: 'sword',\n                desc: 'An ancient blade with mystical properties.',\n                take: true\n            },\n            {\n                name: 'key',\n                desc: 'An ornate key that looks very old.',\n                take: true\n            },\n            {\n                name: 'potion',\n                desc: 'A small vial containing a healing elixir.',\n                take: true\n            },\n            {\n                name: 'chest',\n                desc: 'A heavy wooden chest bound with iron.',\n                take: false\n            },\n            {\n                name: 'statue',\n                desc: 'An ancient statue covered in mysterious runes.',\n                take: false\n            }\n        ];\n        itemData.forEach((data)=>{\n            this.items.set(data.name, new $4282fb41af3be353$export$6d08773d2e66f8f2(data.name, data.desc, data.take));\n        });\n    }\n    getItem(name) {\n        return this.items.get(name);\n    }\n    createItem(name, description, canTake = true) {\n        const item = new $4282fb41af3be353$export$6d08773d2e66f8f2(name, description, canTake);\n        this.items.set(name, item);\n        return item;\n    }\n}\n\n\nclass $ca4ced5904ea9a46$export$d2385d4b1e3b9d1a {\n    constructor(name, health, attack, defense, description = ''){\n        this.name = name;\n        this.health = health;\n        this.maxHealth = health;\n        this.attack = attack;\n        this.defense = defense;\n        this.description = description;\n        this.isAlive = true;\n        this.experienceValue = Math.floor(health / 2) + attack;\n        this.loot = [];\n    }\n    takeDamage(damage) {\n        const actualDamage = Math.max(1, damage - this.defense);\n        this.health -= actualDamage;\n        this.health = Math.max(0, this.health);\n        if (this.health <= 0) this.isAlive = false;\n        return actualDamage;\n    }\n    attackPlayer(player) {\n        let damage;\n        let isCritical = false;\n        if (this.name === 'Goblin') {\n            damage = Math.floor(Math.random() * 5) + 1; // Damage 1-5 for Goblin\n            if (damage >= 4) isCritical = true;\n        } else // Default attack logic for other monsters\n        damage = Math.floor(Math.random() * this.attack) + 1;\n        return {\n            damage: damage,\n            isCritical: isCritical\n        };\n    }\n    getAttackMessage() {\n        const messages = [\n            `The ${this.name} lunges at you!`,\n            `The ${this.name} strikes with fury!`,\n            `The ${this.name} attacks viciously!`,\n            `The ${this.name} bares its claws and attacks!`\n        ];\n        return messages[Math.floor(Math.random() * messages.length)];\n    }\n    getDeathMessage() {\n        const messages = [\n            `The ${this.name} falls to the ground, defeated.`,\n            `The ${this.name} lets out a final roar and collapses.`,\n            `The ${this.name} crumbles into dust.`,\n            `The ${this.name} retreats into the shadows, defeated.`\n        ];\n        return messages[Math.floor(Math.random() * messages.length)];\n    }\n    addLoot(item) {\n        this.loot.push(item);\n    }\n    dropLoot() {\n        return this.loot;\n    }\n}\nclass $ca4ced5904ea9a46$export$d3f21a85ed5a9f10 {\n    static createGoblin() {\n        const goblin = new $ca4ced5904ea9a46$export$d2385d4b1e3b9d1a('Goblin', 30, 8, 3, 'A small, green creature with glowing red eyes and sharp claws.');\n        return goblin;\n    }\n    static createTroll() {\n        const troll = new $ca4ced5904ea9a46$export$d2385d4b1e3b9d1a('Cave Troll', 60, 15, 8, 'A massive creature with stone-like skin that guards the cave depths.');\n        return troll;\n    }\n    static createBat() {\n        const bat = new $ca4ced5904ea9a46$export$d2385d4b1e3b9d1a('Giant Bat', 20, 6, 2, 'A large bat with leathery wings and glowing eyes.');\n        return bat;\n    }\n    static createSpider() {\n        const spider = new $ca4ced5904ea9a46$export$d2385d4b1e3b9d1a('Cave Spider', 25, 10, 4, 'A venomous spider the size of a small dog with eight glowing eyes.');\n        return spider;\n    }\n    static createDragon() {\n        const dragon = new $ca4ced5904ea9a46$export$d2385d4b1e3b9d1a('Crystal Dragon', 100, 25, 15, 'An ancient dragon made of living crystal, guardian of the deepest treasures.');\n        return dragon;\n    }\n}\n\n\nclass $42615f55985a1754$export$cb68cc2163cd3f1 {\n    constructor(name, health, attack, defense, gold = 0){\n        this.name = name;\n        this.health = health;\n        this.maxHealth = health;\n        this.attack = attack;\n        this.defense = defense;\n        this.inventory = [];\n        this.experience = 0;\n        this.level = 1;\n        this.gold = gold;\n    }\n    takeDamage(damage) {\n        const actualDamage = Math.max(1, damage - this.defense);\n        this.health -= actualDamage;\n        this.health = Math.max(0, this.health);\n        return actualDamage;\n    }\n    heal(amount) {\n        this.health += amount;\n        this.health = Math.min(this.maxHealth, this.health);\n    }\n    isAlive() {\n        return this.health > 0;\n    }\n    addItem(item) {\n        this.inventory.push(item);\n    }\n    removeItem(item) {\n        const index = this.inventory.indexOf(item);\n        if (index > -1) this.inventory.splice(index, 1);\n    }\n    hasItem(itemName) {\n        // Make comparison case-insensitive to handle variations in user input\n        return this.inventory.some((item)=>item.name.toLowerCase() === itemName.toLowerCase());\n    }\n    getItem(itemName) {\n        return this.inventory.find((item)=>item.name.toLowerCase() === itemName.toLowerCase());\n    }\n    gainExperience(exp) {\n        this.experience += exp;\n        if (this.experience >= this.level * 100) this.levelUp();\n    }\n    levelUp() {\n        this.level++;\n        this.maxHealth += 10;\n        this.health = this.maxHealth;\n        this.attack += 2;\n        this.defense += 1;\n        return `You reached level ${this.level}! Your stats have improved.`;\n    }\n    getStats() {\n        return {\n            name: this.name,\n            level: this.level,\n            health: this.health,\n            maxHealth: this.maxHealth,\n            attack: this.attack,\n            defense: this.defense,\n            experience: this.experience,\n            gold: this.gold\n        };\n    }\n}\nclass $42615f55985a1754$export$958e8ef16ce7d8c4 extends $42615f55985a1754$export$cb68cc2163cd3f1 {\n    constructor(name, health, attack, defense, description = '', responses = {}, shopInventory = []){\n        super(name, health, attack, defense);\n        this.description = description;\n        this.responses = responses; // e.g., { default: [\"Hi\"], shop: [\"Want to buy?\"] }\n        this.isHostile = false;\n        this.dialogueCounters = {}; // Tracks index for each topic, e.g., { default: 0, shop: 1 }\n        this.shopInventory = shopInventory;\n    }\n    speak(topic = 'default') {\n        const topicResponses = this.responses[topic] || this.responses['default'];\n        if (!topicResponses || topicResponses.length === 0) return `${this.name} has nothing to say.`;\n        // Initialize counter for this topic if it doesn't exist\n        if (this.dialogueCounters[topic] === undefined) this.dialogueCounters[topic] = 0;\n        // Get the current message and advance the counter for this topic\n        const messageIndex = this.dialogueCounters[topic];\n        const message = topicResponses[messageIndex];\n        this.dialogueCounters[topic] = (messageIndex + 1) % topicResponses.length;\n        return `${this.name} says: \"${message}\"`;\n    }\n    setHostile(hostile) {\n        this.isHostile = hostile;\n    }\n    turnHostile() {\n        this.isHostile = true;\n        return `${this.name} becomes hostile!`;\n    }\n}\nconst $42615f55985a1754$export$8c85bdde2b83a480 = [\n    {\n        name: \"Warrior\",\n        health: 120,\n        strength: 15,\n        dexterity: 10,\n        agility: 8,\n        intelligence: 5,\n        charisma: 7\n    },\n    {\n        name: \"Rogue\",\n        health: 90,\n        strength: 10,\n        dexterity: 15,\n        agility: 12,\n        intelligence: 8,\n        charisma: 10\n    },\n    {\n        name: \"Ranger\",\n        health: 100,\n        strength: 12,\n        dexterity: 14,\n        agility: 10,\n        intelligence: 7,\n        charisma: 8\n    },\n    {\n        name: \"Bard\",\n        health: 85,\n        strength: 8,\n        dexterity: 12,\n        agility: 9,\n        intelligence: 12,\n        charisma: 15\n    },\n    {\n        name: \"Healer\",\n        health: 95,\n        strength: 7,\n        dexterity: 9,\n        agility: 7,\n        intelligence: 14,\n        charisma: 12\n    },\n    {\n        name: \"Mage\",\n        health: 80,\n        strength: 6,\n        dexterity: 8,\n        agility: 6,\n        intelligence: 16,\n        charisma: 9\n    }\n];\n\n\nclass $ac1ec18087c85c6d$export$525628e68e798fb4 {\n    constructor(name, description){\n        this.name = name;\n        this.description = description;\n        this.exits = {};\n        this.items = [];\n        this.monsters = [];\n        this.npcs = [];\n        this.visited = false;\n        this.lockedExits = {}; // New property to store locked exits\n    }\n    setExit(direction, room) {\n        this.exits[direction] = room;\n    }\n    setLockedExit(direction, room, keyName = 'lockpick') {\n        this.exits[direction] = room;\n        this.lockedExits[direction] = keyName;\n    }\n    addItem(item) {\n        this.items.push(item);\n    }\n    removeItem(item) {\n        const index = this.items.indexOf(item);\n        if (index > -1) this.items.splice(index, 1);\n    }\n    addMonster(monster) {\n        this.monsters.push(monster);\n    }\n    addNPC(npc) {\n        this.npcs.push(npc);\n    }\n    removeMonster(monster) {\n        const index = this.monsters.indexOf(monster);\n        if (index > -1) this.monsters.splice(index, 1);\n    }\n    getDescription(player) {\n        this.visited = true;\n        let baseDesc = this.description;\n        // Dynamic description for the Vault based on player inventory\n        if (this.name === 'The Vault' && player && player.hasItem('red key') && player.hasItem('blue key')) baseDesc = 'A massive, circular iron door dominates one wall of this room. It is sealed shut with no obvious handle or lock. Finely etched into its surface is the depiction of a great tree, its branches heavy with what look like round fruit. A small, empty nest is tucked among the boughs, and a dark, fist-sized hollow is visible in the trunk. The entire etching now emits a strong pulse, almost like a heartbeat, bathing the room in a rhythmic purple glow.';\n        let desc = `${this.name}\\n${baseDesc}`;\n        if (this.items.length > 0) desc += `\\n\\nYou see: ${this.items.map((item)=>item.name).join(', ')}`;\n        if (this.monsters.length > 0) desc += `\\n\\nCreatures present: ${this.monsters.map((monster)=>monster.name).join(', ')}`;\n        if (this.npcs.length > 0) desc += `\\n\\nPeople here: ${this.npcs.map((npc)=>npc.name).join(', ')}`;\n        const exitList = Object.keys(this.exits);\n        if (exitList.length > 0) {\n            const formattedExits = exitList.map((direction)=>{\n                if (this.lockedExits[direction]) return `${direction} (locked)`; // Keep template literal for consistency\n                else return direction;\n            });\n            desc += `\\n\\nExits: ${formattedExits.join(', ')}`;\n        }\n        return desc;\n    }\n    hasExit(direction) {\n        return this.exits.hasOwnProperty(direction);\n    }\n    getExit(direction) {\n        return this.exits[direction];\n    }\n    unlockExit(direction) {\n        if (this.lockedExits[direction]) {\n            const destinationRoom = this.exits[direction];\n            const exitName = destinationRoom.name;\n            // Unlock this side\n            delete this.lockedExits[direction];\n            // Find and unlock the return path on the other side\n            for(const returnDir in destinationRoom.exits)if (destinationRoom.exits[returnDir] === this) {\n                if (destinationRoom.lockedExits[returnDir]) delete destinationRoom.lockedExits[returnDir];\n                break;\n            }\n            return `You've unlocked the exit to the ${exitName}!`;\n        }\n        return `The exit to the ${this.exits[direction].name} wasn't locked.`;\n    }\n}\nfunction $ac1ec18087c85c6d$export$bd9127779b59056d() {\n    // --- 1. Define World Data ---\n    const roomData = {\n        'entrance': {\n            name: 'The Glade',\n            description: 'After what feels like an eternity of pushing through an unforgiving, dense forest, the trees finally part. You step into a secluded glade, a place that feels untouched by time. The air is crisp, filled with the scent of damp earth and decaying leaves. A circle of towering trees, their leaves a brilliant tapestry of gold, crimson, and amber, stands as silent sentinels, walling this place off from the outside world. It\\'s clear why this glade has remained hidden for so long.\\n\\nBefore you stands the true prize of your journey: the entrance to The Labyrinth of Lyre, Adorellan\\'s most ancient and storied site. The entrance is formidable. Tall, ancient stone walls, grey and weathered with age, rise up to meet the sky. Set within these walls are thick, heavy wrought-iron gates, their surface pitted with rust and age. A dense curtain of thick, dark green vines chokes the gates, weaving through the bars so completely that nothing of the labyrinth beyond can be seen. The silence here is profound, broken only by the rustle of leaves under your feet.'\n        },\n        'courtyard': {\n            name: 'The Garden of Grie',\n            description: 'With a final, desperate shove, the ancient iron gates groan in protest, their rusted hinges screaming as they reluctantly give way. You stumble forward, catching your balance on the cracked flagstones of a vast, open courtyard. The air here is still and heavy, carrying the scent of dust and forgotten time. With a brief look you notice the discarded remains of old camps and items that belonged to brave adventures long since forgotten.\\n\\nIn the centre of the courtyard, a once-grand fountain lies in ruins. Its stone basin shattered, and the statue that once stood proudly at its heart is now a toppled, moss-covered casualty of age. A trickle of dark, stagnant water weeps from a crack, pooling on the ground below.\\n\\nYour eyes are drawn to the far side of the courtyard. Dominating the wall is a massive, intricate circular carving, its ancient design a complex web of interlocking lines and symbols that seem to writhe just at the edge of your vision. Flanking this mysterious emblem are two arched exits.\\n\\nTo the left, a sturdy iron gate, similar to the one you just forced open, blocks the archway, promising another challenge. To the right, the archway is filled with the splintered remains of a wooden door, hanging precariously from a single hinge, offering a seemingly easier, though perhaps more treacherous, path forward.'\n        },\n        'bunkers': {\n            name: 'Bunker\\'s Bend',\n            description: 'Rows of dusty, empty bunks line the walls of this large, cold room. It seems to have been abandoned long ago.'\n        },\n        'clinkers': {\n            name: 'Clinker\\'s Armoury',\n            description: 'This chamber serves as a makeshift armoury. Racks of rusted weapons and dented armour line the walls. Most of it is useless, but some treasures may yet remain.'\n        },\n        'market': {\n            name: 'The Sunken Market',\n            description: 'You step into what was clearly once a bustling underground market. Broken stalls and scattered, worthless goods litter the floor. It seems you are the first to enter in a very long time.'\n        },\n        'marketCorridor': {\n            name: 'Short Corridor',\n            description: 'A short, narrow corridor. About halfway down, a sturdy-looking wooden door blocks the path forward. A strange inscription on the door depicts a hand, a stone, and some parchment. It seems to be a game of chance. Do you try your luck?'\n        },\n        'bunkerHallway': {\n            name: 'Cluttered Hallway',\n            description: 'This hallway is cluttered with scattered bits and bobs left behind by previous inhabitants - tattered clothes, worthless trinkets, and other debris. It continues forward towards Bunker\\'s Bend.'\n        },\n        'armouryHallway': {\n            name: 'Decrepit Hallway',\n            description: 'The splintered remains of a wooden door lead into this short, dusty hallway. It continues forward, where you can see the entrance to another chamber.'\n        },\n        'vault': {\n            name: 'The Vault',\n            description: 'A massive, circular iron door dominates one wall of this room. It is sealed shut with no obvious handle or lock. Finely etched into its surface is the depiction of a great tree, its branches heavy with what look like round fruit. A small, empty nest is tucked among the boughs, and a dark, fist-sized hollow is visible in the trunk. The entire etching glows with a faint, otherworldly purple light.'\n        },\n        'vaultHallway': {\n            name: 'Vault Hallway',\n            description: 'A short, sterile hallway with smooth stone walls. A simple revolving iron gate stands behind you, leading back to the market. Ahead, the hallway ends at the massive circular door of The Vault.'\n        },\n        'zHallway': {\n            name: 'Z-Shaped Hallway',\n            description: 'A cramped, narrow hallway that takes a sharp turn before continuing. The stone is cold and damp to the touch. One way leads towards the market, while the path behind you returns to the bunkers.'\n        },\n        'temple': {\n            name: 'The Forgotten Temple',\n            description: 'An eerie silence hangs in this grand temple. Faded murals on the walls depict forgotten gods.'\n        },\n        'safezone': {\n            name: 'Haven Shield',\n            description: 'The narrow corridor opens into a breathtaking, sun-dappled glade that feels entirely separate from the labyrinth. The walls are lined with ancient, towering trees, their leaves forming a dense canopy overhead. In the center of the glade is a serene, crystal-clear lake. On the far side of the lake stands a single, rustic-looking cabin. There are signs of others who have made it this far: the remnants of abandoned campfires and a discarded waterskin near the cabin\\'s entrance.'\n        },\n        'grebs': {\n            name: 'Greb\\'s Grotto',\n            description: 'This small, surprisingly cozy cavern is a chaotic mess of discarded adventuring gear. Piles of dented helmets, mismatched boots, and chipped shields are stacked against the walls. A small, friendly-looking red imp with large, curious eyes tends to a makeshift counter made from a large, flat rock. He seems to be sorting through a pile of rusty keys.'\n        },\n        'scriptorium': {\n            name: 'The Scriptorium',\n            description: 'Rotting shelves filled with decaying books and scrolls line the walls. The air is thick with the smell of dust and old paper.'\n        },\n        'chamber': {\n            name: 'The Mercurial Den',\n            description: 'A vast, circular chamber where the walls shimmer with thousands of luminescent crystals, casting a beautiful, eerie light.'\n        },\n        'grottoHallway': {\n            name: 'Cluttered Passageway',\n            description: 'A short passageway littered with discarded items - a broken lantern, a tattered cloak, and other adventuring debris. It seems to be a well-traveled route.'\n        },\n        'bendyHallway': {\n            name: 'Winding Corridor',\n            description: 'A long, winding corridor that bends out of sight. The air feels strangely calm and quiet here.'\n        },\n        'rockCrevice': {\n            name: 'Rock Crevice',\n            description: 'A narrow crevice in the rock face, almost hidden by overgrown vines. It looks like a tight squeeze.'\n        },\n        'hiddenCavern': {\n            name: 'Hidden Cavern',\n            description: 'The crevice opens into a small, damp cavern. A crude, heavy wooden door is set into the far wall.'\n        },\n        'windingPassage': {\n            name: 'Winding Passage',\n            description: 'Beyond the door is a long, winding passage carved from the rock. It slopes gently downwards and ends at another door, which looks like it can only be opened from this side.'\n        }\n    };\n    const connectionData = [\n        {\n            from: 'entrance',\n            to: 'courtyard',\n            direction: 'forward',\n            returnDirection: 'back'\n        },\n        // Path from courtyard to clinkers (right exit)\n        {\n            from: 'courtyard',\n            to: 'armouryHallway',\n            direction: 'right',\n            returnDirection: 'back'\n        },\n        {\n            from: 'armouryHallway',\n            to: 'clinkers',\n            direction: 'forward',\n            returnDirection: 'back'\n        },\n        // Path from courtyard to bunkers (left exit, locked)\n        {\n            from: 'courtyard',\n            to: 'bunkerHallway',\n            direction: 'left',\n            returnDirection: 'back',\n            locked: true\n        },\n        {\n            from: 'bunkerHallway',\n            to: 'bunkers',\n            direction: 'forward',\n            returnDirection: 'back'\n        },\n        // Path from Clinker's to the Market (left exit, locked)\n        {\n            from: 'clinkers',\n            to: 'marketCorridor',\n            direction: 'left',\n            returnDirection: 'back'\n        },\n        {\n            from: 'marketCorridor',\n            to: 'market',\n            direction: 'forward',\n            returnDirection: 'back',\n            locked: 'rps'\n        },\n        // Path from the Market to the Temple\n        {\n            from: 'market',\n            to: 'temple',\n            direction: 'forward',\n            returnDirection: 'back'\n        },\n        {\n            from: 'temple',\n            to: 'scriptorium',\n            direction: 'left',\n            returnDirection: 'back'\n        },\n        {\n            from: 'scriptorium',\n            to: 'chamber',\n            direction: 'forward',\n            returnDirection: 'back'\n        },\n        // Path from the Market to the Vault\n        {\n            from: 'market',\n            to: 'vaultHallway',\n            direction: 'right',\n            returnDirection: 'back'\n        },\n        {\n            from: 'vaultHallway',\n            to: 'vault',\n            direction: 'forward',\n            returnDirection: 'back'\n        },\n        // Path from the Market to the Bunkers (via a locked door from Bunkers)\n        {\n            from: 'market',\n            to: 'zHallway',\n            direction: 'left',\n            returnDirection: 'back'\n        },\n        {\n            from: 'bunkers',\n            to: 'zHallway',\n            direction: 'forward',\n            returnDirection: 'back',\n            locked: true,\n            twoWayLock: true\n        },\n        // Paths from the Mercurial Den\n        {\n            from: 'chamber',\n            to: 'grottoHallway',\n            direction: 'forward',\n            returnDirection: 'back'\n        },\n        {\n            from: 'grottoHallway',\n            to: 'grebs',\n            direction: 'forward',\n            returnDirection: 'back'\n        },\n        {\n            from: 'chamber',\n            to: 'bendyHallway',\n            direction: 'right',\n            returnDirection: 'back'\n        },\n        {\n            from: 'bendyHallway',\n            to: 'safezone',\n            direction: 'forward',\n            returnDirection: 'back'\n        },\n        // New one-way path from Haven Shield to the Temple\n        {\n            from: 'safezone',\n            to: 'rockCrevice',\n            direction: 'right',\n            returnDirection: 'back'\n        },\n        {\n            from: 'rockCrevice',\n            to: 'hiddenCavern',\n            direction: 'forward',\n            returnDirection: 'back'\n        },\n        {\n            from: 'hiddenCavern',\n            to: 'windingPassage',\n            direction: 'forward',\n            returnDirection: 'back'\n        },\n        {\n            from: 'windingPassage',\n            to: 'temple',\n            direction: 'forward',\n            oneWay: true\n        }\n    ];\n    const itemPlacement = {\n        'courtyard': [\n            new (0, $4282fb41af3be353$export$6d08773d2e66f8f2)('torch', 'A flickering torch that provides light in dark places.', true)\n        ],\n        'chamber': [\n            new (0, $4282fb41af3be353$export$6d08773d2e66f8f2)('crystal', 'A glowing blue crystal that pulses with mystical energy.', true)\n        ],\n        'clinkers': [\n            new (0, $4282fb41af3be353$export$6d08773d2e66f8f2)('sword', 'An ancient sword with mysterious runes etched into the blade.', true)\n        ],\n        'armouryHallway': [\n            new (0, $4282fb41af3be353$export$6d08773d2e66f8f2)('lockpick', 'A set of lock picks, half-hidden under some debris. Useful for opening locked doors.', true)\n        ],\n        'market': [\n            new (0, $4282fb41af3be353$export$6d08773d2e66f8f2)('potion', 'A healing potion, left behind on a stall.', true)\n        ],\n        'scriptorium': [\n            new (0, $4282fb41af3be353$export$6d08773d2e66f8f2)('red key', 'A key crafted from a single piece of ruby, warm to the touch.', true)\n        ],\n        'grottoHallway': [\n            new (0, $4282fb41af3be353$export$6d08773d2e66f8f2)('potion', 'A healing potion, dropped carelessly on the floor.', true)\n        ],\n        'safezone': [\n            new (0, $4282fb41af3be353$export$6d08773d2e66f8f2)('waterskin', 'A discarded waterskin, still half-full of clean water.', true)\n        ]\n    };\n    const monsterPlacement = {\n        'chamber': [\n            new (0, $ca4ced5904ea9a46$export$d2385d4b1e3b9d1a)('Goblin', 30, 8, 3, 'A small, green creature with glowing red eyes.')\n        ]\n    };\n    const npcPlacement = {\n        'grebs': [\n            new (0, $42615f55985a1754$export$958e8ef16ce7d8c4)('Grebgela', 50, 0, 5, 'A small red imp with large, curious eyes. He fidgets with a collection of shiny trinkets on his makeshift counter, a wide, toothy grin spreading across his face when he notices you.', {\n                'default': [\n                    \"'Allo there, adventurer! Welcome to Greb's Grotto!\",\n                    \"See anything you like? Just bits and bobs I find, but one person's junk is another imp's treasure, eh?\"\n                ],\n                'keys': [\n                    \"Ah, these old things?\",\n                    \"Just some rusty keys I found. None of 'em seem to fit anything important... yet!\",\n                    \"Maybe you'll have better luck with them than I did!\"\n                ],\n                'grotto': [\n                    \"It ain't much, but it's home! And it's full of wonderful junk!\",\n                    \"A bit messy, I know. I call it 'organized chaos'!\"\n                ],\n                'shop': [\n                    \"Everything here is for sale, friend! If you've got the coin, I've got the... well, the 'stuff'!\",\n                    \"Just 'list' what I've got, or 'buy [item name]' if you see something you fancy!\"\n                ]\n            }, [\n                {\n                    item: new (0, $4282fb41af3be353$export$6d08773d2e66f8f2)('blue key', 'A key made of sapphire, cool and smooth in your hand.', true),\n                    price: 25\n                },\n                {\n                    item: new (0, $4282fb41af3be353$export$6d08773d2e66f8f2)('skeleton key', 'A key made from bone, said to open any locked chest.', true),\n                    price: 50\n                },\n                {\n                    item: new (0, $4282fb41af3be353$export$6d08773d2e66f8f2)('potion', 'A healing potion, brewed by Grebgela himself. Smells faintly of swamp water.', true),\n                    price: 15\n                }\n            ])\n        ]\n    };\n    // --- 2. Build the World from Data ---\n    const rooms = {};\n    // Create all room instances\n    for(const id in roomData)rooms[id] = new $ac1ec18087c85c6d$export$525628e68e798fb4(roomData[id].name, roomData[id].description);\n    // Create all connections between rooms\n    for (const conn of connectionData){\n        const fromRoom = rooms[conn.from];\n        const toRoom = rooms[conn.to];\n        if (conn.locked) fromRoom.setLockedExit(conn.direction, toRoom, conn.locked);\n        else fromRoom.setExit(conn.direction, toRoom);\n        // If the connection is not one-way, set the return path\n        if (!conn.oneWay) {\n            // If it's a two-way lock, lock the return path. Otherwise, set a normal exit.\n            if (conn.twoWayLock) toRoom.setLockedExit(conn.returnDirection, fromRoom, conn.locked);\n            else toRoom.setExit(conn.returnDirection, fromRoom);\n        }\n    }\n    // Place items and monsters in rooms\n    for(const roomId in itemPlacement)itemPlacement[roomId].forEach((item)=>rooms[roomId].addItem(item));\n    for(const roomId in monsterPlacement)monsterPlacement[roomId].forEach((monster)=>rooms[roomId].addMonster(monster));\n    for(const roomId in npcPlacement)npcPlacement[roomId].forEach((npc)=>rooms[roomId].addNPC(npc));\n    // --- 3. Return the Starting Room ---\n    return rooms['entrance'];\n}\n\n\n\n\n\nclass $4f211b8eb53ec7aa$export$b413f0fd99d7775 {\n    constructor(gameInstance){\n        this.game = gameInstance; // Provides access to game.player, game.currentRoom, game.battleSystem etc.\n    }\n    processCommand(verb, object) {\n        let response = '';\n        switch(verb){\n            case 'go':\n                response = this._handleMovement(object);\n                break;\n            case 'look':\n                response = this._handleLook(object);\n                break;\n            case 'inspect':\n                response = this._handleInspect(object);\n                break;\n            case 'search':\n                response = this._handleSearch();\n                break;\n            case 'take':\n                response = this._handleTake(object);\n                break;\n            case 'use':\n                response = this._handleUse(object);\n                break;\n            case 'drop':\n                response = this._handleDrop(object);\n                break;\n            case 'attack':\n            case 'fight':\n            case 'battle':\n                response = this._handleBattle(object);\n                break;\n            case 'flee':\n                // This handles 'flee' outside of combat.\n                // Fleeing during combat is handled by BattleSystem.processBattleTurn\n                response = this._handleFlee();\n                break;\n            case 'left':\n            case 'right':\n            case 'forward':\n            case 'back':\n                response = this._handleMovement(verb);\n                break;\n            case 'pick':\n                response = this._handlePick(object);\n                break;\n            case 'help':\n                response = this._handleHelp();\n                break;\n            case 'play':\n                response = this._handlePlay(object);\n                break;\n            case 'talk':\n                response = this._handleTalk(object);\n                break;\n            case 'list':\n                response = this._handleList();\n                break;\n            case 'buy':\n                response = this._handleBuy(object);\n                break;\n            default:\n                response = \"I don't understand that command. Try 'help' to see a list of available commands.\";\n        }\n        return response;\n    }\n    _handleMovement(direction) {\n        const allowedDirections = [\n            'forward',\n            'back',\n            'left',\n            'right'\n        ];\n        if (!allowedDirections.includes(direction)) return `You can only move in these directions: forward, back, left, right.`;\n        // Handle the 'back' command dynamically\n        if (direction === 'back') {\n            if (this.game.roomHistory.length > 0) {\n                // Pop the last room from history to go back\n                this.game.currentRoom = this.game.roomHistory.pop();\n                return `You go back.\\n\\n${this.game.currentRoom.getDescription(this.game.player)}`;\n            } else return \"You can't go back any further.\";\n        }\n        // Handle all other directions\n        const exit = this.game.currentRoom.getExit(direction);\n        if (exit) {\n            // CRITICAL: Check if the exit is locked before moving\n            if (this.game.currentRoom.lockedExits[direction]) return \"That way is locked.\";\n            // Add the current room to history before moving\n            this.game.roomHistory.push(this.game.currentRoom);\n            this.game.currentRoom = exit;\n            return `You move ${direction}.\\n\\n${this.game.currentRoom.getDescription(this.game.player)}`;\n        }\n        return `You cannot go ${direction} from here.`;\n    }\n    _handleLook(target) {\n        if (!target) return this.game.currentRoom.getDescription(this.game.player);\n        // If a target is provided, guide the user to the new command.\n        return `To examine something specific, try 'inspect ${target}'.`;\n    }\n    _handleInspect(target) {\n        if (!target) return \"What do you want to inspect?\";\n        const item = this.game.currentRoom.items.find((i)=>i.name.toLowerCase() === target.toLowerCase());\n        if (item) return item.examine(); // Use item.examine() for consistency\n        const monster = this.game.currentRoom.monsters.find((m)=>m.name.toLowerCase() === target.toLowerCase());\n        if (monster) return monster.description;\n        const npc = this.game.currentRoom.npcs.find((n)=>n.name.toLowerCase() === target.toLowerCase());\n        if (npc) return npc.description;\n        return `You don't see a ${target} here to inspect.`;\n    }\n    _handleSearch() {\n        const items = this.game.currentRoom.items;\n        const monsters = this.game.currentRoom.monsters;\n        let result = 'You search the area carefully...\\n\\n';\n        if (items.length > 0) result += 'You find: ' + items.map((i)=>i.name).join(', ') + '\\n';\n        if (monsters.length > 0) result += 'You notice: ' + monsters.map((m)=>m.name).join(', ') + '\\n';\n        const npcs = this.game.currentRoom.npcs;\n        if (npcs.length > 0) result += 'You see: ' + npcs.map((n)=>n.name).join(', ') + '\\n';\n        if (items.length === 0 && monsters.length === 0 && npcs.length === 0) result += 'You find nothing of interest.';\n        return result;\n    }\n    _handleTake(itemName) {\n        const item = this.game.currentRoom.items.find((i)=>i.name.toLowerCase() === itemName.toLowerCase());\n        if (item && item.canTake) {\n            this.game.player.addItem(item); // Use player's addItem method\n            this.game.currentRoom.removeItem(item);\n            return `You take the ${itemName}.`;\n        } else if (item) return `You cannot take the ${itemName}.`;\n        return `There is no ${itemName} here.`;\n    }\n    _handleUse(itemName) {\n        const item = this.game.player.getItem(itemName.toLowerCase()); // Use player's getItem\n        if (item) {\n            const usageResult = item.use(this.game.player, this.game.currentRoom);\n            if (item.isConsumed) this.game.player.removeItem(item); // Use player's removeItem\n            return usageResult;\n        }\n        return `You don't have a ${itemName}.`;\n    }\n    _handleDrop(itemName) {\n        const item = this.game.player.getItem(itemName.toLowerCase());\n        if (item) {\n            this.game.player.removeItem(item); // Remove from player's inventory\n            this.game.currentRoom.addItem(item); // Add to the current room's items\n            return `You drop the ${itemName}.`;\n        }\n        return `You don't have a ${itemName} to drop.`;\n    }\n    _handleBattle(target) {\n        const monster = this.game.currentRoom.monsters.find((m)=>m.name.toLowerCase() === target.toLowerCase() || target === '' && this.game.currentRoom.monsters.length > 0);\n        if (monster) return this.game.battleSystem.startBattle(this.game.player, monster);\n        return 'There is nothing to fight here, or no specific target mentioned.';\n    }\n    _handleFlee() {\n        // This is for a general 'flee' command when not in battle.\n        // If in battle, BattleSystem's flee logic is used.\n        return 'You look around nervously, but there is no immediate danger to flee from.';\n    }\n    _handlePick(direction) {\n        if (!direction) return \"Which exit do you want to try and pick?\";\n        if (this.game.player.hasItem('lockpick')) {\n            const exit = this.game.currentRoom.exits[direction];\n            if (exit && this.game.currentRoom.lockedExits[direction]) return this.game.currentRoom.unlockExit(direction);\n            else if (exit) return \"That exit isn't locked.\";\n            return `There's no exit in that direction.`;\n        }\n        return \"You don't have any lock picks!\";\n    }\n    _handlePlay(playerChoice) {\n        if (!playerChoice) return \"What do you want to play? Try 'play rock', 'play paper', or 'play scissors'.\";\n        const choices = [\n            'rock',\n            'paper',\n            'scissors'\n        ];\n        const playerMove = playerChoice.toLowerCase();\n        if (!choices.includes(playerMove)) return `You can't play '${playerChoice}'. Try rock, paper, or scissors.`;\n        // Find a door to play against.\n        let targetDirection = null;\n        // Check all exits for an 'rps' lock\n        for(const dir in this.game.currentRoom.lockedExits)if (this.game.currentRoom.lockedExits[dir] === 'rps') {\n            targetDirection = dir;\n            break; // Assume only one RPS door per room for simplicity\n        }\n        if (!targetDirection) return \"There's nothing here to play a game with.\";\n        // Now play the game\n        const computerChoice = choices[Math.floor(Math.random() * choices.length)];\n        let resultMessage = `You play ${playerMove}. The door seems to respond, projecting an image of a ${computerChoice}.\\n\\n`;\n        if (playerMove === computerChoice) resultMessage += \"It's a draw! The door remains locked. Try again.\";\n        else if (playerMove === 'rock' && computerChoice === 'scissors' || playerMove === 'paper' && computerChoice === 'rock' || playerMove === 'scissors' && computerChoice === 'paper') {\n            resultMessage += \"You win! With a grinding sound, the lock on the door retracts.\";\n            this.game.currentRoom.unlockExit(targetDirection);\n        } else resultMessage += \"You lose! The door remains stubbornly shut.\";\n        return resultMessage;\n    }\n    _handleTalk(fullTarget) {\n        if (!fullTarget) return \"Who do you want to talk to?\";\n        // Parse the input for a target and an optional topic\n        const parts = fullTarget.toLowerCase().split(' about ');\n        const npcName = parts[0].trim();\n        const topic = parts.length > 1 ? parts[1].trim() : 'default';\n        // Find the NPC in the current room\n        const npc = this.game.currentRoom.npcs.find((n)=>n.name.toLowerCase() === npcName);\n        if (npc) return npc.speak(topic);\n        return `There is no one named '${npcName}' here to talk to.`;\n    }\n    _handleList() {\n        // Find an NPC with a shop in the current room. Assume only one for now.\n        const shopkeeper = this.game.currentRoom.npcs.find((npc)=>npc.shopInventory && npc.shopInventory.length > 0);\n        if (!shopkeeper) return \"There is no one here to buy from.\";\n        if (shopkeeper.shopInventory.length === 0) return `${shopkeeper.name} has nothing for sale right now.`;\n        let response = `<strong>--- ${shopkeeper.name}'s Wares ---</strong>\\n\\n`;\n        shopkeeper.shopInventory.forEach((stock)=>{\n            response += `- ${stock.item.name} (${stock.price} gold): ${stock.item.description}\\n`;\n        });\n        response += `\\nYou have ${this.game.player.gold} gold.`;\n        response += `\\n(Type 'buy [item name]' to purchase)`;\n        return response;\n    }\n    _handleBuy(itemName) {\n        if (!itemName) return \"What would you like to buy?\";\n        const shopkeeper = this.game.currentRoom.npcs.find((npc)=>npc.shopInventory && npc.shopInventory.length > 0);\n        if (!shopkeeper) return \"There is no one here to buy from.\";\n        const itemToBuy = shopkeeper.shopInventory.find((stock)=>stock.item.name.toLowerCase() === itemName.toLowerCase());\n        if (!itemToBuy) return `${shopkeeper.name} doesn't have a \"${itemName}\" for sale.`;\n        if (this.game.player.gold < itemToBuy.price) return `You don't have enough gold. You need ${itemToBuy.price} gold, but you only have ${this.game.player.gold}.`;\n        this.game.player.gold -= itemToBuy.price;\n        this.game.player.addItem(itemToBuy.item);\n        shopkeeper.shopInventory = shopkeeper.shopInventory.filter((stock)=>stock.item.name.toLowerCase() !== itemName.toLowerCase());\n        return `You bought the ${itemToBuy.item.name} for ${itemToBuy.price} gold. You have ${this.game.player.gold} gold left.`;\n    }\n    _handleHelp() {\n        const helpTitle = \"<strong>--- Help: Available Commands ---</strong>\\n\\n\";\n        const commands = [\n            \"<strong>go [direction]</strong>: Move between rooms. Valid directions are 'forward', 'back', 'left', and 'right'. You can also type a direction by itself (e.g., 'left').\",\n            \"<strong>look</strong>: Get a description of your current location.\",\n            \"<strong>inspect [object/monster]</strong>: Examine a specific object or monster in the room.\",\n            \"<strong>search</strong>: Search the room for any items or hidden things.\",\n            \"<strong>take [item]</strong>: Add an item from the room to your inventory.\",\n            \"<strong>drop [item]</strong>: Remove an item from your inventory and leave it in the room.\",\n            \"<strong>use [item]</strong>: Use an item from your inventory. Some items have special effects.\",\n            \"<strong>pick [direction]</strong>: Attempt to pick a locked door in a given direction (e.g., 'pick left'). This requires a 'lockpick' in your inventory.\",\n            \"<strong>attack [monster]</strong>: Engage in combat with a monster.\",\n            \"<strong>flee</strong>: Attempt to run away from a battle.\",\n            \"<strong>play [choice]</strong>: Play a game of chance when prompted (e.g., 'play rock').\",\n            \"<strong>talk [person]</strong> or <strong>talk [person] about [topic]</strong>: Speak to a friendly character.\",\n            \"<strong>list</strong>: Shows items for sale if a shopkeeper is present.\",\n            \"<strong>buy [item]</strong>: Purchase an item from a shopkeeper.\"\n        ];\n        return helpTitle + commands.join('\\n\\n');\n    }\n}\n\n\nclass $202629da8e082d6a$export$761d71765f873338 {\n    constructor(){\n        this.inBattle = false;\n        this.currentEnemy = null;\n        this.battleLog = [];\n    }\n    startBattle(player, monster) {\n        this.inBattle = true;\n        this.currentEnemy = monster;\n        this.battleLog = [];\n        let result = `\\n=== BATTLE BEGINS ===\\n`;\n        result += `You face the ${monster.name}!\\n`;\n        result += `${monster.description}\\n\\n`;\n        result += this.getBattleStatus(player, monster);\n        result += `\\nWhat will you do? (attack, flee, use [item])`;\n        return result;\n    }\n    processBattleTurn(player, monster, action, target = null) {\n        if (!this.inBattle) return \"You are not in battle.\";\n        let result = '';\n        switch(action){\n            case 'attack':\n                result += this.playerAttack(player, monster);\n                if (monster.isAlive) result += '\\n' + this.monsterAttack(player, monster);\n                break;\n            case 'flee':\n                result += this.attemptFlee(player, monster);\n                break;\n            case 'use':\n                result += this.useItemInBattle(player, target);\n                if (monster.isAlive) result += '\\n' + this.monsterAttack(player, monster);\n                break;\n            default:\n                result = \"Invalid battle action. Try: attack, flee, or use [item]\";\n        }\n        if (!monster.isAlive) result += '\\n' + this.endBattle(player, monster, 'victory');\n        else if (!player.isAlive()) result += '\\n' + this.endBattle(player, monster, 'defeat');\n        else result += '\\n\\n' + this.getBattleStatus(player, monster);\n        return result;\n    }\n    playerAttack(player, monster) {\n        const baseDamageRoll = Math.floor(Math.random() * 13) + 1; // Rolls 1-13\n        let finalDamageToApply; // Damage before monster's defense\n        let isCritical = false;\n        // Critical hits are triggered by the four highest numbers from the 1-13 roll (10, 11, 12, 13)\n        if (baseDamageRoll > 9) {\n            isCritical = true;\n            // Calculate the maximum possible damage value for a critical hit based on player's level\n            let maxCritDamageValue = 11 + (player.level - 1) * 2;\n            maxCritDamageValue = Math.min(maxCritDamageValue, 18); // Cap at 18\n            // Minimum damage value for a critical hit output\n            const minCritDamageValue = 10;\n            // Critical damage is a random number between minCritDamageValue and maxCritDamageValue (inclusive)\n            finalDamageToApply = Math.floor(Math.random() * (maxCritDamageValue - minCritDamageValue + 1)) + minCritDamageValue;\n        } else // Not a critical hit, damage is the base roll (1-9)\n        finalDamageToApply = baseDamageRoll;\n        const actualDamage = monster.takeDamage(finalDamageToApply);\n        let result = '';\n        if (isCritical) result = `Critical Hit! You strike the ${monster.name} for ${actualDamage} damage!`;\n        else result = `You strike the ${monster.name} for ${actualDamage} damage!`;\n        if (!monster.isAlive) result += '\\n' + monster.getDeathMessage();\n        return result;\n    }\n    monsterAttack(player, monster) {\n        const attackDetails = monster.attackPlayer(player); // Returns { damage, isCritical }\n        const actualDamage = player.takeDamage(attackDetails.damage);\n        let result = monster.getAttackMessage();\n        if (attackDetails.isCritical) result += ` Critical Hit!`;\n        result += `\\nThe ${monster.name} hits you for ${actualDamage} damage!`; // Clarified who hits\n        if (!player.isAlive()) result += '\\nYou have been defeated!';\n        return result;\n    }\n    attemptFlee(player, monster) {\n        const fleeChance = Math.random();\n        if (fleeChance > 0.3) {\n            this.endBattle(player, monster, 'flee');\n            return \"You successfully flee from the battle!\";\n        } else {\n            let result = \"You failed to escape!\";\n            result += '\\n' + this.monsterAttack(player, monster);\n            return result;\n        }\n    }\n    useItemInBattle(player, itemName) {\n        const item = player.getItem(itemName);\n        if (!item) return `You don't have a ${itemName}.`;\n        let result = item.use(player, null);\n        if (item.isConsumed) player.removeItem(item);\n        return result;\n    }\n    getBattleStatus(player, monster) {\n        let status = `--- Battle Status ---\\n`;\n        status += `Your Health: ${player.health}/${player.maxHealth}\\n`;\n        status += `${monster.name} Health: ${monster.health}/${monster.maxHealth}`;\n        return status;\n    }\n    endBattle(player, monster, outcome) {\n        this.inBattle = false;\n        this.currentEnemy = null;\n        let result = '\\n=== BATTLE END ===\\n';\n        switch(outcome){\n            case 'victory':\n                const exp = monster.experienceValue;\n                player.gainExperience(exp);\n                result += `Victory! You gained ${exp} experience points.`;\n                const loot = monster.dropLoot();\n                if (loot.length > 0) {\n                    result += `\\nThe ${monster.name} dropped: `;\n                    result += loot.map((item)=>item.name).join(', ');\n                    loot.forEach((item)=>player.addItem(item));\n                }\n                break;\n            case 'defeat':\n                result += 'You have been defeated! Game Over.';\n                break;\n            case 'flee':\n                result += 'You escaped from the battle.';\n                break;\n        }\n        return result;\n    }\n}\n\n\nclass $2d63a410b342b8ee$export$dcc2704b47159cd7 {\n    constructor(gameInstance, appendTextFunction){\n        this.game = gameInstance; // Access to game.player, game.currentRoom\n        this.appendText = appendTextFunction; // Function to output messages\n    }\n    displayMap() {\n        let mapInfo = \"--- Location ---\\n\\n\";\n        mapInfo += `Your current location is the ${this.game.currentRoom.name}\\n. `;\n        const exits = Object.keys(this.game.currentRoom.exits);\n        if (exits.length > 0) mapInfo += \"Exits: \" + exits.map((exit)=>`${exit} to ${this.game.currentRoom.exits[exit].name}`).join(', ') + '\\n';\n        else mapInfo += \"No obvious exits from here.\\n\";\n        this.appendText(mapInfo);\n    }\n    displayInventory() {\n        let inventoryInfo = \"--- Inventory ---\\n\\n\";\n        if (this.game.player.inventory.length === 0) inventoryInfo += \"Your inventory is empty.\";\n        else {\n            inventoryInfo += \"You are carrying:\\n\";\n            this.game.player.inventory.forEach((item)=>{\n                inventoryInfo += `- ${item.name}: ${item.examine()}\\n`;\n            });\n        }\n        this.appendText(inventoryInfo);\n    }\n    displayStats() {\n        const stats = this.game.player.getStats();\n        let statsInfo = \"--- Character Stats ---\\n\\n\";\n        statsInfo += `Name: ${stats.name}\\n`;\n        statsInfo += `Level: ${stats.level}\\n`;\n        statsInfo += `Health: ${stats.health} / ${stats.maxHealth}\\n`;\n        statsInfo += `Attack: ${stats.attack}\\n`;\n        statsInfo += `Defense: ${stats.defense}\\n`;\n        statsInfo += `Experience: ${stats.experience} / ${stats.level * 100}\\n`;\n        statsInfo += `Gold: ${stats.gold}\\n`;\n        this.appendText(statsInfo);\n    }\n}\n\n\nfunction $4c1faa35fbcf99f6$var$_setupPortraitListeners(portraitImages, archetypeData, statTooltipElement, onPortraitClickCallback) {\n    portraitImages.forEach((imgElement, index)=>{\n        imgElement.addEventListener('click', ()=>{\n            // The callback will handle updating selectedArchetypeIndex and visual .selected class\n            onPortraitClickCallback(imgElement, index, portraitImages);\n        });\n        imgElement.addEventListener('mouseenter', (event)=>{\n            const stats = archetypeData[index];\n            if (stats) {\n                statTooltipElement.innerHTML = `\n                    <strong>${stats.name}</strong><br>\n                    Health: ${stats.health}<br>\n                    Strength: ${stats.strength}<br>\n                    Dexterity: ${stats.dexterity}<br>\n                    Agility: ${stats.agility}<br>\n                    Intelligence: ${stats.intelligence}<br>\n                    Charisma: ${stats.charisma}`;\n                statTooltipElement.style.left = event.pageX + 15 + 'px';\n                statTooltipElement.style.top = event.pageY + 15 + 'px';\n                statTooltipElement.style.display = 'block';\n            }\n        });\n        imgElement.addEventListener('mouseleave', ()=>{\n            statTooltipElement.style.display = 'none';\n        });\n        imgElement.addEventListener('mousemove', (event)=>{\n            if (statTooltipElement.style.display === 'block') {\n                statTooltipElement.style.left = event.pageX + 15 + 'px';\n                statTooltipElement.style.top = event.pageY + 15 + 'px';\n            }\n        });\n    });\n}\nfunction $4c1faa35fbcf99f6$export$22492a34fde78784({ startButton: // DOM elements\nstartButton, selectMaleButton: selectMaleButton, selectFemaleButton: selectFemaleButton, confirmCharacterButton: confirmCharacterButton, portraitImages: portraitImages, statTooltip: statTooltip, archetypeData: // Data\narchetypeData, onStartGame: // Callbacks from main.js\nonStartGame, onGenderSelected: onGenderSelected, onPortraitClicked: onPortraitClicked, onConfirmCharacterClicked: onConfirmCharacterClicked }) {\n    if (startButton) startButton.addEventListener('click', onStartGame);\n    if (selectMaleButton) selectMaleButton.addEventListener('click', ()=>onGenderSelected('Male'));\n    if (selectFemaleButton) selectFemaleButton.addEventListener('click', ()=>onGenderSelected('Female'));\n    if (confirmCharacterButton) confirmCharacterButton.addEventListener('click', onConfirmCharacterClicked);\n    $4c1faa35fbcf99f6$var$_setupPortraitListeners(portraitImages, archetypeData, statTooltip, onPortraitClicked);\n}\nfunction $4c1faa35fbcf99f6$export$81727421c76c3492({ commandInput: commandInput, mapButton: mapButton, inventoryButton: inventoryButton, statsButton: statsButton, helpButton: helpButton, gameInstance: gameInstance // The fully initialized AdventureGame instance\n }) {\n    if (commandInput) commandInput.addEventListener('keypress', (e)=>{\n        if (e.key === 'Enter' && commandInput.value.trim() !== '') {\n            gameInstance.processCommand(commandInput.value.trim().toLowerCase());\n            commandInput.value = '';\n        }\n    });\n    if (mapButton) mapButton.addEventListener('click', ()=>gameInstance.displayManager.displayMap());\n    if (inventoryButton) inventoryButton.addEventListener('click', ()=>gameInstance.displayManager.displayInventory());\n    if (statsButton) statsButton.addEventListener('click', ()=>gameInstance.displayManager.displayStats());\n    if (helpButton) helpButton.addEventListener('click', ()=>{\n        // Directly get the help text from the action handler\n        const helpText = gameInstance.actionHandler._handleHelp();\n        // Display it as a system message, not a command response (no '>')\n        gameInstance.displayMessage(helpText, false);\n    });\n}\n\n\ndocument.addEventListener('DOMContentLoaded', ()=>{\n    const titleScreen = document.getElementById('titleScreen');\n    const startButton = document.getElementById('startButton');\n    const characterSelectionScreen = document.getElementById('characterSelectionScreen');\n    const selectMaleButton = document.getElementById('selectMaleButton');\n    const selectFemaleButton = document.getElementById('selectFemaleButton');\n    const gameplayScreen = document.getElementById('gameplayScreen');\n    const confirmCharacterButton = document.getElementById('confirmCharacterButton');\n    const commandInput = document.getElementById('commandInput'); // For re-focusing\n    // Get portrait image elements\n    const portraitImages = [];\n    for(let i = 1; i <= 6; i++){\n        const portraitImg = document.getElementById(`portrait${i}`);\n        if (portraitImg) portraitImages.push(portraitImg);\n    }\n    // Create the tooltip element\n    const statTooltip = document.createElement('div');\n    statTooltip.id = 'statTooltip';\n    statTooltip.classList.add('tooltip');\n    // Append to body to avoid clipping issues with game-container's overflow:hidden\n    // and to simplify positioning relative to the viewport/mouse.\n    document.body.appendChild(statTooltip);\n    const gameOutput = document.getElementById('gameOutput');\n    const outputContainer = document.querySelector('.output-text-container'); // Get the container\n    function appendText(text) {\n        // Replace all newline characters with <br> tags for proper HTML rendering\n        const formattedText = text.replace(/\\n/g, '<br>');\n        gameOutput.innerHTML += `<p>${formattedText}</p>`; // Append as a paragraph\n        // After adding text, scroll to the bottom\n        outputContainer.scrollTop = outputContainer.scrollHeight;\n    }\n    let gameInstance = null; // To hold the AdventureGame instance\n    let selectedCharacterType = 'Male'; // Default to Male as male portraits are shown first\n    let selectedArchetypeIndex = 0; // Default to the first portrait\n    class AdventureGame {\n        constructor(characterType){\n            this.currentRoom = null;\n            this.roomHistory = []; // To track visited rooms for the 'back' command\n            this.gameState = 'pre-start'; // Add game state: pre-start, intro, playing, ended\n            this.interactionState = null; // For special interactions like RPS door\n            // Potentially use characterType to customize the player\n            this.player = new (0, $42615f55985a1754$export$cb68cc2163cd3f1)(characterType || 'Player', 100, 10, 5);\n            // If characterType is an archetype object, use its stats\n            if (typeof characterType === 'object' && characterType !== null && characterType.name) this.player = new (0, $42615f55985a1754$export$cb68cc2163cd3f1)(characterType.name, characterType.health, characterType.strength, characterType.dexterity, 25 // Starting gold\n            );\n            this.battleSystem = new (0, $202629da8e082d6a$export$761d71765f873338)();\n            // DOM elements guaranteed to exist if gameplayScreen is active\n            this.commandInput = document.getElementById('commandInput');\n            this.gameOutput = document.getElementById('gameOutput');\n            this.mapButton = document.getElementById('mapButton');\n            this.inventoryButton = document.getElementById('inventoryButton');\n            this.statsButton = document.getElementById('statsButton');\n            this.helpButton = document.getElementById('helpButton');\n            this.actionHandler = new (0, $4f211b8eb53ec7aa$export$b413f0fd99d7775)(this); // Initialize ActionHandler\n            this.displayManager = new (0, $2d63a410b342b8ee$export$dcc2704b47159cd7)(this, appendText); // Initialize DisplayManager\n            this.initializeGame();\n            this.updateStatusBars(); // Initial update of status bars\n        }\n        initializeGame() {\n            this.currentRoom = (0, $ac1ec18087c85c6d$export$bd9127779b59056d)(); // Initialize the world and get the starting room\n            this.gameState = 'intro'; // Set state to intro\n            // Initial message for the game start\n            if (this.gameOutput) {\n                // Use appendText for initial messages\n                appendText(\"In the shadowed alleys of the local bazaar, amidst discarded trinkets and whispered secrets, you find it: a tattered journal, its leather cover cracked with age. The pages are brittle, stained, and filled with a frantic, faded script. It speaks of a place of legend, Adorellan's most ancient site\\u2014the Labyrinth of Lyre.\");\n                appendText(\"The author writes of unimaginable treasure and riches waiting in its depths, but also of a challenge that has broken all who came before. It is a legendary, dangerous place, where the very walls are said to test the sanity of those who walk them.\");\n                appendText(\"Beyond the promise of gold, the journal hints at a greater prize: the chance to uncover lost knowledge and solve a mystery buried for millennia. The final entries are a scrawl of fear and regret, a tale of an expedition lost to the darkness.\");\n                appendText(\"The last legible line is not a plea, but a direct challenge that seems to lift from the page and settle upon you:\");\n                appendText(\"<strong>Will you succeed where they have failed?</strong>\");\n                appendText(\"<em>Type 'venture forth' to begin your adventure, or 'give up' to walk away.</em>\");\n                this.updateStatusBars(); // Update bars after player is fully initialized\n            }\n        }\n        processCommand(command) {\n            let response = '';\n            // --- Special Interaction State Handling ---\n            if (this.interactionState === 'rps_prompt') {\n                if (command === 'yes' || command === 'try my luck') {\n                    this.interactionState = 'rps_choice';\n                    response = \"You decide to test your fate. What do you play? (rock, paper, or scissors)\";\n                } else if (command === 'no') {\n                    this.interactionState = null;\n                    // Use the action handler to move the player back.\n                    response = this.actionHandler._handleMovement('back');\n                } else response = \"A simple 'yes' or 'no' will suffice.\";\n                this.displayMessage(response);\n                this.updateStatusBars();\n                return;\n            }\n            if (this.interactionState === 'rps_choice') {\n                if ([\n                    'rock',\n                    'paper',\n                    'scissors'\n                ].includes(command)) {\n                    response = this.actionHandler._handlePlay(command);\n                    // If the door is now unlocked (player won), reset the interaction state.\n                    if (response.includes(\"You win!\")) this.interactionState = null;\n                // If it's a draw or loss, the state remains 'rps_choice' for another try.\n                } else response = \"That's not a valid move. Choose rock, paper, or scissors.\";\n                this.displayMessage(response);\n                this.updateStatusBars();\n                return;\n            }\n            // --- End Special Interaction State Handling ---\n            if (this.gameState === 'intro') {\n                if (command === 'venture forth') {\n                    this.gameState = 'playing';\n                    response = `You steel your resolve and step towards the Labyrinth of Lyre.\\n\\n${this.currentRoom.getDescription(this.player)}`;\n                } else if (command === 'give up') {\n                    this.gameState = 'ended';\n                    response = \"You close the journal, the challenge unanswered. The Labyrinth will wait for another hero. You turn and walk away.\";\n                    this.commandInput.disabled = true;\n                } else response = \"The choice is before you. Will you 'venture forth' or 'give up'?\";\n                this.displayMessage(response);\n                this.updateStatusBars();\n                return; // Exit early\n            }\n            const parts = command.split(' ');\n            const verb = parts[0];\n            const object = parts.slice(1).join(' ');\n            if (this.battleSystem.inBattle) {\n                if (this.battleSystem.currentEnemy) {\n                    response = this.battleSystem.processBattleTurn(this.player, this.battleSystem.currentEnemy, verb, object);\n                    // If battle ended and monster was defeated, remove it from the room\n                    if (!this.battleSystem.inBattle && this.battleSystem.currentEnemy && !this.battleSystem.currentEnemy.isAlive) this.currentRoom.removeMonster(this.battleSystem.currentEnemy);\n                } else {\n                    response = \"Error: In battle but no current enemy defined. Exiting battle mode.\";\n                    this.battleSystem.inBattle = false; // Reset battle state\n                }\n            } else if (this.gameState === 'ended') // If game has ended, do nothing.\n            response = \"The adventure is over.\";\n            else // Not in battle, use ActionHandler for general commands\n            response = this.actionHandler.processCommand(verb, object);\n            // After any command, check if the player has entered the RPS room\n            // and if the door is still locked with the 'rps' condition.\n            if (this.currentRoom.name === 'Short Corridor' && this.currentRoom.lockedExits['forward'] === 'rps') this.interactionState = 'rps_prompt';\n            this.displayMessage(response);\n            this.updateStatusBars(); // Update status bars after every command\n        }\n        // displayMessage now solely relies on appendText for output\n        displayMessage(message, isCommandResponse = true) {\n            if (this.gameOutput) appendText(isCommandResponse ? `> ${message}` : message);\n        }\n        updateStatusBars() {\n            if (!this.player) return;\n            const healthFill = document.getElementById('healthBarFill');\n            const healthText = document.getElementById('healthBarText');\n            const expFill = document.getElementById('experienceBarFill');\n            const expText = document.getElementById('experienceBarText');\n            // Update Health Bar\n            if (healthFill && healthText) {\n                const healthPercent = Math.max(0, this.player.health / this.player.maxHealth * 100);\n                healthFill.style.width = `${healthPercent}%`;\n                healthText.textContent = `${this.player.health} / ${this.player.maxHealth}`;\n            }\n            // Update Experience Bar\n            if (expFill && expText) {\n                const expAtStartOfLevel = (this.player.level - 1) * 100;\n                const expForNextLevel = this.player.level * 100;\n                const expGainedThisLevel = this.player.experience - expAtStartOfLevel;\n                const expNeededThisLevel = expForNextLevel - expAtStartOfLevel;\n                // This correctly calculates the percentage of progress within the current level.\n                const expPercent = expNeededThisLevel > 0 ? Math.max(0, expGainedThisLevel / expNeededThisLevel * 100) : 0;\n                expFill.style.width = `${expPercent}%`;\n                expText.textContent = `${this.player.experience} / ${expForNextLevel}`;\n            }\n        }\n    }\n    function handleUpdateCharacterPortraits(gender) {\n        const genderLower = gender.toLowerCase();\n        // Path to the gender-specific folder (e.g., 'images/male/')\n        const folderPath = `images/${genderLower}/`;\n        // Remove 'selected' class from all portraits first\n        portraitImages.forEach((img)=>img.classList.remove('selected'));\n        portraitImages.forEach((imgElement, index)=>{\n            // Assumes filenames like 'male_1.png', 'female_1.png' inside respective folders\n            const filename = `${genderLower}_${index + 1}.png`;\n            // Using the `URL` constructor is the modern, reliable way to ask Parcel\n            // to resolve asset paths, especially when they are constructed dynamically.\n            imgElement.src = new URL(`${folderPath}${filename}`, \"file:///main.js\");\n            // Use archetype name for alt text\n            imgElement.alt = (0, $42615f55985a1754$export$8c85bdde2b83a480)[index] ? (0, $42615f55985a1754$export$8c85bdde2b83a480)[index].name : `${gender} Portrait ${index + 1}`;\n        });\n        // Automatically select the first portrait of the new gender if it exists\n        if (portraitImages.length > 0) {\n            selectedArchetypeIndex = 0; // Select the first one by default for the new gender\n            portraitImages[0].classList.add('selected');\n        } else selectedArchetypeIndex = null;\n    }\n    function handleTransitionToGameplay(characterType) {\n        // characterType is the selectedArchetype object\n        console.log(characterType.name + \" character selected.\");\n        if (characterSelectionScreen && gameplayScreen) {\n            // Set the player display image on the gameplay screen\n            const playerDisplayImgElement = document.getElementById('playerDisplayImage');\n            if (playerDisplayImgElement && selectedCharacterType && selectedArchetypeIndex !== null) {\n                const genderLower = selectedCharacterType.toLowerCase();\n                // Construct the image path based on selected gender and archetype index\n                const imageName = `${genderLower}_${selectedArchetypeIndex + 1}.png`; // e.g., male_1.png\n                // Using the `URL` constructor ensures Parcel correctly bundles and links the image,\n                // even with a dynamically generated path.\n                playerDisplayImgElement.src = new URL(`images/${genderLower}/${imageName}`, \"file:///main.js\");\n                playerDisplayImgElement.alt = characterType.name; // Use archetype name for alt text\n            }\n            characterSelectionScreen.classList.remove('active');\n            gameplayScreen.classList.add('active');\n        }\n        // Initialize the game *after* transitioning to gameplay screen\n        if (!gameInstance) {\n            gameInstance = new AdventureGame(characterType);\n            // Setup gameplay listeners now that gameInstance exists\n            (0, $4c1faa35fbcf99f6$export$81727421c76c3492)({\n                commandInput: document.getElementById('commandInput'),\n                mapButton: document.getElementById('mapButton'),\n                inventoryButton: document.getElementById('inventoryButton'),\n                statsButton: document.getElementById('statsButton'),\n                helpButton: document.getElementById('helpButton'),\n                gameInstance: gameInstance\n            });\n        }\n        if (commandInput) commandInput.focus(); // Focus on the command input when gameplay starts\n    }\n    // Callbacks for pre-gameplay event listeners\n    const preGameplayCallbacks = {\n        onStartGame: ()=>{\n            if (titleScreen && characterSelectionScreen) {\n                titleScreen.classList.remove('active');\n                characterSelectionScreen.classList.add('active');\n            }\n        },\n        onGenderSelected: (gender)=>{\n            selectedCharacterType = gender;\n            handleUpdateCharacterPortraits(gender);\n        },\n        onPortraitClicked: (clickedImgElement, index, allPortraits)=>{\n            allPortraits.forEach((img)=>img.classList.remove('selected'));\n            clickedImgElement.classList.add('selected');\n            selectedArchetypeIndex = index;\n        },\n        onConfirmCharacterClicked: ()=>{\n            if (selectedArchetypeIndex !== null && (0, $42615f55985a1754$export$8c85bdde2b83a480)[selectedArchetypeIndex]) {\n                const selectedArchetype = (0, $42615f55985a1754$export$8c85bdde2b83a480)[selectedArchetypeIndex];\n                handleTransitionToGameplay(selectedArchetype);\n            } else {\n                alert(\"Please select a character.\");\n                console.error(\"No archetype selected or index out of bounds.\");\n            }\n        }\n    };\n    // Setup pre-gameplay event listeners\n    (0, $4c1faa35fbcf99f6$export$22492a34fde78784)({\n        startButton: startButton,\n        selectMaleButton: selectMaleButton,\n        selectFemaleButton: selectFemaleButton,\n        confirmCharacterButton: confirmCharacterButton,\n        portraitImages: portraitImages,\n        statTooltip: statTooltip,\n        archetypeData: $42615f55985a1754$export$8c85bdde2b83a480,\n        ...preGameplayCallbacks\n    });\n    // Initial setup: select the first male portrait by default\n    if (portraitImages.length > 0) portraitImages[0].classList.add('selected');\n});\n\n\n//# sourceMappingURL=AdorellanAdventures.1df9ef8d.js.map\n","import { Room, createWorld } from './room.js'; // Import createWorld\r\nimport { Character, archetypeData } from './characters.js';\r\nimport { Monster } from './monsters.js';\r\nimport { Item } from './items.js';\r\nimport { ActionHandler } from './actions.js'; // Import ActionHandler\r\nimport { BattleSystem } from './battle.js';\r\nimport { DisplayManager } from './displayIt.js'; // Import DisplayManager\r\nimport { setupPreGameplayEventListeners, setupGameplayEventListeners } from './eventListeners.js'; // Import event listener setup functions\r\n\r\ndocument.addEventListener('DOMContentLoaded', () => {\r\n    const titleScreen = document.getElementById('titleScreen');\r\n    const startButton = document.getElementById('startButton');\r\n    const characterSelectionScreen = document.getElementById('characterSelectionScreen');\r\n    const selectMaleButton = document.getElementById('selectMaleButton');\r\n    const selectFemaleButton = document.getElementById('selectFemaleButton');\r\n    const gameplayScreen = document.getElementById('gameplayScreen');\r\n    const confirmCharacterButton = document.getElementById('confirmCharacterButton');\r\n    const commandInput = document.getElementById('commandInput'); // For re-focusing\r\n\r\n    // Get portrait image elements\r\n    const portraitImages = [];\r\n    for (let i = 1; i <= 6; i++) {\r\n        const portraitImg = document.getElementById(`portrait${i}`);\r\n        if (portraitImg) portraitImages.push(portraitImg);\r\n    }\r\n\r\n    // Create the tooltip element\r\n    const statTooltip = document.createElement('div');\r\n    statTooltip.id = 'statTooltip';\r\n    statTooltip.classList.add('tooltip');\r\n    // Append to body to avoid clipping issues with game-container's overflow:hidden\r\n    // and to simplify positioning relative to the viewport/mouse.\r\n    document.body.appendChild(statTooltip);\r\n\r\nconst gameOutput = document.getElementById('gameOutput');\r\nconst outputContainer = document.querySelector('.output-text-container'); // Get the container\r\n\r\nfunction appendText(text) {\r\n    // Replace all newline characters with <br> tags for proper HTML rendering\r\n    const formattedText = text.replace(/\\n/g, '<br>');\r\n    gameOutput.innerHTML += `<p>${formattedText}</p>`; // Append as a paragraph\r\n\r\n    // After adding text, scroll to the bottom\r\n    outputContainer.scrollTop = outputContainer.scrollHeight; \r\n}\r\n\r\n    let gameInstance = null; // To hold the AdventureGame instance\r\n    let selectedCharacterType = 'Male'; // Default to Male as male portraits are shown first\r\n    let selectedArchetypeIndex = 0;     // Default to the first portrait\r\n\r\n    class AdventureGame {\r\n        constructor(characterType) { // Accept characterType if needed for player setup\r\n            this.currentRoom = null;\r\n            this.roomHistory = []; // To track visited rooms for the 'back' command\r\n            this.gameState = 'pre-start'; // Add game state: pre-start, intro, playing, ended\r\n            this.interactionState = null; // For special interactions like RPS door\r\n            // Potentially use characterType to customize the player\r\n            this.player = new Character(characterType || 'Player', 100, 10, 5);\r\n            // If characterType is an archetype object, use its stats\r\n            if (typeof characterType === 'object' && characterType !== null && characterType.name) {\r\n                this.player = new Character(\r\n                    characterType.name,\r\n                    characterType.health,\r\n                    characterType.strength, // strength maps to attack\r\n                    characterType.dexterity, // dexterity maps to defense\r\n                    25 // Starting gold\r\n                );\r\n            }\r\n            this.battleSystem = new BattleSystem();\r\n            \r\n            // DOM elements guaranteed to exist if gameplayScreen is active\r\n            this.commandInput = document.getElementById('commandInput');\r\n            this.gameOutput = document.getElementById('gameOutput');\r\n            this.mapButton = document.getElementById('mapButton');\r\n            this.inventoryButton = document.getElementById('inventoryButton');\r\n            this.statsButton = document.getElementById('statsButton');\r\n            this.helpButton = document.getElementById('helpButton');\r\n            \r\n            this.actionHandler = new ActionHandler(this); // Initialize ActionHandler\r\n            this.displayManager = new DisplayManager(this, appendText); // Initialize DisplayManager\r\n            this.initializeGame();\r\n            this.updateStatusBars(); // Initial update of status bars\r\n        }\r\n        \r\n        initializeGame() {\r\n            this.currentRoom = createWorld(); // Initialize the world and get the starting room\r\n            this.gameState = 'intro'; // Set state to intro\r\n\r\n            // Initial message for the game start\r\n            if (this.gameOutput) { // Ensure gameOutput is available\r\n                // Use appendText for initial messages\r\n                appendText(\"In the shadowed alleys of the local bazaar, amidst discarded trinkets and whispered secrets, you find it: a tattered journal, its leather cover cracked with age. The pages are brittle, stained, and filled with a frantic, faded script. It speaks of a place of legend, Adorellan's most ancient sitethe Labyrinth of Lyre.\");\r\n                appendText(\"The author writes of unimaginable treasure and riches waiting in its depths, but also of a challenge that has broken all who came before. It is a legendary, dangerous place, where the very walls are said to test the sanity of those who walk them.\");\r\n                appendText(\"Beyond the promise of gold, the journal hints at a greater prize: the chance to uncover lost knowledge and solve a mystery buried for millennia. The final entries are a scrawl of fear and regret, a tale of an expedition lost to the darkness.\");\r\n                appendText(\"The last legible line is not a plea, but a direct challenge that seems to lift from the page and settle upon you:\");\r\n                appendText(\"<strong>Will you succeed where they have failed?</strong>\");\r\n                appendText(\"<em>Type 'venture forth' to begin your adventure, or 'give up' to walk away.</em>\");\r\n                this.updateStatusBars(); // Update bars after player is fully initialized\r\n            }\r\n        }\r\n        \r\n        processCommand(command) {\r\n            let response = '';\r\n\r\n            // --- Special Interaction State Handling ---\r\n            if (this.interactionState === 'rps_prompt') {\r\n                if (command === 'yes' || command === 'try my luck') {\r\n                    this.interactionState = 'rps_choice';\r\n                    response = \"You decide to test your fate. What do you play? (rock, paper, or scissors)\";\r\n                } else if (command === 'no') {\r\n                    this.interactionState = null;\r\n                    // Use the action handler to move the player back.\r\n                    response = this.actionHandler._handleMovement('back');\r\n                } else {\r\n                    response = \"A simple 'yes' or 'no' will suffice.\";\r\n                }\r\n                this.displayMessage(response);\r\n                this.updateStatusBars();\r\n                return;\r\n            }\r\n\r\n            if (this.interactionState === 'rps_choice') {\r\n                if (['rock', 'paper', 'scissors'].includes(command)) {\r\n                    response = this.actionHandler._handlePlay(command);\r\n                    // If the door is now unlocked (player won), reset the interaction state.\r\n                    if (response.includes(\"You win!\")) {\r\n                        this.interactionState = null;\r\n                    }\r\n                    // If it's a draw or loss, the state remains 'rps_choice' for another try.\r\n                } else {\r\n                    response = \"That's not a valid move. Choose rock, paper, or scissors.\";\r\n                }\r\n                this.displayMessage(response);\r\n                this.updateStatusBars();\r\n                return;\r\n            }\r\n            // --- End Special Interaction State Handling ---\r\n\r\n            if (this.gameState === 'intro') {\r\n                if (command === 'venture forth') {\r\n                    this.gameState = 'playing';\r\n                    response = `You steel your resolve and step towards the Labyrinth of Lyre.\\n\\n${this.currentRoom.getDescription(this.player)}`;\r\n                } else if (command === 'give up') {\r\n                    this.gameState = 'ended';\r\n                    response = \"You close the journal, the challenge unanswered. The Labyrinth will wait for another hero. You turn and walk away.\";\r\n                    this.commandInput.disabled = true;\r\n                } else {\r\n                    response = \"The choice is before you. Will you 'venture forth' or 'give up'?\"\r\n                }\r\n                this.displayMessage(response);\r\n                this.updateStatusBars();\r\n                return; // Exit early\r\n            }\r\n\r\n            const parts = command.split(' ');\r\n            const verb = parts[0];\r\n            const object = parts.slice(1).join(' ');\r\n\r\n            if (this.battleSystem.inBattle) {\r\n                if (this.battleSystem.currentEnemy) {\r\n                    response = this.battleSystem.processBattleTurn(this.player, this.battleSystem.currentEnemy, verb, object);\r\n                    // If battle ended and monster was defeated, remove it from the room\r\n                    if (!this.battleSystem.inBattle && this.battleSystem.currentEnemy && !this.battleSystem.currentEnemy.isAlive) {\r\n                        this.currentRoom.removeMonster(this.battleSystem.currentEnemy);\r\n                        // The battle system's endBattle method already provides exp/loot messages.\r\n                        // Optionally, append current room description if player is back to exploring.\r\n                        // response += `\\n\\n${this.currentRoom.getDescription()}`; \r\n                    }\r\n                } else {\r\n                    response = \"Error: In battle but no current enemy defined. Exiting battle mode.\";\r\n                    this.battleSystem.inBattle = false; // Reset battle state\r\n                }\r\n            } else if (this.gameState === 'ended') {\r\n                // If game has ended, do nothing.\r\n                response = \"The adventure is over.\";\r\n            } else {\r\n                // Not in battle, use ActionHandler for general commands\r\n                response = this.actionHandler.processCommand(verb, object);\r\n            }\r\n            \r\n            // After any command, check if the player has entered the RPS room\r\n            // and if the door is still locked with the 'rps' condition.\r\n            if (this.currentRoom.name === 'Short Corridor' && this.currentRoom.lockedExits['forward'] === 'rps') {\r\n                this.interactionState = 'rps_prompt';\r\n            }\r\n\r\n            this.displayMessage(response);\r\n            this.updateStatusBars(); // Update status bars after every command\r\n        }\r\n        \r\n        // displayMessage now solely relies on appendText for output\r\n        displayMessage(message, isCommandResponse = true) {\r\n            if (this.gameOutput) {\r\n                appendText(isCommandResponse ? `> ${message}` : message);            }\r\n        }\r\n\r\n        updateStatusBars() {\r\n            if (!this.player) return;\r\n\r\n            const healthFill = document.getElementById('healthBarFill');\r\n            const healthText = document.getElementById('healthBarText');\r\n            const expFill = document.getElementById('experienceBarFill');\r\n            const expText = document.getElementById('experienceBarText');\r\n\r\n            // Update Health Bar\r\n            if (healthFill && healthText) {\r\n                const healthPercent = Math.max(0, (this.player.health / this.player.maxHealth) * 100);\r\n                healthFill.style.width = `${healthPercent}%`;\r\n                healthText.textContent = `${this.player.health} / ${this.player.maxHealth}`;\r\n            }\r\n\r\n            // Update Experience Bar\r\n            if (expFill && expText) {\r\n                const expAtStartOfLevel = (this.player.level - 1) * 100;\r\n                const expForNextLevel = this.player.level * 100;\r\n                const expGainedThisLevel = this.player.experience - expAtStartOfLevel;\r\n                const expNeededThisLevel = expForNextLevel - expAtStartOfLevel;\r\n\r\n                // This correctly calculates the percentage of progress within the current level.\r\n                const expPercent = expNeededThisLevel > 0 ? Math.max(0, (expGainedThisLevel / expNeededThisLevel) * 100) : 0;\r\n                expFill.style.width = `${expPercent}%`;\r\n                expText.textContent = `${this.player.experience} / ${expForNextLevel}`;\r\n            }\r\n        }\r\n    }\r\n\r\n    function handleUpdateCharacterPortraits(gender) {\r\n        const genderLower = gender.toLowerCase();\r\n        // Path to the gender-specific folder (e.g., 'images/male/')\r\n        const folderPath = `images/${genderLower}/`;\r\n\r\n        // Remove 'selected' class from all portraits first\r\n        portraitImages.forEach(img => img.classList.remove('selected'));\r\n\r\n        portraitImages.forEach((imgElement, index) => {\r\n            // Assumes filenames like 'male_1.png', 'female_1.png' inside respective folders\r\n            const filename = `${genderLower}_${index + 1}.png`;\r\n            // Using the `URL` constructor is the modern, reliable way to ask Parcel\r\n            // to resolve asset paths, especially when they are constructed dynamically.\r\n            imgElement.src = new URL(`${folderPath}${filename}`, import.meta.url);\r\n            // Use archetype name for alt text\r\n            imgElement.alt = archetypeData[index] ? archetypeData[index].name : `${gender} Portrait ${index + 1}`;\r\n        });\r\n\r\n        // Automatically select the first portrait of the new gender if it exists\r\n        if (portraitImages.length > 0) {\r\n            selectedArchetypeIndex = 0; // Select the first one by default for the new gender\r\n            portraitImages[0].classList.add('selected');\r\n        } else {\r\n            selectedArchetypeIndex = null;\r\n        }\r\n    }\r\n\r\n    function handleTransitionToGameplay(characterType) {\r\n        // characterType is the selectedArchetype object\r\n        console.log(characterType.name + \" character selected.\");\r\n        \r\n        if (characterSelectionScreen && gameplayScreen) {\r\n            // Set the player display image on the gameplay screen\r\n            const playerDisplayImgElement = document.getElementById('playerDisplayImage');\r\n            if (playerDisplayImgElement && selectedCharacterType && selectedArchetypeIndex !== null) {\r\n                const genderLower = selectedCharacterType.toLowerCase();\r\n                // Construct the image path based on selected gender and archetype index\r\n                const imageName = `${genderLower}_${selectedArchetypeIndex + 1}.png`; // e.g., male_1.png\r\n                // Using the `URL` constructor ensures Parcel correctly bundles and links the image,\r\n                // even with a dynamically generated path.\r\n                playerDisplayImgElement.src = new URL(`images/${genderLower}/${imageName}`, import.meta.url);\r\n                playerDisplayImgElement.alt = characterType.name; // Use archetype name for alt text\r\n            }\r\n\r\n            characterSelectionScreen.classList.remove('active');\r\n            gameplayScreen.classList.add('active');\r\n        }\r\n        \r\n        // Initialize the game *after* transitioning to gameplay screen\r\n        if (!gameInstance) { // Ensure game is initialized only once\r\n            gameInstance = new AdventureGame(characterType);\r\n            // Setup gameplay listeners now that gameInstance exists\r\n            setupGameplayEventListeners({\r\n                commandInput: document.getElementById('commandInput'),\r\n                mapButton: document.getElementById('mapButton'),\r\n                inventoryButton: document.getElementById('inventoryButton'),\r\n                statsButton: document.getElementById('statsButton'),\r\n                helpButton: document.getElementById('helpButton'),\r\n                gameInstance\r\n            });\r\n        }\r\n\r\n        if (commandInput) {\r\n            commandInput.focus(); // Focus on the command input when gameplay starts\r\n        }\r\n    }\r\n    \r\n    // Callbacks for pre-gameplay event listeners\r\n    const preGameplayCallbacks = {\r\n        onStartGame: () => {\r\n            if (titleScreen && characterSelectionScreen) {\r\n                titleScreen.classList.remove('active');\r\n                characterSelectionScreen.classList.add('active');\r\n            }\r\n        },\r\n        onGenderSelected: (gender) => {\r\n            selectedCharacterType = gender;\r\n            handleUpdateCharacterPortraits(gender);\r\n        },\r\n        onPortraitClicked: (clickedImgElement, index, allPortraits) => {\r\n            allPortraits.forEach(img => img.classList.remove('selected'));\r\n            clickedImgElement.classList.add('selected');\r\n            selectedArchetypeIndex = index;\r\n        },\r\n        onConfirmCharacterClicked: () => {\r\n            if (selectedArchetypeIndex !== null && archetypeData[selectedArchetypeIndex]) {\r\n                const selectedArchetype = archetypeData[selectedArchetypeIndex];\r\n                handleTransitionToGameplay(selectedArchetype);\r\n            } else {\r\n                alert(\"Please select a character.\");\r\n                console.error(\"No archetype selected or index out of bounds.\");\r\n            }\r\n        }\r\n    };\r\n\r\n    // Setup pre-gameplay event listeners\r\n    setupPreGameplayEventListeners({\r\n        startButton,\r\n        selectMaleButton,\r\n        selectFemaleButton,\r\n        confirmCharacterButton,\r\n        portraitImages,\r\n        statTooltip,\r\n        archetypeData,\r\n        ...preGameplayCallbacks\r\n    });\r\n\r\n    // Initial setup: select the first male portrait by default\r\n    if (portraitImages.length > 0) {\r\n        portraitImages[0].classList.add('selected');\r\n    }\r\n});","import { Item } from './items.js';\r\nimport { Monster } from './monsters.js';\r\nimport { NPC } from './characters.js';\r\n\r\nexport class Room {\r\n    constructor(name, description) {\r\n        this.name = name;\r\n        this.description = description;\r\n        this.exits = {};\r\n        this.items = [];\r\n        this.monsters = [];\r\n        this.npcs = [];\r\n        this.visited = false;\r\n        this.lockedExits = {}; // New property to store locked exits\r\n    }\r\n    \r\n    setExit(direction, room) {\r\n        this.exits[direction] = room;\r\n    }\r\n    \r\n    setLockedExit(direction, room, keyName = 'lockpick') {\r\n        this.exits[direction] = room;\r\n        this.lockedExits[direction] = keyName;\r\n    }\r\n\r\n     addItem(item) {\r\n        this.items.push(item);\r\n    }\r\n    \r\n    removeItem(item) {\r\n        const index = this.items.indexOf(item);\r\n        if (index > -1) {\r\n            this.items.splice(index, 1);\r\n        }\r\n    }\r\n    \r\n    addMonster(monster) {\r\n        this.monsters.push(monster);\r\n    }\r\n    \r\n    addNPC(npc) {\r\n        this.npcs.push(npc);\r\n    }\r\n\r\n    removeMonster(monster) {\r\n        const index = this.monsters.indexOf(monster);\r\n        if (index > -1) {\r\n            this.monsters.splice(index, 1);\r\n        }\r\n    }\r\n    \r\n    getDescription(player) { // Pass player to allow for dynamic descriptions\r\n        this.visited = true;\r\n        let baseDesc = this.description;\r\n\r\n        // Dynamic description for the Vault based on player inventory\r\n        if (this.name === 'The Vault' && player && player.hasItem('red key') && player.hasItem('blue key')) {\r\n            baseDesc = 'A massive, circular iron door dominates one wall of this room. It is sealed shut with no obvious handle or lock. Finely etched into its surface is the depiction of a great tree, its branches heavy with what look like round fruit. A small, empty nest is tucked among the boughs, and a dark, fist-sized hollow is visible in the trunk. The entire etching now emits a strong pulse, almost like a heartbeat, bathing the room in a rhythmic purple glow.';\r\n        }\r\n\r\n        let desc = `${this.name}\\n${baseDesc}`;\r\n        \r\n        if (this.items.length > 0) {\r\n            desc += `\\n\\nYou see: ${this.items.map(item => item.name).join(', ')}`;\r\n        }\r\n        \r\n        if (this.monsters.length > 0) {\r\n            desc += `\\n\\nCreatures present: ${this.monsters.map(monster => monster.name).join(', ')}`;\r\n        }\r\n\r\n        if (this.npcs.length > 0) {\r\n            desc += `\\n\\nPeople here: ${this.npcs.map(npc => npc.name).join(', ')}`;\r\n        }\r\n        \r\n        const exitList = Object.keys(this.exits);\r\n        if (exitList.length > 0) {\r\n            const formattedExits = exitList.map(direction => {\r\n                if (this.lockedExits[direction]) {\r\n                    return `${direction} (locked)`; // Keep template literal for consistency\r\n                } else {\r\n                    return direction;\r\n                }\r\n            });\r\n            desc += `\\n\\nExits: ${formattedExits.join(', ')}`;\r\n        }\r\n        \r\n        return desc;\r\n    }\r\n    \r\n    hasExit(direction) {\r\n        return this.exits.hasOwnProperty(direction);\r\n    }\r\n    \r\n    getExit(direction) {\r\n        return this.exits[direction];\r\n    }\r\n\r\n    unlockExit(direction) {\r\n        if (this.lockedExits[direction]) {\r\n            const destinationRoom = this.exits[direction];\r\n            const exitName = destinationRoom.name;\r\n\r\n            // Unlock this side\r\n            delete this.lockedExits[direction];\r\n\r\n            // Find and unlock the return path on the other side\r\n            for (const returnDir in destinationRoom.exits) {\r\n                if (destinationRoom.exits[returnDir] === this) {\r\n                    if (destinationRoom.lockedExits[returnDir]) {\r\n                        delete destinationRoom.lockedExits[returnDir];\r\n                    }\r\n                    break;\r\n                }\r\n            }\r\n\r\n            return `You've unlocked the exit to the ${exitName}!`;\r\n        }\r\n        return `The exit to the ${this.exits[direction].name} wasn't locked.`;\r\n    }\r\n}\r\n\r\nexport function createWorld() {\r\n    // --- 1. Define World Data ---\r\n    const roomData = {\r\n        'entrance': { name: 'The Glade', description: 'After what feels like an eternity of pushing through an unforgiving, dense forest, the trees finally part. You step into a secluded glade, a place that feels untouched by time. The air is crisp, filled with the scent of damp earth and decaying leaves. A circle of towering trees, their leaves a brilliant tapestry of gold, crimson, and amber, stands as silent sentinels, walling this place off from the outside world. It\\'s clear why this glade has remained hidden for so long.\\n\\nBefore you stands the true prize of your journey: the entrance to The Labyrinth of Lyre, Adorellan\\'s most ancient and storied site. The entrance is formidable. Tall, ancient stone walls, grey and weathered with age, rise up to meet the sky. Set within these walls are thick, heavy wrought-iron gates, their surface pitted with rust and age. A dense curtain of thick, dark green vines chokes the gates, weaving through the bars so completely that nothing of the labyrinth beyond can be seen. The silence here is profound, broken only by the rustle of leaves under your feet.' },\r\n        'courtyard': { name: 'The Garden of Grie', description: 'With a final, desperate shove, the ancient iron gates groan in protest, their rusted hinges screaming as they reluctantly give way. You stumble forward, catching your balance on the cracked flagstones of a vast, open courtyard. The air here is still and heavy, carrying the scent of dust and forgotten time. With a brief look you notice the discarded remains of old camps and items that belonged to brave adventures long since forgotten.\\n\\nIn the centre of the courtyard, a once-grand fountain lies in ruins. Its stone basin shattered, and the statue that once stood proudly at its heart is now a toppled, moss-covered casualty of age. A trickle of dark, stagnant water weeps from a crack, pooling on the ground below.\\n\\nYour eyes are drawn to the far side of the courtyard. Dominating the wall is a massive, intricate circular carving, its ancient design a complex web of interlocking lines and symbols that seem to writhe just at the edge of your vision. Flanking this mysterious emblem are two arched exits.\\n\\nTo the left, a sturdy iron gate, similar to the one you just forced open, blocks the archway, promising another challenge. To the right, the archway is filled with the splintered remains of a wooden door, hanging precariously from a single hinge, offering a seemingly easier, though perhaps more treacherous, path forward.' },\r\n        'bunkers': { name: 'Bunker\\'s Bend', description: 'Rows of dusty, empty bunks line the walls of this large, cold room. It seems to have been abandoned long ago.' },\r\n        'clinkers': { name: 'Clinker\\'s Armoury', description: 'This chamber serves as a makeshift armoury. Racks of rusted weapons and dented armour line the walls. Most of it is useless, but some treasures may yet remain.' },\r\n        'market': { name: 'The Sunken Market', description: 'You step into what was clearly once a bustling underground market. Broken stalls and scattered, worthless goods litter the floor. It seems you are the first to enter in a very long time.' },\r\n        'marketCorridor': { name: 'Short Corridor', description: 'A short, narrow corridor. About halfway down, a sturdy-looking wooden door blocks the path forward. A strange inscription on the door depicts a hand, a stone, and some parchment. It seems to be a game of chance. Do you try your luck?' },\r\n        'bunkerHallway': { name: 'Cluttered Hallway', description: 'This hallway is cluttered with scattered bits and bobs left behind by previous inhabitants - tattered clothes, worthless trinkets, and other debris. It continues forward towards Bunker\\'s Bend.' },\r\n        'armouryHallway': { name: 'Decrepit Hallway', description: 'The splintered remains of a wooden door lead into this short, dusty hallway. It continues forward, where you can see the entrance to another chamber.' },\r\n        'vault': { name: 'The Vault', description: 'A massive, circular iron door dominates one wall of this room. It is sealed shut with no obvious handle or lock. Finely etched into its surface is the depiction of a great tree, its branches heavy with what look like round fruit. A small, empty nest is tucked among the boughs, and a dark, fist-sized hollow is visible in the trunk. The entire etching glows with a faint, otherworldly purple light.' },\r\n        'vaultHallway': { name: 'Vault Hallway', description: 'A short, sterile hallway with smooth stone walls. A simple revolving iron gate stands behind you, leading back to the market. Ahead, the hallway ends at the massive circular door of The Vault.' },\r\n        'zHallway': { name: 'Z-Shaped Hallway', description: 'A cramped, narrow hallway that takes a sharp turn before continuing. The stone is cold and damp to the touch. One way leads towards the market, while the path behind you returns to the bunkers.' },\r\n        'temple': { name: 'The Forgotten Temple', description: 'An eerie silence hangs in this grand temple. Faded murals on the walls depict forgotten gods.' },\r\n        'safezone': { name: 'Haven Shield', description: 'The narrow corridor opens into a breathtaking, sun-dappled glade that feels entirely separate from the labyrinth. The walls are lined with ancient, towering trees, their leaves forming a dense canopy overhead. In the center of the glade is a serene, crystal-clear lake. On the far side of the lake stands a single, rustic-looking cabin. There are signs of others who have made it this far: the remnants of abandoned campfires and a discarded waterskin near the cabin\\'s entrance.' },\r\n        'grebs': { name: 'Greb\\'s Grotto', description: 'This small, surprisingly cozy cavern is a chaotic mess of discarded adventuring gear. Piles of dented helmets, mismatched boots, and chipped shields are stacked against the walls. A small, friendly-looking red imp with large, curious eyes tends to a makeshift counter made from a large, flat rock. He seems to be sorting through a pile of rusty keys.' },\r\n        'scriptorium': { name: 'The Scriptorium', description: 'Rotting shelves filled with decaying books and scrolls line the walls. The air is thick with the smell of dust and old paper.' },\r\n        'chamber': { name: 'The Mercurial Den', description: 'A vast, circular chamber where the walls shimmer with thousands of luminescent crystals, casting a beautiful, eerie light.' },\r\n        'grottoHallway': { name: 'Cluttered Passageway', description: 'A short passageway littered with discarded items - a broken lantern, a tattered cloak, and other adventuring debris. It seems to be a well-traveled route.' },\r\n        'bendyHallway': { name: 'Winding Corridor', description: 'A long, winding corridor that bends out of sight. The air feels strangely calm and quiet here.' },\r\n        'rockCrevice': { name: 'Rock Crevice', description: 'A narrow crevice in the rock face, almost hidden by overgrown vines. It looks like a tight squeeze.' },\r\n        'hiddenCavern': { name: 'Hidden Cavern', description: 'The crevice opens into a small, damp cavern. A crude, heavy wooden door is set into the far wall.' },\r\n        'windingPassage': { name: 'Winding Passage', description: 'Beyond the door is a long, winding passage carved from the rock. It slopes gently downwards and ends at another door, which looks like it can only be opened from this side.' }\r\n    };\r\n\r\n    const connectionData = [\r\n        { from: 'entrance', to: 'courtyard', direction: 'forward', returnDirection: 'back' },\r\n        // Path from courtyard to clinkers (right exit)\r\n        { from: 'courtyard', to: 'armouryHallway', direction: 'right', returnDirection: 'back' },\r\n        { from: 'armouryHallway', to: 'clinkers', direction: 'forward', returnDirection: 'back' },\r\n        // Path from courtyard to bunkers (left exit, locked)\r\n        { from: 'courtyard', to: 'bunkerHallway', direction: 'left', returnDirection: 'back', locked: true },\r\n        { from: 'bunkerHallway', to: 'bunkers', direction: 'forward', returnDirection: 'back' },\r\n        // Path from Clinker's to the Market (left exit, locked)\r\n        { from: 'clinkers', to: 'marketCorridor', direction: 'left', returnDirection: 'back' },\r\n        { from: 'marketCorridor', to: 'market', direction: 'forward', returnDirection: 'back', locked: 'rps' },\r\n        // Path from the Market to the Temple\r\n        { from: 'market', to: 'temple', direction: 'forward', returnDirection: 'back' },\r\n        { from: 'temple', to: 'scriptorium', direction: 'left', returnDirection: 'back' },\r\n        { from: 'scriptorium', to: 'chamber', direction: 'forward', returnDirection: 'back' },\r\n        // Path from the Market to the Vault\r\n        { from: 'market', to: 'vaultHallway', direction: 'right', returnDirection: 'back' },\r\n        { from: 'vaultHallway', to: 'vault', direction: 'forward', returnDirection: 'back' },\r\n        // Path from the Market to the Bunkers (via a locked door from Bunkers)\r\n        { from: 'market', to: 'zHallway', direction: 'left', returnDirection: 'back' },\r\n        { from: 'bunkers', to: 'zHallway', direction: 'forward', returnDirection: 'back', locked: true, twoWayLock: true },\r\n        // Paths from the Mercurial Den\r\n        { from: 'chamber', to: 'grottoHallway', direction: 'forward', returnDirection: 'back' },\r\n        { from: 'grottoHallway', to: 'grebs', direction: 'forward', returnDirection: 'back' },\r\n        { from: 'chamber', to: 'bendyHallway', direction: 'right', returnDirection: 'back' },\r\n        { from: 'bendyHallway', to: 'safezone', direction: 'forward', returnDirection: 'back' },\r\n        // New one-way path from Haven Shield to the Temple\r\n        { from: 'safezone', to: 'rockCrevice', direction: 'right', returnDirection: 'back' },\r\n        { from: 'rockCrevice', to: 'hiddenCavern', direction: 'forward', returnDirection: 'back' },\r\n        { from: 'hiddenCavern', to: 'windingPassage', direction: 'forward', returnDirection: 'back' },\r\n        { from: 'windingPassage', to: 'temple', direction: 'forward', oneWay: true },\r\n    ];\r\n\r\n    const itemPlacement = {\r\n        'courtyard': [new Item('torch', 'A flickering torch that provides light in dark places.', true)],\r\n        'chamber': [new Item('crystal', 'A glowing blue crystal that pulses with mystical energy.', true)],\r\n        'clinkers': [new Item('sword', 'An ancient sword with mysterious runes etched into the blade.', true)],\r\n        'armouryHallway': [new Item('lockpick', 'A set of lock picks, half-hidden under some debris. Useful for opening locked doors.', true)],\r\n        'market': [new Item('potion', 'A healing potion, left behind on a stall.', true)], // Added a reward for getting into the market\r\n        'scriptorium': [new Item('red key', 'A key crafted from a single piece of ruby, warm to the touch.', true)],\r\n        'grottoHallway': [new Item('potion', 'A healing potion, dropped carelessly on the floor.', true)],\r\n        'safezone': [new Item('waterskin', 'A discarded waterskin, still half-full of clean water.', true)]\r\n    };\r\n\r\n\r\n\r\n    const monsterPlacement = {\r\n        'chamber': [new Monster('Goblin', 30, 8, 3, 'A small, green creature with glowing red eyes.')]\r\n    };\r\n\r\n    const npcPlacement = {\r\n        'grebs': [new NPC('Grebgela', 50, 0, 5, 'A small red imp with large, curious eyes. He fidgets with a collection of shiny trinkets on his makeshift counter, a wide, toothy grin spreading across his face when he notices you.', \r\n        {\r\n            'default': [\"'Allo there, adventurer! Welcome to Greb's Grotto!\", \"See anything you like? Just bits and bobs I find, but one person's junk is another imp's treasure, eh?\"],\r\n            'keys': [\"Ah, these old things?\", \"Just some rusty keys I found. None of 'em seem to fit anything important... yet!\", \"Maybe you'll have better luck with them than I did!\"],\r\n            'grotto': [\"It ain't much, but it's home! And it's full of wonderful junk!\", \"A bit messy, I know. I call it 'organized chaos'!\"],\r\n            'shop': [\"Everything here is for sale, friend! If you've got the coin, I've got the... well, the 'stuff'!\", \"Just 'list' what I've got, or 'buy [item name]' if you see something you fancy!\"]\r\n        },\r\n        [ // Shop Inventory\r\n            { item: new Item('blue key', 'A key made of sapphire, cool and smooth in your hand.', true), price: 25 },\r\n            { item: new Item('skeleton key', 'A key made from bone, said to open any locked chest.', true), price: 50 },\r\n            { item: new Item('potion', 'A healing potion, brewed by Grebgela himself. Smells faintly of swamp water.', true), price: 15 }\r\n        ])],\r\n    };\r\n\r\n    // --- 2. Build the World from Data ---\r\n    const rooms = {};\r\n\r\n    // Create all room instances\r\n    for (const id in roomData) {\r\n        rooms[id] = new Room(roomData[id].name, roomData[id].description);\r\n    }\r\n\r\n    // Create all connections between rooms\r\n    for (const conn of connectionData) {\r\n        const fromRoom = rooms[conn.from];\r\n        const toRoom = rooms[conn.to];\r\n\r\n        if (conn.locked) {\r\n            fromRoom.setLockedExit(conn.direction, toRoom, conn.locked);\r\n        } else {\r\n            fromRoom.setExit(conn.direction, toRoom);\r\n        }\r\n\r\n        // If the connection is not one-way, set the return path\r\n        if (!conn.oneWay) {\r\n            // If it's a two-way lock, lock the return path. Otherwise, set a normal exit.\r\n            if (conn.twoWayLock) {\r\n                toRoom.setLockedExit(conn.returnDirection, fromRoom, conn.locked);\r\n            } else {\r\n                toRoom.setExit(conn.returnDirection, fromRoom);\r\n            }\r\n        }\r\n    }\r\n\r\n    // Place items and monsters in rooms\r\n    for (const roomId in itemPlacement) {\r\n        itemPlacement[roomId].forEach(item => rooms[roomId].addItem(item));\r\n    }\r\n    for (const roomId in monsterPlacement) {\r\n        monsterPlacement[roomId].forEach(monster => rooms[roomId].addMonster(monster));\r\n    }\r\n    for (const roomId in npcPlacement) {\r\n        npcPlacement[roomId].forEach(npc => rooms[roomId].addNPC(npc));\r\n    }\r\n\r\n    // --- 3. Return the Starting Room ---\r\n    return rooms['entrance'];\r\n}","export class Item {\r\n    constructor(name, description, canTake = true, isUsable = true) {\r\n        this.name = name;\r\n        this.description = description;\r\n        this.canTake = canTake;\r\n        this.isUsable = isUsable;\r\n        this.isConsumed = false;\r\n    }\r\n    \r\n    use(player, room) {\r\n        if (!this.isUsable) {\r\n            return `The ${this.name} cannot be used.`;\r\n        }\r\n        \r\n        switch(this.name) {\r\n            case 'torch':\r\n                return this.useTorch(player, room);\r\n            case 'crystal':\r\n                return this.useCrystal(player, room);\r\n            case 'sword':\r\n                return this.useSword(player, room);\r\n            case 'key':\r\n                return this.useKey(player, room);\r\n            case 'potion':\r\n                return this.usePotion(player, room);\r\n            default:\r\n                return `You use the ${this.name}, but nothing happens.`;\r\n        }\r\n    }\r\n    \r\n    useTorch(player, room) {\r\n        return 'The torch illuminates the area, revealing hidden details in the shadows.';\r\n    }\r\n    \r\n    useCrystal(player, room) {\r\n        return 'The crystal pulses with energy, and you feel your strength renewed.';\r\n    }\r\n    \r\n    useSword(player, room) {\r\n        player.attack += 5;\r\n        return 'You feel more confident with the sword in hand. Your attack power increases!';\r\n    }\r\n    \r\n    useKey(player, room) {\r\n        return 'The key fits perfectly into a hidden lock you discover on the wall.';\r\n    }\r\n    \r\n    usePotion(player, room) {\r\n        player.health = Math.min(player.maxHealth, player.health + 20);\r\n        this.isConsumed = true;\r\n        return 'You drink the potion and feel refreshed. Your health is restored!';\r\n    }\r\n    \r\n    examine() {\r\n        return this.description;\r\n    }\r\n}\r\n\r\nexport class ItemManager {\r\n    constructor() {\r\n        this.items = new Map();\r\n        this.initializeItems();\r\n    }\r\n    \r\n    initializeItems() {\r\n        const itemData = [\r\n            { name: 'torch', desc: 'A flickering torch that provides light.', take: true },\r\n            { name: 'crystal', desc: 'A mystical crystal that glows with inner light.', take: true },\r\n            { name: 'sword', desc: 'An ancient blade with mystical properties.', take: true },\r\n            { name: 'key', desc: 'An ornate key that looks very old.', take: true },\r\n            { name: 'potion', desc: 'A small vial containing a healing elixir.', take: true },\r\n            { name: 'chest', desc: 'A heavy wooden chest bound with iron.', take: false },\r\n            { name: 'statue', desc: 'An ancient statue covered in mysterious runes.', take: false }\r\n        ];\r\n        \r\n        itemData.forEach(data => {\r\n            this.items.set(data.name, new Item(data.name, data.desc, data.take));\r\n        });\r\n    }\r\n    \r\n    getItem(name) {\r\n        return this.items.get(name);\r\n    }\r\n    \r\n    createItem(name, description, canTake = true) {\r\n        const item = new Item(name, description, canTake);\r\n        this.items.set(name, item);\r\n        return item;\r\n    }\r\n}","export class Monster {\r\n    constructor(name, health, attack, defense, description = '') {\r\n        this.name = name;\r\n        this.health = health;\r\n        this.maxHealth = health;\r\n        this.attack = attack;\r\n        this.defense = defense;\r\n        this.description = description;\r\n        this.isAlive = true;\r\n        this.experienceValue = Math.floor(health / 2) + attack;\r\n        this.loot = [];\r\n    }\r\n    \r\n    takeDamage(damage) {\r\n        const actualDamage = Math.max(1, damage - this.defense);\r\n        this.health -= actualDamage;\r\n        this.health = Math.max(0, this.health);\r\n        \r\n        if (this.health <= 0) {\r\n            this.isAlive = false;\r\n        }\r\n        \r\n        return actualDamage;\r\n    }\r\n    \r\n    attackPlayer(player) {\r\n        let damage;\r\n        let isCritical = false;\r\n\r\n        if (this.name === 'Goblin') {\r\n            damage = Math.floor(Math.random() * 5) + 1; // Damage 1-5 for Goblin\r\n            if (damage >= 4) { // 4 or 5 is critical for Goblin\r\n                isCritical = true;\r\n            }\r\n        } else {\r\n            // Default attack logic for other monsters\r\n            damage = Math.floor(Math.random() * this.attack) + 1;\r\n            // Future: Add critical hit logic for other monsters if needed\r\n        }\r\n        \r\n        return { damage, isCritical };\r\n    }\r\n    \r\n    getAttackMessage() {\r\n        const messages = [\r\n            `The ${this.name} lunges at you!`,\r\n            `The ${this.name} strikes with fury!`,\r\n            `The ${this.name} attacks viciously!`,\r\n            `The ${this.name} bares its claws and attacks!`\r\n        ];\r\n        return messages[Math.floor(Math.random() * messages.length)];\r\n    }\r\n    \r\n    getDeathMessage() {\r\n        const messages = [\r\n            `The ${this.name} falls to the ground, defeated.`,\r\n            `The ${this.name} lets out a final roar and collapses.`,\r\n            `The ${this.name} crumbles into dust.`,\r\n            `The ${this.name} retreats into the shadows, defeated.`\r\n        ];\r\n        return messages[Math.floor(Math.random() * messages.length)];\r\n    }\r\n    \r\n    addLoot(item) {\r\n        this.loot.push(item);\r\n    }\r\n    \r\n    dropLoot() {\r\n        return this.loot;\r\n    }\r\n}\r\n\r\nexport class MonsterFactory {\r\n    static createGoblin() {\r\n        const goblin = new Monster(\r\n            'Goblin',\r\n            30,\r\n            8,\r\n            3,\r\n            'A small, green creature with glowing red eyes and sharp claws.'\r\n        );\r\n        return goblin;\r\n    }\r\n    \r\n    static createTroll() {\r\n        const troll = new Monster(\r\n            'Cave Troll',\r\n            60,\r\n            15,\r\n            8,\r\n            'A massive creature with stone-like skin that guards the cave depths.'\r\n        );\r\n        return troll;\r\n    }\r\n    \r\n    static createBat() {\r\n        const bat = new Monster(\r\n            'Giant Bat',\r\n            20,\r\n            6,\r\n            2,\r\n            'A large bat with leathery wings and glowing eyes.'\r\n        );\r\n        return bat;\r\n    }\r\n    \r\n    static createSpider() {\r\n        const spider = new Monster(\r\n            'Cave Spider',\r\n            25,\r\n            10,\r\n            4,\r\n            'A venomous spider the size of a small dog with eight glowing eyes.'\r\n        );\r\n        return spider;\r\n    }\r\n    \r\n    static createDragon() {\r\n        const dragon = new Monster(\r\n            'Crystal Dragon',\r\n            100,\r\n            25,\r\n            15,\r\n            'An ancient dragon made of living crystal, guardian of the deepest treasures.'\r\n        );\r\n        return dragon;\r\n    }\r\n}","export class Character {\r\n    constructor(name, health, attack, defense, gold = 0) {\r\n        this.name = name;\r\n        this.health = health;\r\n        this.maxHealth = health;\r\n        this.attack = attack;\r\n        this.defense = defense;\r\n        this.inventory = [];\r\n        this.experience = 0;\r\n        this.level = 1;\r\n        this.gold = gold;\r\n    }\r\n    \r\n    takeDamage(damage) {\r\n        const actualDamage = Math.max(1, damage - this.defense);\r\n        this.health -= actualDamage;\r\n        this.health = Math.max(0, this.health);\r\n        return actualDamage;\r\n    }\r\n    \r\n    heal(amount) {\r\n        this.health += amount;\r\n        this.health = Math.min(this.maxHealth, this.health);\r\n    }\r\n    \r\n    isAlive() {\r\n        return this.health > 0;\r\n    }\r\n    \r\n    addItem(item) {\r\n        this.inventory.push(item);\r\n    }\r\n    \r\n    removeItem(item) {\r\n        const index = this.inventory.indexOf(item);\r\n        if (index > -1) {\r\n            this.inventory.splice(index, 1);\r\n        }\r\n    }\r\n    \r\n    hasItem(itemName) {\r\n        // Make comparison case-insensitive to handle variations in user input\r\n        return this.inventory.some(item => item.name.toLowerCase() === itemName.toLowerCase());\r\n    }\r\n    \r\n    getItem(itemName) {\r\n        return this.inventory.find(item => item.name.toLowerCase() === itemName.toLowerCase());\r\n    }\r\n    \r\n    gainExperience(exp) {\r\n        this.experience += exp;\r\n        if (this.experience >= this.level * 100) {\r\n            this.levelUp();\r\n        }\r\n    }\r\n    \r\n    levelUp() {\r\n        this.level++;\r\n        this.maxHealth += 10;\r\n        this.health = this.maxHealth;\r\n        this.attack += 2;\r\n        this.defense += 1;\r\n        return `You reached level ${this.level}! Your stats have improved.`;\r\n    }\r\n    \r\n    getStats() {\r\n        return {\r\n            name: this.name,\r\n            level: this.level,\r\n            health: this.health,\r\n            maxHealth: this.maxHealth,\r\n            attack: this.attack,\r\n            defense: this.defense,\r\n            experience: this.experience,\r\n            gold: this.gold\r\n        };\r\n    }\r\n}\r\n\r\nexport class NPC extends Character {\r\n    constructor(name, health, attack, defense, description = '', responses = {}, shopInventory = []) {\r\n        super(name, health, attack, defense);\r\n        this.description = description;\r\n        this.responses = responses; // e.g., { default: [\"Hi\"], shop: [\"Want to buy?\"] }\r\n        this.isHostile = false;\r\n        this.dialogueCounters = {}; // Tracks index for each topic, e.g., { default: 0, shop: 1 }\r\n        this.shopInventory = shopInventory;\r\n    }\r\n    \r\n    speak(topic = 'default') {\r\n        const topicResponses = this.responses[topic] || this.responses['default'];\r\n\r\n        if (!topicResponses || topicResponses.length === 0) {\r\n            return `${this.name} has nothing to say.`;\r\n        }\r\n\r\n        // Initialize counter for this topic if it doesn't exist\r\n        if (this.dialogueCounters[topic] === undefined) {\r\n            this.dialogueCounters[topic] = 0;\r\n        }\r\n\r\n        // Get the current message and advance the counter for this topic\r\n        const messageIndex = this.dialogueCounters[topic];\r\n        const message = topicResponses[messageIndex];\r\n        this.dialogueCounters[topic] = (messageIndex + 1) % topicResponses.length;\r\n\r\n        return `${this.name} says: \"${message}\"`;\r\n    }\r\n    \r\n    setHostile(hostile) {\r\n        this.isHostile = hostile;\r\n    }\r\n\r\n    turnHostile() {\r\n        this.isHostile = true;\r\n        return `${this.name} becomes hostile!`;\r\n    }\r\n}\r\n\r\n// Define base stats for the 6 character archetypes/portraits\r\nexport const archetypeData = [\r\n    { name: \"Warrior\", health: 120, strength: 15, dexterity: 10, agility: 8, intelligence: 5, charisma: 7 },\r\n    { name: \"Rogue\",   health: 90,  strength: 10, dexterity: 15, agility: 12, intelligence: 8, charisma: 10 },\r\n    { name: \"Ranger\",  health: 100, strength: 12, dexterity: 14, agility: 10, intelligence: 7, charisma: 8 },\r\n    { name: \"Bard\",    health: 85,  strength: 8,  dexterity: 12, agility: 9,  intelligence: 12, charisma: 15 },\r\n    { name: \"Healer\",  health: 95,  strength: 7,  dexterity: 9,  agility: 7,  intelligence: 14, charisma: 12 },\r\n    { name: \"Mage\",    health: 80,  strength: 6,  dexterity: 8,  agility: 6,  intelligence: 16, charisma: 9 }\r\n];","export class ActionHandler {\r\n    constructor(gameInstance) {\r\n        this.game = gameInstance; // Provides access to game.player, game.currentRoom, game.battleSystem etc.\r\n    }\r\n\r\n    processCommand(verb, object) {\r\n        let response = '';\r\n\r\n        switch (verb) {\r\n            case 'go':\r\n                response = this._handleMovement(object);\r\n                break;\r\n            case 'look':\r\n                response = this._handleLook(object);\r\n                break;\r\n            case 'inspect':\r\n                response = this._handleInspect(object);\r\n                break;\r\n            case 'search':\r\n                response = this._handleSearch();\r\n                break;\r\n            case 'take':\r\n                response = this._handleTake(object);\r\n                break;\r\n            case 'use':\r\n                response = this._handleUse(object);\r\n                break;\r\n            case 'drop':\r\n                response = this._handleDrop(object);\r\n                break;\r\n            case 'attack':\r\n            case 'fight':\r\n            case 'battle':\r\n                response = this._handleBattle(object);\r\n                break;\r\n            case 'flee':\r\n                // This handles 'flee' outside of combat.\r\n                // Fleeing during combat is handled by BattleSystem.processBattleTurn\r\n                response = this._handleFlee();\r\n                break;\r\n            case 'left':\r\n            case 'right':\r\n            case 'forward':\r\n            case 'back':\r\n                response = this._handleMovement(verb);\r\n                break;\r\n            case 'pick':\r\n                response = this._handlePick(object);\r\n                break;\r\n            case 'help':\r\n                response = this._handleHelp();\r\n                break;\r\n            case 'play':\r\n                response = this._handlePlay(object);\r\n                break;\r\n            case 'talk':\r\n                response = this._handleTalk(object);\r\n                break;\r\n            case 'list':\r\n                response = this._handleList();\r\n                break;\r\n            case 'buy':\r\n                response = this._handleBuy(object);\r\n                break;\r\n            default:\r\n                response = \"I don't understand that command. Try 'help' to see a list of available commands.\";\r\n        }\r\n        return response;\r\n    }\r\n\r\n    _handleMovement(direction) {\r\n        const allowedDirections = ['forward', 'back', 'left', 'right'];\r\n        if (!allowedDirections.includes(direction)) {\r\n            return `You can only move in these directions: forward, back, left, right.`;\r\n        }\r\n\r\n        // Handle the 'back' command dynamically\r\n        if (direction === 'back') {\r\n            if (this.game.roomHistory.length > 0) {\r\n                // Pop the last room from history to go back\r\n                this.game.currentRoom = this.game.roomHistory.pop();\r\n                return `You go back.\\n\\n${this.game.currentRoom.getDescription(this.game.player)}`;\r\n            } else {\r\n                return \"You can't go back any further.\";\r\n            }\r\n        }\r\n\r\n        // Handle all other directions\r\n        const exit = this.game.currentRoom.getExit(direction);\r\n        if (exit) {\r\n            // CRITICAL: Check if the exit is locked before moving\r\n            if (this.game.currentRoom.lockedExits[direction]) {\r\n                return \"That way is locked.\";\r\n            }\r\n\r\n            // Add the current room to history before moving\r\n            this.game.roomHistory.push(this.game.currentRoom);\r\n            this.game.currentRoom = exit;\r\n            return `You move ${direction}.\\n\\n${this.game.currentRoom.getDescription(this.game.player)}`;\r\n        }\r\n        return `You cannot go ${direction} from here.`;\r\n    }\r\n\r\n    _handleLook(target) {\r\n        if (!target) {\r\n            return this.game.currentRoom.getDescription(this.game.player);\r\n        }\r\n\r\n        // If a target is provided, guide the user to the new command.\r\n        return `To examine something specific, try 'inspect ${target}'.`;\r\n    }\r\n\r\n    _handleInspect(target) {\r\n        if (!target) {\r\n            return \"What do you want to inspect?\";\r\n        }\r\n\r\n        const item = this.game.currentRoom.items.find(i => i.name.toLowerCase() === target.toLowerCase());\r\n        if (item) {\r\n            return item.examine(); // Use item.examine() for consistency\r\n        }\r\n\r\n        const monster = this.game.currentRoom.monsters.find(m => m.name.toLowerCase() === target.toLowerCase());\r\n        if (monster) {\r\n            return monster.description;\r\n        }\r\n\r\n        const npc = this.game.currentRoom.npcs.find(n => n.name.toLowerCase() === target.toLowerCase());\r\n        if (npc) {\r\n            return npc.description;\r\n        }\r\n\r\n        return `You don't see a ${target} here to inspect.`;\r\n    }\r\n\r\n    _handleSearch() {\r\n        const items = this.game.currentRoom.items;\r\n        const monsters = this.game.currentRoom.monsters;\r\n        let result = 'You search the area carefully...\\n\\n';\r\n\r\n        if (items.length > 0) {\r\n            result += 'You find: ' + items.map(i => i.name).join(', ') + '\\n';\r\n        }\r\n        if (monsters.length > 0) {\r\n            result += 'You notice: ' + monsters.map(m => m.name).join(', ') + '\\n';\r\n        }\r\n        const npcs = this.game.currentRoom.npcs;\r\n        if (npcs.length > 0) {\r\n            result += 'You see: ' + npcs.map(n => n.name).join(', ') + '\\n';\r\n        }\r\n        if (items.length === 0 && monsters.length === 0 && npcs.length === 0) {\r\n            result += 'You find nothing of interest.';\r\n        }\r\n        return result;\r\n    }\r\n\r\n    _handleTake(itemName) {\r\n        const item = this.game.currentRoom.items.find(i => i.name.toLowerCase() === itemName.toLowerCase());\r\n        if (item && item.canTake) {\r\n            this.game.player.addItem(item); // Use player's addItem method\r\n            this.game.currentRoom.removeItem(item);\r\n            return `You take the ${itemName}.`;\r\n        } else if (item) {\r\n            return `You cannot take the ${itemName}.`;\r\n        }\r\n        return `There is no ${itemName} here.`;\r\n    }\r\n\r\n    _handleUse(itemName) {\r\n        const item = this.game.player.getItem(itemName.toLowerCase()); // Use player's getItem\r\n        if (item) {\r\n            const usageResult = item.use(this.game.player, this.game.currentRoom);\r\n            if (item.isConsumed) {\r\n                this.game.player.removeItem(item); // Use player's removeItem\r\n            }\r\n            return usageResult;\r\n        }\r\n        return `You don't have a ${itemName}.`;\r\n    }\r\n\r\n    _handleDrop(itemName) {\r\n        const item = this.game.player.getItem(itemName.toLowerCase());\r\n        if (item) {\r\n            this.game.player.removeItem(item); // Remove from player's inventory\r\n            this.game.currentRoom.addItem(item); // Add to the current room's items\r\n            return `You drop the ${itemName}.`;\r\n        }\r\n        return `You don't have a ${itemName} to drop.`;\r\n    }\r\n\r\n    _handleBattle(target) {\r\n        const monster = this.game.currentRoom.monsters.find(m => m.name.toLowerCase() === target.toLowerCase() || (target === '' && this.game.currentRoom.monsters.length > 0));\r\n        if (monster) {\r\n            return this.game.battleSystem.startBattle(this.game.player, monster);\r\n        }\r\n        return 'There is nothing to fight here, or no specific target mentioned.';\r\n    }\r\n\r\n    _handleFlee() {\r\n        // This is for a general 'flee' command when not in battle.\r\n        // If in battle, BattleSystem's flee logic is used.\r\n        return 'You look around nervously, but there is no immediate danger to flee from.';\r\n    }\r\n    \r\n    _handlePick(direction) {\r\n        if (!direction) {\r\n            return \"Which exit do you want to try and pick?\";\r\n        }\r\n\r\n        if (this.game.player.hasItem('lockpick')) {\r\n            const exit = this.game.currentRoom.exits[direction];\r\n            if (exit && this.game.currentRoom.lockedExits[direction]) {\r\n                return this.game.currentRoom.unlockExit(direction);\r\n            } else if (exit) {\r\n                return \"That exit isn't locked.\";\r\n            }\r\n            return `There's no exit in that direction.`;\r\n        }\r\n        return \"You don't have any lock picks!\";\r\n    }\r\n\r\n    _handlePlay(playerChoice) {\r\n        if (!playerChoice) {\r\n            return \"What do you want to play? Try 'play rock', 'play paper', or 'play scissors'.\";\r\n        }\r\n\r\n        const choices = ['rock', 'paper', 'scissors'];\r\n        const playerMove = playerChoice.toLowerCase();\r\n\r\n        if (!choices.includes(playerMove)) {\r\n            return `You can't play '${playerChoice}'. Try rock, paper, or scissors.`;\r\n        }\r\n\r\n        // Find a door to play against.\r\n        let targetDirection = null;\r\n        // Check all exits for an 'rps' lock\r\n        for (const dir in this.game.currentRoom.lockedExits) {\r\n            if (this.game.currentRoom.lockedExits[dir] === 'rps') {\r\n                targetDirection = dir;\r\n                break; // Assume only one RPS door per room for simplicity\r\n            }\r\n        }\r\n\r\n        if (!targetDirection) {\r\n            return \"There's nothing here to play a game with.\";\r\n        }\r\n\r\n        // Now play the game\r\n        const computerChoice = choices[Math.floor(Math.random() * choices.length)];\r\n        let resultMessage = `You play ${playerMove}. The door seems to respond, projecting an image of a ${computerChoice}.\\n\\n`;\r\n\r\n        if (playerMove === computerChoice) {\r\n            resultMessage += \"It's a draw! The door remains locked. Try again.\";\r\n        } else if (\r\n            (playerMove === 'rock' && computerChoice === 'scissors') ||\r\n            (playerMove === 'paper' && computerChoice === 'rock') ||\r\n            (playerMove === 'scissors' && computerChoice === 'paper')\r\n        ) {\r\n            resultMessage += \"You win! With a grinding sound, the lock on the door retracts.\";\r\n            this.game.currentRoom.unlockExit(targetDirection);\r\n        } else {\r\n            resultMessage += \"You lose! The door remains stubbornly shut.\";\r\n        }\r\n\r\n        return resultMessage;\r\n    }\r\n\r\n    _handleTalk(fullTarget) {\r\n        if (!fullTarget) {\r\n            return \"Who do you want to talk to?\";\r\n        }\r\n\r\n        // Parse the input for a target and an optional topic\r\n        const parts = fullTarget.toLowerCase().split(' about ');\r\n        const npcName = parts[0].trim();\r\n        const topic = parts.length > 1 ? parts[1].trim() : 'default';\r\n\r\n        // Find the NPC in the current room\r\n        const npc = this.game.currentRoom.npcs.find(n => n.name.toLowerCase() === npcName);\r\n\r\n        if (npc) {\r\n            return npc.speak(topic);\r\n        }\r\n\r\n        return `There is no one named '${npcName}' here to talk to.`;\r\n    }\r\n\r\n    _handleList() {\r\n        // Find an NPC with a shop in the current room. Assume only one for now.\r\n        const shopkeeper = this.game.currentRoom.npcs.find(npc => npc.shopInventory && npc.shopInventory.length > 0);\r\n\r\n        if (!shopkeeper) {\r\n            return \"There is no one here to buy from.\";\r\n        }\r\n\r\n        if (shopkeeper.shopInventory.length === 0) {\r\n            return `${shopkeeper.name} has nothing for sale right now.`;\r\n        }\r\n\r\n        let response = `<strong>--- ${shopkeeper.name}'s Wares ---</strong>\\n\\n`;\r\n        shopkeeper.shopInventory.forEach(stock => {\r\n            response += `- ${stock.item.name} (${stock.price} gold): ${stock.item.description}\\n`;\r\n        });\r\n        response += `\\nYou have ${this.game.player.gold} gold.`;\r\n        response += `\\n(Type 'buy [item name]' to purchase)`;\r\n\r\n        return response;\r\n    }\r\n\r\n    _handleBuy(itemName) {\r\n        if (!itemName) {\r\n            return \"What would you like to buy?\";\r\n        }\r\n\r\n        const shopkeeper = this.game.currentRoom.npcs.find(npc => npc.shopInventory && npc.shopInventory.length > 0);\r\n\r\n        if (!shopkeeper) {\r\n            return \"There is no one here to buy from.\";\r\n        }\r\n\r\n        const itemToBuy = shopkeeper.shopInventory.find(stock => stock.item.name.toLowerCase() === itemName.toLowerCase());\r\n\r\n        if (!itemToBuy) {\r\n            return `${shopkeeper.name} doesn't have a \"${itemName}\" for sale.`;\r\n        }\r\n\r\n        if (this.game.player.gold < itemToBuy.price) {\r\n            return `You don't have enough gold. You need ${itemToBuy.price} gold, but you only have ${this.game.player.gold}.`;\r\n        }\r\n\r\n        this.game.player.gold -= itemToBuy.price;\r\n        this.game.player.addItem(itemToBuy.item);\r\n        shopkeeper.shopInventory = shopkeeper.shopInventory.filter(stock => stock.item.name.toLowerCase() !== itemName.toLowerCase());\r\n        return `You bought the ${itemToBuy.item.name} for ${itemToBuy.price} gold. You have ${this.game.player.gold} gold left.`;\r\n    }\r\n\r\n    _handleHelp() {\r\n        const helpTitle = \"<strong>--- Help: Available Commands ---</strong>\\n\\n\";\r\n        const commands = [\r\n            \"<strong>go [direction]</strong>: Move between rooms. Valid directions are 'forward', 'back', 'left', and 'right'. You can also type a direction by itself (e.g., 'left').\",\r\n            \"<strong>look</strong>: Get a description of your current location.\",\r\n            \"<strong>inspect [object/monster]</strong>: Examine a specific object or monster in the room.\",\r\n            \"<strong>search</strong>: Search the room for any items or hidden things.\",\r\n            \"<strong>take [item]</strong>: Add an item from the room to your inventory.\",\r\n            \"<strong>drop [item]</strong>: Remove an item from your inventory and leave it in the room.\",\r\n            \"<strong>use [item]</strong>: Use an item from your inventory. Some items have special effects.\",\r\n            \"<strong>pick [direction]</strong>: Attempt to pick a locked door in a given direction (e.g., 'pick left'). This requires a 'lockpick' in your inventory.\",\r\n            \"<strong>attack [monster]</strong>: Engage in combat with a monster.\",\r\n            \"<strong>flee</strong>: Attempt to run away from a battle.\",\r\n            \"<strong>play [choice]</strong>: Play a game of chance when prompted (e.g., 'play rock').\",\r\n            \"<strong>talk [person]</strong> or <strong>talk [person] about [topic]</strong>: Speak to a friendly character.\",\r\n            \"<strong>list</strong>: Shows items for sale if a shopkeeper is present.\",\r\n            \"<strong>buy [item]</strong>: Purchase an item from a shopkeeper.\"\r\n        ];\r\n        return helpTitle + commands.join('\\n\\n');\r\n    }\r\n}","export class BattleSystem {\r\n    constructor() {\r\n        this.inBattle = false;\r\n        this.currentEnemy = null;\r\n        this.battleLog = [];\r\n    }\r\n    \r\n    startBattle(player, monster) {\r\n        this.inBattle = true;\r\n        this.currentEnemy = monster;\r\n        this.battleLog = [];\r\n        \r\n        let result = `\\n=== BATTLE BEGINS ===\\n`;\r\n        result += `You face the ${monster.name}!\\n`;\r\n        result += `${monster.description}\\n\\n`;\r\n        result += this.getBattleStatus(player, monster);\r\n        result += `\\nWhat will you do? (attack, flee, use [item])`;\r\n        \r\n        return result;\r\n    }\r\n    \r\n    processBattleTurn(player, monster, action, target = null) {\r\n        if (!this.inBattle) {\r\n            return \"You are not in battle.\";\r\n        }\r\n        \r\n        let result = '';\r\n        \r\n        switch(action) {\r\n            case 'attack':\r\n                result += this.playerAttack(player, monster);\r\n                if (monster.isAlive) {\r\n                    result += '\\n' + this.monsterAttack(player, monster);\r\n                }\r\n                break;\r\n            case 'flee':\r\n                result += this.attemptFlee(player, monster);\r\n                break;\r\n            case 'use':\r\n                result += this.useItemInBattle(player, target);\r\n                if (monster.isAlive) {\r\n                    result += '\\n' + this.monsterAttack(player, monster);\r\n                }\r\n                break;\r\n            default:\r\n                result = \"Invalid battle action. Try: attack, flee, or use [item]\";\r\n        }\r\n        \r\n        if (!monster.isAlive) {\r\n            result += '\\n' + this.endBattle(player, monster, 'victory');\r\n        } else if (!player.isAlive()) {\r\n            result += '\\n' + this.endBattle(player, monster, 'defeat');\r\n        } else {\r\n            result += '\\n\\n' + this.getBattleStatus(player, monster);\r\n        }\r\n        \r\n        return result;\r\n    }\r\n    \r\n    playerAttack(player, monster) {\r\n        const baseDamageRoll = Math.floor(Math.random() * 13) + 1; // Rolls 1-13\r\n        let finalDamageToApply; // Damage before monster's defense\r\n        let isCritical = false;\r\n\r\n        // Critical hits are triggered by the four highest numbers from the 1-13 roll (10, 11, 12, 13)\r\n        if (baseDamageRoll > 9) {\r\n            isCritical = true;\r\n\r\n            // Calculate the maximum possible damage value for a critical hit based on player's level\r\n            let maxCritDamageValue = 11 + (player.level - 1) * 2;\r\n            maxCritDamageValue = Math.min(maxCritDamageValue, 18); // Cap at 18\r\n\r\n            // Minimum damage value for a critical hit output\r\n            const minCritDamageValue = 10;\r\n\r\n            // Critical damage is a random number between minCritDamageValue and maxCritDamageValue (inclusive)\r\n            finalDamageToApply = Math.floor(Math.random() * (maxCritDamageValue - minCritDamageValue + 1)) + minCritDamageValue;\r\n        } else {\r\n            // Not a critical hit, damage is the base roll (1-9)\r\n            finalDamageToApply = baseDamageRoll;\r\n        }\r\n\r\n        const actualDamage = monster.takeDamage(finalDamageToApply);\r\n        let result = '';\r\n        \r\n        if (isCritical) {\r\n            result = `Critical Hit! You strike the ${monster.name} for ${actualDamage} damage!`;\r\n        } else {\r\n            result = `You strike the ${monster.name} for ${actualDamage} damage!`;\r\n        }\r\n        \r\n        if (!monster.isAlive) {\r\n            result += '\\n' + monster.getDeathMessage();\r\n        }\r\n        \r\n        return result;\r\n    }\r\n    \r\n    monsterAttack(player, monster) {\r\n        const attackDetails = monster.attackPlayer(player); // Returns { damage, isCritical }\r\n        const actualDamage = player.takeDamage(attackDetails.damage);\r\n        \r\n        let result = monster.getAttackMessage();\r\n        if (attackDetails.isCritical) {\r\n            result += ` Critical Hit!`;\r\n        }\r\n        result += `\\nThe ${monster.name} hits you for ${actualDamage} damage!`; // Clarified who hits\r\n        \r\n        if (!player.isAlive()) {\r\n            result += '\\nYou have been defeated!';\r\n        }\r\n        \r\n        return result;\r\n    }\r\n    \r\n    attemptFlee(player, monster) {\r\n        const fleeChance = Math.random();\r\n        if (fleeChance > 0.3) {\r\n            this.endBattle(player, monster, 'flee');\r\n            return \"You successfully flee from the battle!\";\r\n        } else {\r\n            let result = \"You failed to escape!\";\r\n            result += '\\n' + this.monsterAttack(player, monster);\r\n            return result;\r\n        }\r\n    }\r\n    \r\n    useItemInBattle(player, itemName) {\r\n        const item = player.getItem(itemName);\r\n        if (!item) {\r\n            return `You don't have a ${itemName}.`;\r\n        }\r\n        \r\n        let result = item.use(player, null);\r\n        \r\n        if (item.isConsumed) {\r\n            player.removeItem(item);\r\n        }\r\n        \r\n        return result;\r\n    }\r\n    \r\n    getBattleStatus(player, monster) {\r\n        let status = `--- Battle Status ---\\n`;\r\n        status += `Your Health: ${player.health}/${player.maxHealth}\\n`;\r\n        status += `${monster.name} Health: ${monster.health}/${monster.maxHealth}`;\r\n        return status;\r\n    }\r\n    \r\n    endBattle(player, monster, outcome) {\r\n        this.inBattle = false;\r\n        this.currentEnemy = null;\r\n        \r\n        let result = '\\n=== BATTLE END ===\\n';\r\n        \r\n        switch(outcome) {\r\n            case 'victory':\r\n                const exp = monster.experienceValue;\r\n                player.gainExperience(exp);\r\n                result += `Victory! You gained ${exp} experience points.`;\r\n                \r\n                const loot = monster.dropLoot();\r\n                if (loot.length > 0) {\r\n                    result += `\\nThe ${monster.name} dropped: `;\r\n                    result += loot.map(item => item.name).join(', ');\r\n                    loot.forEach(item => player.addItem(item));\r\n                }\r\n                break;\r\n            case 'defeat':\r\n                result += 'You have been defeated! Game Over.';\r\n                break;\r\n            case 'flee':\r\n                result += 'You escaped from the battle.';\r\n                break;\r\n        }\r\n        \r\n        return result;\r\n    }\r\n}","export class DisplayManager {\r\n    constructor(gameInstance, appendTextFunction) {\r\n        this.game = gameInstance; // Access to game.player, game.currentRoom\r\n        this.appendText = appendTextFunction; // Function to output messages\r\n    }\r\n\r\n    displayMap() {\r\n        let mapInfo = \"--- Location ---\\n\\n\";\r\n        mapInfo += `Your current location is the ${this.game.currentRoom.name}\\n. `;\r\n        const exits = Object.keys(this.game.currentRoom.exits);\r\n        if (exits.length > 0) {\r\n            mapInfo += \"Exits: \" + exits.map(exit => `${exit} to ${this.game.currentRoom.exits[exit].name}`).join(', ') + '\\n';\r\n        } else {\r\n            mapInfo += \"No obvious exits from here.\\n\";\r\n        }\r\n        this.appendText(mapInfo);\r\n    }\r\n\r\n    displayInventory() {\r\n        let inventoryInfo = \"--- Inventory ---\\n\\n\";\r\n        if (this.game.player.inventory.length === 0) {\r\n            inventoryInfo += \"Your inventory is empty.\";\r\n        } else {\r\n            inventoryInfo += \"You are carrying:\\n\";\r\n            this.game.player.inventory.forEach(item => {\r\n                inventoryInfo += `- ${item.name}: ${item.examine()}\\n`;\r\n            });\r\n        }\r\n        this.appendText(inventoryInfo);\r\n    }\r\n\r\n    displayStats() {\r\n        const stats = this.game.player.getStats();\r\n        let statsInfo = \"--- Character Stats ---\\n\\n\";\r\n        statsInfo += `Name: ${stats.name}\\n`;\r\n        statsInfo += `Level: ${stats.level}\\n`;\r\n        statsInfo += `Health: ${stats.health} / ${stats.maxHealth}\\n`;\r\n        statsInfo += `Attack: ${stats.attack}\\n`;\r\n        statsInfo += `Defense: ${stats.defense}\\n`;\r\n        statsInfo += `Experience: ${stats.experience} / ${stats.level * 100}\\n`;\r\n        statsInfo += `Gold: ${stats.gold}\\n`;\r\n        this.appendText(statsInfo);\r\n    }\r\n}","function _setupPortraitListeners(portraitImages, archetypeData, statTooltipElement, onPortraitClickCallback) {\r\n    portraitImages.forEach((imgElement, index) => {\r\n        imgElement.addEventListener('click', () => {\r\n            // The callback will handle updating selectedArchetypeIndex and visual .selected class\r\n            onPortraitClickCallback(imgElement, index, portraitImages);\r\n        });\r\n\r\n        imgElement.addEventListener('mouseenter', (event) => {\r\n            const stats = archetypeData[index];\r\n            if (stats) {\r\n                statTooltipElement.innerHTML = `\r\n                    <strong>${stats.name}</strong><br>\r\n                    Health: ${stats.health}<br>\r\n                    Strength: ${stats.strength}<br>\r\n                    Dexterity: ${stats.dexterity}<br>\r\n                    Agility: ${stats.agility}<br>\r\n                    Intelligence: ${stats.intelligence}<br>\r\n                    Charisma: ${stats.charisma}`;\r\n                statTooltipElement.style.left = (event.pageX + 15) + 'px';\r\n                statTooltipElement.style.top = (event.pageY + 15) + 'px';\r\n                statTooltipElement.style.display = 'block';\r\n            }\r\n        });\r\n\r\n        imgElement.addEventListener('mouseleave', () => {\r\n            statTooltipElement.style.display = 'none';\r\n        });\r\n\r\n        imgElement.addEventListener('mousemove', (event) => {\r\n            if (statTooltipElement.style.display === 'block') {\r\n                statTooltipElement.style.left = (event.pageX + 15) + 'px';\r\n                statTooltipElement.style.top = (event.pageY + 15) + 'px';\r\n            }\r\n        });\r\n    });\r\n}\r\n\r\nexport function setupPreGameplayEventListeners({\r\n    // DOM elements\r\n    startButton,\r\n    selectMaleButton,\r\n    selectFemaleButton,\r\n    confirmCharacterButton,\r\n    portraitImages,\r\n    statTooltip,\r\n    // Data\r\n    archetypeData,\r\n    // Callbacks from main.js\r\n    onStartGame,\r\n    onGenderSelected,\r\n    onPortraitClicked,\r\n    onConfirmCharacterClicked\r\n}) {\r\n    if (startButton) {\r\n        startButton.addEventListener('click', onStartGame);\r\n    }\r\n\r\n    if (selectMaleButton) {\r\n        selectMaleButton.addEventListener('click', () => onGenderSelected('Male'));\r\n    }\r\n\r\n    if (selectFemaleButton) {\r\n        selectFemaleButton.addEventListener('click', () => onGenderSelected('Female'));\r\n    }\r\n\r\n    if (confirmCharacterButton) {\r\n        confirmCharacterButton.addEventListener('click', onConfirmCharacterClicked);\r\n    }\r\n\r\n    _setupPortraitListeners(\r\n        portraitImages,\r\n        archetypeData,\r\n        statTooltip,\r\n        onPortraitClicked\r\n    );\r\n}\r\n\r\nexport function setupGameplayEventListeners({\r\n    commandInput,\r\n    mapButton,\r\n    inventoryButton,\r\n    statsButton,\r\n    helpButton,\r\n    gameInstance // The fully initialized AdventureGame instance\r\n}) {\r\n    if (commandInput) {\r\n        commandInput.addEventListener('keypress', (e) => {\r\n            if (e.key === 'Enter' && commandInput.value.trim() !== '') {\r\n                gameInstance.processCommand(commandInput.value.trim().toLowerCase());\r\n                commandInput.value = '';\r\n            }\r\n        });\r\n    }\r\n    if (mapButton) mapButton.addEventListener('click', () => gameInstance.displayManager.displayMap());\r\n    if (inventoryButton) inventoryButton.addEventListener('click', () => gameInstance.displayManager.displayInventory());\r\n    if (statsButton) statsButton.addEventListener('click', () => gameInstance.displayManager.displayStats());\r\n    if (helpButton) {\r\n        helpButton.addEventListener('click', () => {\r\n            // Directly get the help text from the action handler\r\n            const helpText = gameInstance.actionHandler._handleHelp();\r\n            // Display it as a system message, not a command response (no '>')\r\n            gameInstance.displayMessage(helpText, false);\r\n        });\r\n    }\r\n}"],"names":["$4282fb41af3be353$export$6d08773d2e66f8f2","name","description","canTake","isUsable","isConsumed","use","player","room","useTorch","useCrystal","useSword","useKey","usePotion","attack","health","Math","min","maxHealth","examine","$ca4ced5904ea9a46$export$d2385d4b1e3b9d1a","defense","isAlive","experienceValue","floor","loot","takeDamage","damage","actualDamage","max","attackPlayer","isCritical","random","getAttackMessage","messages","length","getDeathMessage","addLoot","item","push","dropLoot","$42615f55985a1754$export$cb68cc2163cd3f1","gold","inventory","experience","level","heal","amount","addItem","removeItem","index","indexOf","splice","hasItem","itemName","some","toLowerCase","getItem","find","gainExperience","exp","levelUp","getStats","$42615f55985a1754$export$958e8ef16ce7d8c4","responses","shopInventory","isHostile","dialogueCounters","speak","topic","topicResponses","undefined","messageIndex","message","setHostile","hostile","turnHostile","$42615f55985a1754$export$8c85bdde2b83a480","strength","dexterity","agility","intelligence","charisma","$ac1ec18087c85c6d$export$525628e68e798fb4","exits","items","monsters","npcs","visited","lockedExits","setExit","direction","setLockedExit","keyName","addMonster","monster","addNPC","npc","removeMonster","getDescription","baseDesc","desc","map","join","exitList","Object","keys","formattedExits","hasExit","hasOwnProperty","getExit","unlockExit","destinationRoom","exitName","returnDir","$4f211b8eb53ec7aa$export$b413f0fd99d7775","gameInstance","game","processCommand","verb","object","response","_handleMovement","_handleLook","_handleInspect","_handleSearch","_handleTake","_handleUse","_handleDrop","_handleBattle","_handleFlee","_handlePick","_handleHelp","_handlePlay","_handleTalk","_handleList","_handleBuy","allowedDirections","includes","roomHistory","currentRoom","pop","exit","target","i","m","n","result","usageResult","battleSystem","startBattle","playerChoice","choices","playerMove","targetDirection","dir","computerChoice","resultMessage","fullTarget","parts","split","npcName","trim","shopkeeper","forEach","stock","price","itemToBuy","filter","helpTitle","$202629da8e082d6a$export$761d71765f873338","inBattle","currentEnemy","battleLog","getBattleStatus","processBattleTurn","action","playerAttack","monsterAttack","attemptFlee","useItemInBattle","endBattle","finalDamageToApply","baseDamageRoll","maxCritDamageValue","attackDetails","fleeChance","status","outcome","$2d63a410b342b8ee$export$dcc2704b47159cd7","appendTextFunction","appendText","displayMap","mapInfo","displayInventory","inventoryInfo","displayStats","stats","statsInfo","document","addEventListener","titleScreen","getElementById","startButton","characterSelectionScreen","selectMaleButton","selectFemaleButton","gameplayScreen","confirmCharacterButton","commandInput","portraitImages","portraitImg","statTooltip","createElement","id","classList","add","body","appendChild","gameOutput","outputContainer","querySelector","text","formattedText","replace","innerHTML","scrollTop","scrollHeight","selectedCharacterType","selectedArchetypeIndex","AdventureGame","characterType","gameState","interactionState","mapButton","inventoryButton","statsButton","helpButton","actionHandler","displayManager","initializeGame","updateStatusBars","roomData","itemPlacement","monsterPlacement","npcPlacement","rooms","conn","from","to","returnDirection","locked","twoWayLock","oneWay","fromRoom","toRoom","roomId","command","displayMessage","disabled","slice","isCommandResponse","healthFill","healthText","expFill","expText","healthPercent","style","width","textContent","expAtStartOfLevel","expForNextLevel","expGainedThisLevel","expNeededThisLevel","expPercent","archetypeData","onStartGame","onGenderSelected","onPortraitClicked","onConfirmCharacterClicked","imgElement","onPortraitClickCallback","event","statTooltipElement","left","pageX","top","pageY","display","remove","gender","genderLower","folderPath","img","filename","src","URL","alt","clickedImgElement","allPortraits","console","log","playerDisplayImgElement","imageName","e","key","value","helpText","focus","alert","error"],"version":3,"file":"AdorellanAdventures.1df9ef8d.js.map"}